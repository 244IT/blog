## ES6

### 01.varã€letã€const

1.å˜é‡æå‡ï¼švarå­˜åœ¨å˜é‡æå‡ï¼Œletã€constä¸å­˜åœ¨

```
console.log(name) // undefined
var name = "jack"

console.log(age) //Cannot access 'age' before initialization
let age = 12
```

2.é‡å¤å®šä¹‰ï¼švarå¯ä»¥é‡å¤å®šä¹‰ï¼Œletã€constä¸å¯ä»¥

3.æš‚æ—¶æ€§æ­»åŒºï¼šletå£°æ˜ä¼šå½¢æˆæš‚æ—¶æ€§æ­»åŒº

>æš‚æ—¶æ€§æ­»åŒºç›¸å½“äºä¸€ä¸ªå°é—­çš„ä½œç”¨åŸŸï¼Œä¸èƒ½åœ¨è¿™ä¸ªä½œç”¨åŸŸä¸­å£°æ˜å˜é‡å‰ä½¿ç”¨å˜é‡ï¼Œå¦åˆ™ä¼šæŠ¥é”™

4.å—çº§ä½œç”¨åŸŸï¼švarå£°æ˜çš„å˜é‡æ²¡æœ‰å—çº§ä½œç”¨åŸŸã€letã€conståœ¨å—çº§ä½œç”¨åŸŸæœ‰æ•ˆ

```
if(true) let a = 5 // æŠ¥é”™
```

5.æŒ‚è½½windowï¼švarå£°æ˜çš„å…¨å±€å˜é‡ä¼šæŒ‚è½½åœ¨windowä¸Šï¼ˆå¼Šç«¯ï¼šå…¨å±€å˜é‡å’Œé¡¶å±‚å¯¹è±¡æŒ‚é’©ï¼‰ï¼Œè€Œletå’Œconstä¸ä¼š

6.ä¿®æ”¹å€¼ï¼švarã€letå£°æ˜çš„å˜é‡å€¼å¯ä¿®æ”¹ï¼Œconstä¸å¯ä¿®æ”¹ï¼Œç”¨æ¥å£°æ˜å¸¸é‡

>é‚£ä¹ˆå¦‚ä½•ä½¿å¯¹è±¡ä¸å¯å˜ï¼Ÿä½¿ç”¨é€’å½’Object.freeze()

7.å…ˆå£°æ˜åèµ‹å€¼ï¼švarã€letå¯ä»¥å…ˆå£°æ˜å˜é‡ï¼Œåèµ‹å€¼ï¼Œconstä¸è¡Œ

### 02.å˜é‡çš„ç»“æ„èµ‹å€¼

1.ç†è§£ï¼š

* ä»å¯¹è±¡æˆ–æ•°ç»„ä¸­æå–æ•°æ®, å¹¶èµ‹å€¼ç»™å˜é‡(å¤šä¸ª)

2.å¯¹è±¡çš„è§£æ„èµ‹å€¼ï¼š

* ä»¥å‰æˆ‘ä»¬è·å–å¯¹è±¡å±æ€§å€¼çš„æ–¹å¼

```
let obj = {name : 'kobe', age : 39};
let name = obj.name;
let age = obj.age;
console.log(name, age);

function person(p) {//ä¸ç”¨è§£æ„èµ‹å€¼
	console.log(p.name, p.age);
}
person(obj);
```

* ä½¿ç”¨å¯¹è±¡è§£æ„èµ‹å€¼

```
let {name, age} = {name : 'kobe', age : 39};
console.log(name, age);

function person1({name, age}) {
	console.log(name, age);
}
person1(obj);
```

3.æ•°ç»„çš„è§£æ„èµ‹å€¼

```
let arr = ['abc', 23, true];
let [a, b, c, d] = arr;
console.log(a, b, c, d); // 'abc', 23, true, undefined
```

è§£æ„çš„é»˜è®¤å€¼æ˜¯æƒ°æ€§çš„

```
let [a = foo()] = [1] // ä¸ä¼šæ‰“å°123

function foo() {
	console.log(123)
}
```

* å› ä¸ºaæœ¬èº«æ˜¯å¯ä»¥å–åˆ°å€¼çš„ï¼Œæ‰€ä»¥ä¸ä¼šæ‰§è¡Œ=å³è¾¹

### 03.å­—ç¬¦ä¸²çš„æ‰©å±•

#### 4.1.Unicodeè¡¨ç¤º

ES6 åŠ å¼ºäº†å¯¹ Unicode çš„æ”¯æŒï¼Œå…è®¸é‡‡ç”¨\uxxxxå½¢å¼è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå…¶ä¸­xxxxè¡¨ç¤ºå­—ç¬¦çš„ Unicode ç ç‚¹ã€‚

```js
"\u0061"
// "a"
```

ä½†æ˜¯ï¼Œè¿™ç§è¡¨ç¤ºæ³•åªé™äºç ç‚¹åœ¨\u0000~\uFFFFä¹‹é—´çš„å­—ç¬¦ã€‚è¶…å‡ºè¿™ä¸ªèŒƒå›´çš„å­—ç¬¦ï¼Œå¿…é¡»ç”¨ä¸¤ä¸ªåŒå­—èŠ‚çš„å½¢å¼è¡¨ç¤ºã€‚

```js
"\uD842\uDFB7"
// "ğ ®·"

"\u20BB7"
// " 7"
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœç›´æ¥åœ¨\uåé¢è·Ÿä¸Šè¶…è¿‡0xFFFFçš„æ•°å€¼ï¼ˆæ¯”å¦‚\u20BB7ï¼‰ï¼ŒJavaScript ä¼šç†è§£æˆ\u20BB+7ã€‚ç”±äº\u20BBæ˜¯ä¸€ä¸ªä¸å¯æ‰“å°å­—ç¬¦ï¼Œæ‰€ä»¥åªä¼šæ˜¾ç¤ºä¸€ä¸ªç©ºæ ¼ï¼Œåé¢è·Ÿç€ä¸€ä¸ª7ã€‚

ES6 å¯¹è¿™ä¸€ç‚¹åšå‡ºäº†æ”¹è¿›ï¼Œåªè¦å°†ç ç‚¹æ”¾å…¥å¤§æ‹¬å·ï¼Œå°±èƒ½æ­£ç¡®è§£è¯»è¯¥å­—ç¬¦ã€‚

```js
"\u{20BB7}"
// "ğ ®·"
```

æœ‰äº†è¿™ç§è¡¨ç¤ºæ³•ä¹‹åï¼ŒJavaScript å…±æœ‰ 6 ç§æ–¹æ³•å¯ä»¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚

```js
'\z' === 'z' // true
'\172' === 'z' // true
'\x7A' === 'z' // true
'\u007A' === 'z' // true
'\u{7A}' === 'z' // true
```

#### 4.2.éå†å™¨æ¥å£

ES6 ä¸ºå­—ç¬¦ä¸²æ·»åŠ äº†éå†å™¨æ¥å£ï¼Œè¯¦è§Iteratorä¸€èŠ‚ï¼Œä½¿å¾—å­—ç¬¦ä¸²å¯ä»¥è¢«for...ofå¾ªç¯éå†ã€‚

```js
for (let item of 'imooc') {
    console.log(item)
}
```

#### 4.3.æ¨¡æ¿å­—ç¬¦ä¸²

åœ¨ ES6 ä¹‹å‰å¯¹å­—ç¬¦ä¸²çš„å¤„ç†æ˜¯ç›¸å½“çš„éº»çƒ¦ï¼Œçœ‹å¦‚ä¸‹åœºæ™¯ï¼š

**1. å­—ç¬¦ä¸²å¾ˆé•¿è¦æ¢è¡Œ**

å­—ç¬¦ä¸²å¾ˆé•¿åŒ…æ‹¬å‡ ç§æƒ…å½¢ä¸€ä¸ªæ˜¯å¼€å‘æ—¶è¾“å…¥çš„æ–‡æœ¬å†…å®¹ï¼Œä¸€ä¸ªæ˜¯æ¥å£æ•°æ®è¿”å›çš„æ–‡æœ¬å†…å®¹ã€‚å¦‚æœå¯¹æ¢è¡Œç¬¦å¤„ç†ä¸å½“ï¼Œå°±ä¼šå¸¦æ¥å¼‚å¸¸ã€‚

**2. å­—ç¬¦ä¸²ä¸­æœ‰å˜é‡æˆ–è€…è¡¨è¾¾å¼**

å¦‚æœå­—ç¬¦ä¸²ä¸æ˜¯é™æ€å†…å®¹ï¼Œå¾€å¾€æ˜¯éœ€è¦åŠ è½½å˜é‡æˆ–è€…è¡¨è¾¾å¼ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚ã€‚ä¹‹å‰çš„åšæ³•æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ï¼š

```js
  var a = 20
  var b = 10
  var c = 'JavaScript'
  var str = 'My age is ' + (a + b) + ' and I love ' + c
  console.log(str)
```

å¦‚æœå­—ç¬¦ä¸²æœ‰å¤§é‡çš„å˜é‡å’Œè¡¨è¾¾å¼ï¼Œè¿™ä¸ªæ‹¼æ¥ç®€ç›´æ˜¯å™©æ¢¦ã€‚

**3. å­—ç¬¦ä¸²ä¸­æœ‰é€»è¾‘è¿ç®—**

æˆ‘ä»¬é€šå¸¸å†™ä»£ç éƒ½æ˜¯æœ‰é€»è¾‘è¿ç®—çš„ï¼Œå¯¹äºå­—ç¬¦ä¸²ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå®ƒåŒ…å«çš„å†…å®¹ä¸æ˜¯é™æ€çš„ï¼Œé€šå¸¸æ˜¯æ ¹æ®ä¸€å®šçš„è§„åˆ™åœ¨åŠ¨æ€å˜åŒ–ã€‚

```js
  var retailPrice = 20
  var wholesalePrice = 16
  var type = 'retail'

  var showTxt = ''

  if (type === 'retail') {
      showTxt += 'æ‚¨æ­¤æ¬¡çš„è´­ä¹°å•ä»·æ˜¯ï¼š' + retailPrice
  } else {
      showTxt += 'æ‚¨æ­¤æ¬¡çš„æ‰¹å‘ä»·æ˜¯ï¼š' + wholesalePrice
  }
```

çœ‹åˆ°è¿™æ ·çš„ä»£ç ä¸€å®šä¼šæ„Ÿåˆ°å¾ˆç†Ÿæ‚‰ï¼Œé€šå¸¸å¤§å®¶çš„åšæ³•æ˜¯ä½¿ç”¨ä¸Šè¿°çš„å­—ç¬¦ä¸²æ‹¼æ¥+é€»è¾‘åˆ¤æ–­ï¼Œæˆ–è€…é‡‡ç”¨å­—ç¬¦ä¸²æ¨¡æ¿ç±»åº“æ¥æ“ä½œã€‚

**String Literals**

çœ‹äº†ä¸Šè¿°çš„åº”ç”¨åœºæ™¯ï¼Œå°±è¦å¼•å…¥ String Literals è¯é¢˜ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥è§£å†³å­—ç¬¦ä¸²æ‹¼æ¥é—®é¢˜ï¼Œä» ES6 å¼€å§‹å¯ä»¥è¿™æ ·å®šä¹‰å­—ç¬¦ä¸²äº†ã€‚

```js
`string text` 

`string text line 1
 string text line 2`

`string text ${expression} string text` 
```

åœ¨è¿™é‡Œä½ å¯ä»¥ä»»æ„æ’å…¥å˜é‡æˆ–è€…è¡¨è¾¾å¼ï¼Œåªè¦ç”¨ ```${}` ``åŒ…èµ·æ¥å°±å¥½ã€‚

æ³¨æ„

è¿™é‡Œçš„ç¬¦å·æ˜¯åå¼•å·ï¼Œä¹Ÿå°±æ˜¯æ•°å­—é”® 1 å·¦è¾¹çš„é”®ï¼Œä¸æ˜¯å•å¼•å·æˆ–è€…åŒå¼•å·

è¿™æ ·å°±å¯ä»¥è½»æ¾è§£å†³å­—ç¬¦ä¸²åŒ…å«å˜é‡æˆ–è€…è¡¨è¾¾å¼çš„é—®é¢˜äº†ï¼Œå¯¹äºå¤šè¡Œçš„å­—ç¬¦ä¸²ï¼Œä¹‹å‰æ˜¯è¿™æ ·å¤„ç†

```js
console.log('string text line 1\n' +
    'string text line 2')
// "string text line 1
// string text line 2"
```

ç°åœ¨å¯ä»¥è¿™æ ·åšäº†

```js
console.log(`string text line 1
string text line 2`)
// "string text line 1
// string text line 2"
```

å®Œå…¨ä¸éœ€è¦ ```\n` ``æ¥å‚ä¸ã€‚

**Tag Literals**

å‰é¢çš„å­—ç¬¦ä¸²å­—é¢é‡è§£å†³äº†å­—ç¬¦ä¸²æ‹¼æ¥çš„é—®é¢˜ï¼Œå¯¹äºåŒ…å«å¤æ‚é€»è¾‘çš„å­—ç¬¦ä¸²å¹¶ä¸æ˜¯ç®€å•çš„è¡¨è¾¾å¼èƒ½æå®šçš„ã€‚æ‰€ä»¥éœ€è¦å¦ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šTag Literalsï¼Œè¿˜æ˜¯çœ‹ä¸Šè¿°é‚£ä¸ªä¾‹å­:

```js
var retailPrice = 20
var wholesalePrice = 16
var type = 'retail'

var showTxt = ''

if (type === 'retail') {
    showTxt += 'æ‚¨æ­¤æ¬¡çš„è´­ä¹°å•ä»·æ˜¯ï¼š' + retailPrice
} else {
    showTxt += 'æ‚¨æ­¤æ¬¡çš„æ‰¹å‘ä»·æ˜¯ï¼š' + wholesalePrice
}
```

ç°åœ¨å¯ä»¥å®šä¹‰ä¸€ä¸ª Tag å‡½æ•°ï¼Œç„¶åç”¨è¿™ä¸ª Tag å‡½æ•°æ¥å……å½“ä¸€ä¸ªæ¨¡æ¿å¼•æ“ï¼š

```js
function Price(strings, type) {
    let s1 = strings[0]
    const retailPrice = 20
    const wholesalePrice = 16
    let txt = ''
    if (type === 'retail') {
        txt = `è´­ä¹°å•ä»·æ˜¯ï¼š${retailPrice}` 
    } else {
        txt = `æ‰¹å‘ä»·æ˜¯ï¼š${wholesalePrice}` 
    }
    return `${s1}${txt}` 
}

let showTxt = Price `æ‚¨æ­¤æ¬¡çš„${'retail'}` 

console.log(showTxt) //æ‚¨æ­¤æ¬¡çš„è´­ä¹°å•ä»·æ˜¯ï¼š20
```

TIP

strings å‚æ•°æŒ‡çš„æ˜¯ Tag å‡½æ•°åé¢è¢«å˜é‡åˆ†å‰²å¼€çš„å­—ç¬¦ä¸²é›†åˆï¼Œtype å‚æ•°æ˜¯å¯¹åº”ç¬¬ä¸€ä¸ªå˜é‡ï¼ŒTag å‡½æ•°å¯ä»¥æœ‰å¤šä¸ª type ç±»ä¼¼çš„å‚æ•°

#### 4.4.æ–°å¢æ–¹æ³•

**String.prototype.fromCodePoint()**

ç”¨äºä» Unicode ç ç‚¹è¿”å›å¯¹åº”å­—ç¬¦ï¼Œå¹¶ä¸”å¯ä»¥è¯†åˆ«å¤§äº0xFFFFçš„å­—ç¬¦ã€‚

```js
// ES5
console.log(String.fromCharCode(0x20BB7))

// ES6
console.log(String.fromCodePoint(0x20BB7))
```

**String.prototype.includes()**

ES5ä¸­å¯ä»¥ä½¿ç”¨indexOfæ–¹æ³•æ¥åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼ŒindexOfè¿”å›å‡ºç°çš„ä¸‹æ ‡ä½ç½®ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›-1ã€‚

```js
const str = 'imooc'

console.log(str.indexOf('mo'))
```

ES6æä¾›äº†includesæ–¹æ³•æ¥åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œè¿”å›booleanç±»å‹çš„å€¼ã€‚

```js
const str = 'imooc'

console.log(str.includes('mo'))
```

**String.prototype.startsWith()**

åˆ¤æ–­å‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨åŸå­—ç¬¦ä¸²çš„å¤´éƒ¨, è¿”å›booleanç±»å‹çš„å€¼ã€‚

```js
const str = 'imooc'

console.log(str.startsWith('im'))
```

**String.prototype.endsWith()**

åˆ¤æ–­å‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨åŸå­—ç¬¦ä¸²çš„å°¾éƒ¨, è¿”å›booleanç±»å‹çš„å€¼ã€‚

```js
const str = 'imooc'

console.log(str.endsWith('mooc'))
```

**String.prototype.repeat()**

repeatæ–¹æ³•è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå°†åŸå­—ç¬¦ä¸²é‡å¤næ¬¡ã€‚

```js
const str = 'imooc'

const newStr = str.repeat(10)

console.log(newStr)
```

* å¦‚æœå‚æ•°ä¼ å…¥0æˆ–è€…è´Ÿæ•°çš„è¯ï¼Œè¿”å›å€¼ä¸ºunde

### 04.æ•°å­—çš„æ‰©å±•

#### 4.1.äºŒè¿›åˆ¶ä¸å…«è¿›åˆ¶

è¯·å¤§å®¶æ€è€ƒåœ¨JSä¸­å¦‚ä½•æŠŠåè¿›åˆ¶è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ï¼Ÿ

```js
const a = 5 // 101

console.log(a.toString(2))
```

å¦‚ä½•æŠŠå…«è¿›åˆ¶è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ï¼Ÿ

```js
const b = 101

console.log(parseInt(b, 2))
```

ES6 æä¾›äº†äºŒè¿›åˆ¶å’Œå…«è¿›åˆ¶æ•°å€¼çš„æ–°çš„å†™æ³•ï¼Œåˆ†åˆ«ç”¨å‰ç¼€0bï¼ˆæˆ–0Bï¼‰å’Œ0oï¼ˆæˆ–0Oï¼‰è¡¨ç¤ºã€‚

```js
const a = 0B0101
console.log(a)

const b = 0O777
console.log(b)
```

#### 4.2.Numberæ–°å¢æ–¹æ³•

**Number.isFinite()**

ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªæ•°å€¼æ˜¯å¦ä¸ºæœ‰é™çš„ï¼ˆfiniteï¼‰ï¼Œå³ä¸æ˜¯Infinityã€‚

```js
Number.isFinite(15) // true
Number.isFinite(0.8) // true
Number.isFinite(NaN) // false
Number.isFinite(Infinity) // false
Number.isFinite(-Infinity) // false
Number.isFinite('foo') // false
Number.isFinite('15') // false
Number.isFinite(true) // false
```

**Number.isNaN()**

ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºNaNã€‚

```js
Number.isNaN(NaN) // true
Number.isNaN(15) // false
Number.isNaN('15') // false
Number.isNaN(true) // false
Number.isNaN(9 / NaN) // true
Number.isNaN('true' / 0) // true
Number.isNaN('true' / 'true') // true
```

**Number.parseInt()**

ES6 å°†å…¨å±€æ–¹æ³•parseInt()ç§»æ¤åˆ°Numberå¯¹è±¡ä¸Šé¢ï¼Œè¡Œä¸ºå®Œå…¨ä¿æŒä¸å˜ã€‚ è¿™æ ·åšçš„ç›®çš„ï¼Œæ˜¯é€æ­¥å‡å°‘å…¨å±€æ€§æ–¹æ³•ï¼Œä½¿å¾—è¯­è¨€é€æ­¥æ¨¡å—åŒ–ã€‚

```js
// ES5çš„å†™æ³•
parseInt('12.34') // 12

// ES6çš„å†™æ³•
Number.parseInt('12.34') // 12
```

**Number.parseFloat()**

ES6 å°†å…¨å±€æ–¹æ³•parseFloat()ç§»æ¤åˆ°Numberå¯¹è±¡ä¸Šé¢ï¼Œè¡Œä¸ºå®Œå…¨ä¿æŒä¸å˜ã€‚è¿™æ ·åšçš„ç›®çš„ï¼Œæ˜¯é€æ­¥å‡å°‘å…¨å±€æ€§æ–¹æ³•ï¼Œä½¿å¾—è¯­è¨€é€æ­¥æ¨¡å—åŒ–ã€‚

```js
// ES5çš„å†™æ³•
parseFloat('123.45#') // 123.45

// ES6çš„å†™æ³•
Number.parseFloat('123.45#') // 123.45
```

**Number.isInteger()**

ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°å€¼æ˜¯å¦ä¸ºæ•´æ•°ã€‚

```js
Number.isInteger(25) // true
Number.isInteger(25.1) // false

Number.isInteger() // false
Number.isInteger(null) // false
Number.isInteger('15') // false
Number.isInteger(true) // false
```

**Number.MAX_SAFE_INTEGER**

```js
Number.MAX_SAFE_INTEGER === Math.pow(2, 53) - 1 // true

Number.MAX_SAFE_INTEGER === 9007199254740991 // true
```

**Number.MIN_SAFE_INTEGER**

```js
Number.MIN_SAFE_INTEGER === -Number.MAX_SAFE_INTEGER // true

Number.MIN_SAFE_INTEGER === -9007199254740991 // true
```

**Number.isSafeInteger()**

JavaScript èƒ½å¤Ÿå‡†ç¡®è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´åœ¨-2^53åˆ°2^53ä¹‹é—´ï¼ˆä¸å«ä¸¤ä¸ªç«¯ç‚¹ï¼‰ï¼Œè¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œæ— æ³•ç²¾ç¡®è¡¨ç¤ºè¿™ä¸ªå€¼ã€‚

```js
Math.pow(2, 53) // 9007199254740992

Math.pow(2, 53) === Math.pow(2, 53) + 1 // true
```

#### 4.3.Mathæ–°å¢æ–¹æ³•

**Math.trunc()**

æ–¹æ³•ç”¨äºå»é™¤ä¸€ä¸ªæ•°çš„å°æ•°éƒ¨åˆ†ï¼Œè¿”å›æ•´æ•°éƒ¨åˆ†ã€‚

```js
console.log(Math.trunc(5.5))
console.log(Math.trunc(-5.5))
console.log(Math.trunc(true)) // 1
console.log(Math.trunc(false)) // 0
console.log(Math.trunc(NaN)) // NaN
console.log(Math.trunc(undefined)) // NaN
console.log(Math.trunc()) // NaN
```

**Math.sign()**

æ–¹æ³•ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°åˆ°åº•æ˜¯æ­£æ•°ã€è´Ÿæ•°ã€è¿˜æ˜¯é›¶ã€‚å¯¹äºéæ•°å€¼ï¼Œä¼šå…ˆå°†å…¶è½¬æ¢ä¸ºæ•°å€¼ã€‚

å®ƒä¼šè¿”å›äº”ç§å€¼ã€‚

- å‚æ•°ä¸ºæ­£æ•°ï¼Œè¿”å›+1
- å‚æ•°ä¸ºè´Ÿæ•°ï¼Œè¿”å›-1
- å‚æ•°ä¸º 0ï¼Œè¿”å›0
- å‚æ•°ä¸º-0ï¼Œè¿”å›-0
- å…¶ä»–å€¼ï¼Œè¿”å›NaN

```js
console.log(Math.sign(5)) // 1
console.log(Math.sign(-5)) // -1
console.log(Math.sign(0)) // 0
console.log(Math.sign(NaN)) // NaN
console.log(Math.sign(true)) // 1
console.log(Math.sign(false)) // 0
```

**Math.cbrt()**

æ–¹æ³•ç”¨äºè®¡ç®—ä¸€ä¸ªæ•°çš„ç«‹æ–¹æ ¹ã€‚

```js
console.log(Math.cbrt(8)) // 2

console.log(Math.cbrt('imooc')) // NaN
```

### 05.æ•°ç»„çš„æ‰©å±•

#### 15.1.ES5ä¸­çš„æ•°ç»„éå†æ–¹å¼

```js
let arr = [1, 2, 3, 2, 4]
```

**forå¾ªç¯**

```js
for (let i = 0; i < arr.length; i++) {
    console.log(arr[i])
}
```

åæ¥è¯­æ³•æœ‰æ‰€å‡çº§ï¼Œåˆ° ES5 éå†æ•°ç»„çš„ API å¤šäº†èµ·æ¥ï¼Œå…¶ä¸­æœ‰ forEachã€everyã€filterç­‰ï¼ŒåŒæ ·çš„åŠŸèƒ½å¯ä»¥ç”¨ forEach ã€ map ã€ every ç­‰æ–¹æ³•æ¥å®ç°ã€‚

**forEach() æ²¡æœ‰è¿”å›å€¼ï¼Œåªæ˜¯é’ˆå¯¹æ¯ä¸ªå…ƒç´ è°ƒç”¨func**

```js
arr.forEach(function(elem, index, array) {
    if (arr[i] == 2) {
        continue
    }
    console.log(elem, index)
})
```

è¿™ä¸ªè¯­æ³•çœ‹èµ·æ¥è¦ç®€æ´å¾ˆå¤šï¼Œä¸éœ€è¦é€šè¿‡ç´¢å¼•å»è®¿é—®æ•°ç»„é¡¹ï¼Œç„¶è€Œå®ƒçš„ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾ï¼Œä¸æ”¯æŒ breakã€continue ç­‰ã€‚

```js
[1, 2, 3, 4, 5].forEach(function(i) {
    if (i === 2) {
        return;
    } else {
        console.log(i)
    }
})
```

è¿™æ®µä»£ç çš„"æœ¬æ„"æ˜¯ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹éå†ï¼Œé‡åˆ°æ•°ç»„é¡¹ 2 ä¹‹åå°±ç»“æŸéå†ï¼Œä¸ç„¶æ‰“å°å‡ºæ‰€éå†è¿‡çš„æ•°å€¼é¡¹ã€‚å¯æ˜¯ï¼Œäº‹å®è®©ä½ å¤§è·Œçœ¼é•œï¼Œå› ä¸ºå®ƒçš„è¾“å‡ºæ˜¯ 1, 3, 4, 5ã€‚

æ³¨æ„

forEach çš„ä»£ç å—ä¸­ä¸èƒ½ä½¿ç”¨ breakã€continueï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

**map() è¿”å›æ–°çš„æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ ä¸ºè°ƒç”¨funcçš„ç»“æœ**

```js
let result = arr.map(function(value) {
    value += 1
    console.log(value)
    return value
})
console.log(arr, result)
```

**filter() è¿”å›ç¬¦åˆfuncæ¡ä»¶çš„å…ƒç´ æ•°ç»„**

```js
let result = arr.filter(function(value) {
    console.log(value)
    return value == 2
})
console.log(arr, result)
```

**some() è¿”å›booleanï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å…ƒç´ ç¬¦åˆfuncæ¡ä»¶**

```js
let result = arr.some(function(value) {
    console.log(value)
    return value == 4
})
console.log(arr, result)
```

**every() è¿”å›booleanï¼Œåˆ¤æ–­æ¯ä¸ªå…ƒç´ éƒ½ç¬¦åˆfuncæ¡ä»¶**

```js
let result = arr.every(function(value) {
    console.log(value)
    return value == 2
})
console.log(arr, result)
```

åŒæ ·å®Œæˆåˆšæ‰çš„ç›®æ ‡ï¼Œä½¿ç”¨ every éå†å°±å¯ä»¥åšåˆ° break é‚£æ ·çš„æ•ˆæœï¼Œç®€å•çš„è¯´ return false ç­‰åŒäº breakï¼Œreturn true ç­‰åŒäº continueã€‚å¦‚æœä¸å†™ï¼Œé»˜è®¤æ˜¯ return falseã€‚

æ³¨æ„

every çš„ä»£ç å—ä¸­ä¸èƒ½ä½¿ç”¨ breakã€continueï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

**reduce() æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºç´¯åŠ å™¨**

```js
let sum = arr.reduce(function(prev, cur, index, array) {
    return prev + cur
}, 0)
console.log(sum)
let max = arr.reduce(function(prev, cur) {
    return Math.max(prev, cur)
})
console.log(max)
let res = arr.reduce(function(prev, cur) {
    prev.indexOf(cur) == -1 && prev.push(cur)
    return prev
}, [])
console.log(res)
```

æœ‰çš„åŒå­¦ä¼šè¯´ï¼Œè¿˜æœ‰ for...in å¯ä»¥éå†æ•°ç»„ã€‚

```js
for (var index in array) {
    console.log(array[index]);
}
```

è¯´çš„æ²¡é”™ï¼Œfor...in ç¡®å®å¯ä»¥éå†æ•°ç»„ï¼Œè€Œä¸”è¿˜æ”¯æŒ continueã€breakç­‰åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒçœŸçš„æ²¡æœ‰ç‘•ç–µå—ï¼Ÿå¦‚æœ array æœ‰è‡ªå®šä¹‰å±æ€§ï¼Œä½ å‘ç°ä¹Ÿä¼šè¢«éå†å‡ºæ¥(æ˜¾ç„¶ä¸åˆç†)ã€‚è¿™æ˜¯å› ä¸º for...in æ˜¯ä¸ºéå†å¯¹è±¡åˆ›é€ çš„ï¼ˆ{a:1, b:2}ï¼‰ï¼Œä¸æ˜¯ä¸ºæ•°ç»„è®¾è®¡çš„ã€‚

>æ³¨æ„
>
>for...inä¸èƒ½ç”¨äºéå†æ•°ç»„ã€‚
>for...inä»£ç å—ä¸­ä¸èƒ½æœ‰ returnï¼Œä¸ç„¶ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

#### 15.2.ES6ä¸­çš„æ•°ç»„éå†æ–¹å¼

**Array.prototype.find()**

find() æ‰¾å‡ºç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶è¿”å›trueçš„å…ƒç´ ï¼Œå¦åˆ™è¿”å› undefinedã€‚

```js
let array = [5, 12, 8, 130, 44];

let found = array.find(function(element) {
    return element > 10;
});

console.log(found);
// 12
```

**è¯­æ³•ï¼š**`arr.find(callback[, thisArg])`

|   å‚æ•°   |                             å«ä¹‰                             | å¿…é€‰ |
| :------: | :----------------------------------------------------------: | :--: |
| callback | åœ¨æ•°ç»„æ¯ä¸€é¡¹ä¸Šæ‰§è¡Œçš„å‡½æ•°ï¼Œæ¥æ”¶ 3 ä¸ªå‚æ•°ï¼Œelementã€indexã€array |  Y   |
| thisArg  |                  æ‰§è¡Œå›è°ƒæ—¶ç”¨ä½œ this çš„å¯¹è±¡                  |  N   |

**Array.prototype.findIndex()**

findIndex()æ–¹æ³•æ‰¾å‡ºç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶è¿”å›trueçš„å…ƒç´ ä¸‹æ ‡ã€‚å¦åˆ™è¿”å›-1ã€‚å…¶å®è¿™ä¸ªå’Œ find() æ˜¯æˆå¯¹çš„ï¼Œä¸åŒçš„æ˜¯å®ƒè¿”å›çš„æ˜¯ç´¢å¼•è€Œä¸æ˜¯å€¼ã€‚

```js
let array = [5, 12, 8, 130, 44];

let found = array.find(function(element) {
    return element > 10;
});

console.log(found);
// 1
```

**è¯­æ³•ï¼š**`arr.findIndex(callback[, thisArg])`

|   å‚æ•°   |                             å«ä¹‰                             | å¿…é€‰ |
| :------: | :----------------------------------------------------------: | :--: |
| callback | åœ¨æ•°ç»„æ¯ä¸€é¡¹ä¸Šæ‰§è¡Œçš„å‡½æ•°ï¼Œæ¥æ”¶ 3 ä¸ªå‚æ•°ï¼Œelementã€indexã€array |  Y   |
| thisArg  |                  æ‰§è¡Œå›è°ƒæ—¶ç”¨ä½œ this çš„å¯¹è±¡                  |  N   |

**for...of**

```js
for (let val of [1, 2, 3]) {
    console.log(val);
}
// 1,2,3
```

ä¸Šè¿°ä»£ç ä¸­è½»æ¾å®ç°äº†æ•°ç»„çš„éå†ï¼Œä¹ä¸€çœ‹æ²¡æœ‰ç»å¯¹å®ƒæœ‰éå¸¸å¼ºå¤§ä¹‹å¤„ã€‚æˆ‘ä»¬ä¸å¾—ä¸å¼ºè°ƒä¸‹ï¼Œfor...of çš„æ¥å†å’Œä½œç”¨ã€‚

```js
for (variable of iterable) {

}
```

çœ‹ä¸‹è¿™ä¸ªä¼ªä»£ç ï¼Œof åé¢æ˜¯ iterable æ—¢ä¸æ˜¯ for å¾ªç¯è§„å®šçš„ arrayï¼Œä¹Ÿä¸æ˜¯ for...in è§„å®šçš„ Objectï¼Œè€Œæ˜¯ iterableã€‚å¦‚æœæŸ¥æŸ¥ iterable çš„å«ä¹‰å°±å¾ˆç›´è§‚çš„æ„Ÿå—åˆ° for...of éå†çš„æ˜¯ä¸€åˆ‡å¯éå†çš„å…ƒç´ ï¼ˆæ•°ç»„ã€å¯¹è±¡ã€é›†åˆï¼‰ç­‰ï¼Œä¸è¦å°ç§è¿™ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºåœ¨ ES6 ä¸­å…è®¸å¼€å‘è€…è‡ªå®šä¹‰éå†ï¼Œæ¢å¥è¯è¯´ä»»ä½•æ•°æ®ç»“æ„éƒ½å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªéå†ï¼Œè¿™ä¸ªéå†æ˜¯ä¸èƒ½è¢« forã€for...in ç†è§£å’Œå®ç°çš„ã€‚å¾ˆæŠ½è±¡å§ï¼ŸIterator æ˜¯å¦‚ä½•å®ç°çš„è¿™æ˜¯ES6çš„æ–°å¢è¯­æ³•ï¼Œåé¢è¯¾ç¨‹ä¸­ `Iterator` ä¸€èŠ‚ä¼šè®²ã€‚

```js
for (let item of arr) {
    console.log(item)
}

for (let item of arr.values()) {
    console.log(item)
}

for (let item of arr.keys()) {
    console.log(item)
}

for (let [index, item] of arr.entries()) {
    console.log(index, item)
}
```

TIP

for...ofæ˜¯æ”¯æŒ breakã€continueã€returnçš„ï¼Œæ‰€ä»¥åœ¨åŠŸèƒ½ä¸Šéå¸¸è´´è¿‘åŸç”Ÿçš„ forã€‚

**values()**

```
const arr = [0, 1, 2, 4]

for(let index of arr.keys()) { 
  console.log(index) // 0, 1, 2, 4
}
```

**keys()**

```
const arr = [0, 1, 2, 4]

for(let index of arr.keys()) { 
  console.log(index) // 0, 1, 2, 3
}
```

**entries()**

```
const arr = [0, 1, 2, 4]

for(let [index, item] of arr.entries()) {
  console.log(item + '--' + index)
}
```

#### 15.3.æ•°ç»„æ–¹æ³•çš„æ‰©å±•

**1.Array.fromï¼šå°†ä¼ªæ•°ç»„è½¬æ¢ä¸ºæ•°ç»„**

* ä¼ªæ•°ç»„ï¼šé€‰æ‹©å™¨ï¼ˆquerySelectAllï¼ŒgetElementByNamesï¼ŒgetElementByClassNames...ï¼‰ï¼Œargumentså±æ€§

ES5

```
let args = [].slice.call(arguments);
let imgs = [].slice.call(document.querySelectorAll('img'));
```

ES6

```
function fun () {
	Array.from(arguments).forEach((item) => {
		console.log(item)
	})
}
fun(1, 3, 45)
```

**æƒŠå–œ**

éš¾é“ Array.from åªèƒ½ç”¨æ¥å°†ä¼ªæ•°ç»„è½¬æ¢æˆæ•°ç»„å—ï¼Œè¿˜æœ‰å…¶ä»–ç”¨æ³•å—ï¼Ÿè¿™è¦æ¥çœ‹ä¸‹ Array.from çš„å‡ ä¸ªå‚æ•°ï¼š

**è¯­æ³•ï¼š**`Array.from(arrayLike[, mapFn[, thisArg]])`

|   å‚æ•°    |                         å«ä¹‰                         | å¿…é€‰ |
| :-------: | :--------------------------------------------------: | :--: |
| arrayLike |        æƒ³è¦è½¬æ¢æˆæ•°ç»„çš„ä¼ªæ•°ç»„å¯¹è±¡æˆ–å¯è¿­ä»£å¯¹è±¡        |  Y   |
|   mapFn   | å¦‚æœæŒ‡å®šäº†è¯¥å‚æ•°ï¼Œæ–°æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä¼šæ‰§è¡Œè¯¥å›è°ƒå‡½æ•° |  N   |
|  thisArg  |      å¯é€‰å‚æ•°ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•° mapFn æ—¶ this å¯¹è±¡       |  N   |

çœ‹äº†è¿™å‡ ä¸ªå‚æ•°è‡³å°‘èƒ½çœ‹åˆ° Array.from è¿˜å…·å¤‡ map çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³åˆå§‹åŒ–ä¸€ä¸ªé•¿åº¦ä¸º 5 çš„æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ é»˜è®¤ä¸º 1ï¼Œä¹‹å‰çš„åšæ³•æ˜¯è¿™æ ·çš„ï¼š

```js
let arr = Array(6).join(' ').split('').map(item => 1)
// [1,1,1,1,1]
```

è¿™æ ·å†™è™½ç„¶ä¹Ÿèƒ½å®ç°ï¼Œä½†æ˜¯ç”¨èµ·æ¥æ¯”è¾ƒç¹çï¼Œä½¿ç”¨ Array.from å°±ä¼šç®€æ´å¾ˆå¤šã€‚

```js
Array.from({
    length: 5
}, function() {
    return 1
})
```

è¿™ä¸ªä»£ç çœ‹èµ·æ¥æ—¢ç®€æ´è¿˜å®¹æ˜“ç†è§£

**2.Array.of()ï¼šå°†ä¸€ç³»åˆ—å€¼è½¬æ¢ä¸ºæ•°ç»„**

```
let arr = Array.of("jack", 12)
console.log(arr) ["jack", 12]
```

* ç›¸æ¯”äºnew Arrayï¼ˆï¼‰çš„æ–¹å¼åˆ›å»ºæ•°ç»„ï¼Œåœ¨åªæœ‰ä¸€ä¸ªæ•°å­—çš„æ—¶å€™ï¼Œnew Arrayä»£è¡¨çš„æ˜¯é•¿åº¦ï¼Œè€ŒArray.ofä»£è¡¨çš„æ˜¯æ•°ç»„å€¼ã€‚

```
new Array(3) // [ , , ]
Array.of(3) // [3]
```

**3.Array.prototype.fill()**

fill() æ–¹æ³•ç”¨ä¸€ä¸ªå›ºå®šå€¼å¡«å……ä¸€ä¸ªæ•°ç»„ä¸­ä»èµ·å§‹ç´¢å¼•åˆ°ç»ˆæ­¢ç´¢å¼•å†…çš„å…¨éƒ¨å…ƒç´ ã€‚ä¸åŒ…æ‹¬ç»ˆæ­¢ç´¢å¼•ã€‚

```js
let array = [1, 2, 3, 4]
array.fill(0, 1, 2)
// [1,0,3,4]
```

è¿™ä¸ªæ“ä½œæ˜¯å°† array æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆç´¢å¼•ä¸º1ï¼‰åˆ°ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼ˆç´¢å¼•ä¸º2ï¼‰å†…çš„æ•°å¡«å……ä¸º 0ï¼Œä¸åŒ…æ‹¬ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥ç»“æœæ˜¯ [1, 0, 3, 4]

æˆ‘ä»¬å‰é¢æœ‰æåˆ°ç”¨ Array.from åˆå§‹åŒ–ä¸ºä¸€ä¸ªé•¿åº¦å›ºå®šï¼Œå…ƒç´ ä¸ºæŒ‡å®šå€¼çš„æ•°ç»„ã€‚å¦‚æœç”¨ fill æ˜¯å¦å¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœå‘¢ï¼Ÿ

```js
Array(5).fill(1)
// [1,1,1,1,1]
```

**4.Array.prototype.copyWithin()**

åœ¨å½“å‰æ•°ç»„å†…éƒ¨ï¼Œå°†æŒ‡å®šä½ç½®çš„æˆå‘˜å¤åˆ¶åˆ°å…¶ä»–ä½ç½®ï¼ˆä¼šè¦†ç›–åŸæœ‰æˆå‘˜ï¼‰ï¼Œç„¶åè¿”å›å½“å‰æ•°ç»„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¼šä¿®æ”¹å½“å‰æ•°ç»„ã€‚

**è¯­æ³•ï¼š**`arr.copyWithin(target, start = 0, end = this.length)`

|  å‚æ•°  |                             å«ä¹‰                             | å¿…é€‰ |
| :----: | :----------------------------------------------------------: | :--: |
| target |          ä»è¯¥ä½ç½®å¼€å§‹æ›¿æ¢æ•°æ®ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºå€’æ•°          |  Y   |
| start  | ä»è¯¥ä½ç½®å¼€å§‹è¯»å–æ•°æ®ï¼Œé»˜è®¤ä¸º 0ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä»æœ«å°¾å¼€å§‹è®¡ç®— |  N   |
|  end   | åˆ°è¯¥ä½ç½®å‰åœæ­¢è¯»å–æ•°æ®ï¼Œé»˜è®¤ç­‰äºæ•°ç»„é•¿åº¦ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä»æœ«å°¾å¼€å§‹è®¡ç®— |  N   |

```js
let arr = [1, 2, 3, 4, 5]
console.log(arr.copyWithin(1, 3))
// [1, 4, 5, 4, 5]
```

**5.Array.prototype.includes()**

åœ¨ ES7 ä¹‹å‰æƒ³åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼ŒåŸºæœ¬å¯ä»¥è¿™æ ·å†™ï¼š

```js
console.log(array1.find(function(item) {
    return item === 2
}))
```

æˆ–è€…

```js
console.log(array1.filter(function(item) {
    return item === 2
}).length > 0)
```

ES7å¼•å…¥çš„Array.prototype.includes() æ–¹æ³•ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œæ ¹æ®æƒ…å†µï¼Œå¦‚æœåŒ…å«åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å›falseã€‚

**åŸºæœ¬ç”¨æ³•**

```js
const arr = ['es6', 'es7', 'es8']
console.log(arr.includes('es6')) // true
console.log(arr.includes('es9')) // false
```

**æ¥æ”¶ä¿©ä¸ªå‚æ•°**

è¦æœç´¢çš„å€¼å’Œæœç´¢çš„å¼€å§‹ç´¢å¼•ã€‚ç¬¬äºŒä¸ªå‚æ•°å¯é€‰ã€‚ä»è¯¥ç´¢å¼•å¤„å¼€å§‹æŸ¥æ‰¾ searchElementã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œ

```js
const arr = ['es6', 'es7', 'es8']
console.log(arr.includes('es7', 1)) // true
console.log(arr.includes('es7', 2)) // false
console.log(arr.includes('es7', -1)) // false
console.log(arr.includes('es7', -2)) // true
```

**ä¸indexOf()æ¯”è¾ƒ**

```js
['a', 'b', 'c'].includes('a') //true
['a', 'b', 'c'].indexOf('a') > -1 //true

console.log(arr.indexOf('es7')) // 1
console.log(arr.indexOf('es7') > -1) // true
```

æ³¨æ„

åªèƒ½åˆ¤æ–­ç®€å•ç±»å‹çš„æ•°æ®ï¼Œå¯¹äºå¤æ‚ç±»å‹çš„æ•°æ®ï¼Œæ¯”å¦‚å¯¹è±¡ç±»å‹çš„æ•°ç»„ï¼ŒäºŒç»´æ•°ç»„ï¼Œè¿™äº›æ˜¯æ— æ³•åˆ¤æ–­çš„.

```js
const arr = [1, [2, 3], 4]
arr.includes([2, 3]) //false
arr.indexOf([2, 3]) //-1
```

**ä¼˜ç¼ºç‚¹æ¯”è¾ƒ**

ä¸¤è€…éƒ½æ˜¯é‡‡ç”¨===çš„æ“ä½œç¬¦æ¥ä½œæ¯”è¾ƒçš„ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼šå¯¹äºNaNçš„å¤„ç†ç»“æœä¸åŒã€‚æˆ‘ä»¬çŸ¥é“jsä¸­ NaN === NaN çš„ç»“æœæ˜¯false, indexOf()ä¹Ÿæ˜¯è¿™æ ·å¤„ç†çš„ï¼Œä½†æ˜¯includes()ä¸æ˜¯è¿™æ ·çš„ã€‚

```js
const demo = [1, NaN, 2, 3]
demo.indexOf(NaN) //-1
demo.includes(NaN) //true
```

æ€»ç»“

å¦‚æœåªæƒ³çŸ¥é“æŸä¸ªå€¼æ˜¯å¦åœ¨æ•°ç»„ä¸­å­˜åœ¨ï¼Œè€Œå¹¶ä¸å…³å¿ƒå®ƒçš„ç´¢å¼•ä½ç½®ï¼Œå»ºè®®ä½¿ç”¨includes()ã€‚å¦‚æœæƒ³è·å–ä¸€ä¸ªå€¼åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œé‚£ä¹ˆåªèƒ½ä½¿ç”¨indexOfæ–¹æ³•ã€‚

### 06.æ­£åˆ™çš„æ‰©å±•

#### 6.1.yä¿®é¥°ç¬¦

ES6ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ·»åŠ äº†yä¿®é¥°ç¬¦ï¼Œå«åšâ€œç²˜è¿â€ï¼ˆstickyï¼‰ä¿®é¥°ç¬¦ã€‚

yä¿®é¥°ç¬¦çš„ä½œç”¨ä¸gä¿®é¥°ç¬¦ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å…¨å±€åŒ¹é…ï¼Œåä¸€æ¬¡åŒ¹é…éƒ½ä»ä¸Šä¸€æ¬¡åŒ¹é…æˆåŠŸçš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œgä¿®é¥°ç¬¦åªè¦å‰©ä½™ä½ç½®ä¸­å­˜åœ¨åŒ¹é…å°±å¯ï¼Œè€Œyä¿®é¥°ç¬¦ç¡®ä¿åŒ¹é…å¿…é¡»ä»å‰©ä½™çš„ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ï¼Œè¿™ä¹Ÿå°±æ˜¯â€œç²˜è¿â€çš„æ¶µä¹‰ã€‚

```js
const s = 'aaa_aa_a'
const r1 = /a+/g
const r2 = /a+/y

r1.exec(s) // ["aaa"]
r2.exec(s) // ["aaa"]

r1.exec(s) // ["aa"]
r2.exec(s) // null
```

ä¸Šé¢ä»£ç æœ‰ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸€ä¸ªä½¿ç”¨gä¿®é¥°ç¬¦ï¼Œå¦ä¸€ä¸ªä½¿ç”¨yä¿®é¥°ç¬¦ã€‚è¿™ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼å„æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸¤è€…è¡Œä¸ºç›¸åŒï¼Œå‰©ä½™å­—ç¬¦ä¸²éƒ½æ˜¯_aa_aã€‚ç”±äºgä¿®é¥°æ²¡æœ‰ä½ç½®è¦æ±‚ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡æ‰§è¡Œä¼šè¿”å›ç»“æœï¼Œè€Œyä¿®é¥°ç¬¦è¦æ±‚åŒ¹é…å¿…é¡»ä»å¤´éƒ¨å¼€å§‹ï¼Œæ‰€ä»¥è¿”å›nullã€‚

å¦‚æœæ”¹ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¿è¯æ¯æ¬¡éƒ½èƒ½å¤´éƒ¨åŒ¹é…ï¼Œyä¿®é¥°ç¬¦å°±ä¼šè¿”å›ç»“æœäº†ã€‚

```js
const s = 'aaa_aa_a'
const r = /a+_/y

r.exec(s) // ["aaa_"]
r.exec(s) // ["aa_"]
```

ä¸Šé¢ä»£ç æ¯æ¬¡åŒ¹é…ï¼Œéƒ½æ˜¯ä»å‰©ä½™å­—ç¬¦ä¸²çš„å¤´éƒ¨å¼€å§‹ã€‚

ä½¿ç”¨lastIndexå±æ€§ï¼Œå¯ä»¥æ›´å¥½åœ°è¯´æ˜yä¿®é¥°ç¬¦ã€‚

```js
const regexp = /a/g

// æŒ‡å®šä»2å·ä½ç½®ï¼ˆyï¼‰å¼€å§‹åŒ¹é…
regexp.lastIndex = 2

// åŒ¹é…æˆåŠŸ
const match = regexp.exec('xaya')

// åœ¨3å·ä½ç½®åŒ¹é…æˆåŠŸ
console.log(match.index) // 3

// ä¸‹ä¸€æ¬¡åŒ¹é…ä»4å·ä½å¼€å§‹
console.log(regexp.lastIndex) // 4

// 4å·ä½å¼€å§‹åŒ¹é…å¤±è´¥
regexp.exec('xaxa') // null
```

ä¸Šé¢ä»£ç ä¸­ï¼ŒlastIndexå±æ€§æŒ‡å®šæ¯æ¬¡æœç´¢çš„å¼€å§‹ä½ç½®ï¼Œgä¿®é¥°ç¬¦ä»è¿™ä¸ªä½ç½®å¼€å§‹å‘åæœç´¢ï¼Œç›´åˆ°å‘ç°åŒ¹é…ä¸ºæ­¢ã€‚

yä¿®é¥°ç¬¦åŒæ ·éµå®ˆlastIndexå±æ€§ï¼Œä½†æ˜¯è¦æ±‚å¿…é¡»åœ¨lastIndexæŒ‡å®šçš„ä½ç½®å‘ç°åŒ¹é…ã€‚

```js
const regexp = /a/y

// æŒ‡å®šä»2å·ä½ç½®å¼€å§‹åŒ¹é…
regexp.lastIndex = 2

// ä¸æ˜¯ç²˜è¿ï¼ŒåŒ¹é…å¤±è´¥
regexp.exec('xaya') // null

// æŒ‡å®šä»3å·ä½ç½®å¼€å§‹åŒ¹é…
regexp.lastIndex = 3

// 3å·ä½ç½®æ˜¯ç²˜è¿ï¼ŒåŒ¹é…æˆåŠŸ
const match = regexp.exec('xaxa')
console.log(match.index) // 3
console.log(regexp.lastIndex) // 4
```

è¿›ä¸€æ­¥è¯´ï¼Œyä¿®é¥°ç¬¦å·éšå«äº†å¤´éƒ¨åŒ¹é…çš„æ ‡å¿—^ã€‚

```js
const reg = /b/y
reg.exec('aba')
// null
console.log(reg.lastIndex)
```

TIP

sticky æ¨¡å¼åœ¨æ­£åˆ™åŒ¹é…è¿‡ç¨‹ä¸­åªä¼šå½±å“ä¸¤ä»¶äº‹ï¼š

- åŒ¹é…å¿…é¡»ä» re.lastIndex å¼€å§‹ï¼ˆç›¸å½“äºæ­£åˆ™è¡¨è¾¾ä¸­çš„ ^ï¼‰
- å¦‚æœåŒ¹é…åˆ°ä¼šä¿®æ”¹ re.lastIndexï¼ˆç›¸å½“äº g æ¨¡å¼ï¼‰

#### 6.2.uä¿®é¥°ç¬¦

ES6ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ·»åŠ äº†uä¿®é¥°ç¬¦ï¼Œå«ä¹‰ä¸ºâ€œUnicodeæ¨¡å¼â€ï¼Œç”¨æ¥æ­£ç¡®å¤„ç†å¤§äº `\uFFFF` çš„Unicodeå­—ç¬¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šæ­£ç¡®å¤„ç†å››ä¸ªå­—èŠ‚çš„UTF-16ç¼–ç ã€‚

```js
/^\uD83D/u.test('\uD83D\uDC2A') // false

    /
    ^ \uD83D / .test('\uD83D\uDC2A') // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ `\uD83D\uDC2A` æ˜¯ä¸€ä¸ªå››ä¸ªå­—èŠ‚çš„UTF-16ç¼–ç ï¼Œä»£è¡¨ä¸€ä¸ªå­—ç¬¦ "ğŸª"ã€‚ä½†æ˜¯ï¼ŒES5ä¸æ”¯æŒå››ä¸ªå­—èŠ‚çš„UTF-16ç¼–ç ï¼Œä¼šå°†å…¶è¯†åˆ«ä¸ºä¸¤ä¸ªå­—ç¬¦ï¼Œå¯¼è‡´ç¬¬äºŒè¡Œä»£ç ç»“æœä¸ºtrueã€‚åŠ äº†uä¿®é¥°ç¬¦ä»¥åï¼ŒES6å°±ä¼šè¯†åˆ«å…¶ä¸ºä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç¬¬ä¸€è¡Œä»£ç ç»“æœä¸ºfalseã€‚

ä¸€æ—¦åŠ ä¸Šuä¿®é¥°ç¬¦å·ï¼Œå°±ä¼šä¿®æ”¹ä¸‹é¢è¿™äº›æ­£åˆ™è¡¨è¾¾å¼çš„è¡Œä¸ºã€‚

**(1) ç‚¹å­—ç¬¦**

ç‚¹ï¼ˆ.ï¼‰å­—ç¬¦åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå«ä¹‰æ˜¯é™¤äº†æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦ã€‚å¯¹äºç ç‚¹å¤§äº 0xFFFF çš„ Unicode å­—ç¬¦ï¼Œç‚¹å­—ç¬¦ä¸èƒ½è¯†åˆ«ï¼Œå¿…é¡»åŠ ä¸Šuä¿®é¥°ç¬¦ã€‚

```js
let s = 'ğ ®·'

    /
    ^ .$ / .test(s) // false

    /
    ^ .$ / u.test(s) // true
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœä¸æ·»åŠ uä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼å°±ä¼šè®¤ä¸ºå­—ç¬¦ä¸²ä¸ºä¸¤ä¸ªå­—ç¬¦ï¼Œä»è€ŒåŒ¹é…å¤±è´¥ã€‚

TIP

'ğ ®·'è¿™ä¸ªå­—è¯» jÃ­ï¼Œæ˜¯'å‰'å­—çš„å¼‚å½¢ä½“ï¼ŒUnicode ç ç‚¹ [U+20BB7](https://www.fileformat.info/info/unicode/char/20bb7/index.htm)

**(2) Unicodeå­—ç¬¦è¡¨ç¤ºæ³•**

ES6æ–°å¢äº†ä½¿ç”¨å¤§æ‹¬å·è¡¨ç¤ºUnicodeå­—ç¬¦ï¼Œè¿™ç§è¡¨ç¤ºæ³•åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­å¿…é¡»åŠ ä¸Šuä¿®é¥°ç¬¦ï¼Œæ‰èƒ½è¯†åˆ«ã€‚

```js
/\u{61}/.test('a') // false

    /
    \u {
        61
    }
/u.test('a') / / true

    /
    \u {
        20 BB7
    }
/u.test('ğ ®·') / / true
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœä¸åŠ uä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ— æ³•è¯†åˆ«\u{61}è¿™ç§è¡¨ç¤ºæ³•ï¼Œåªä¼šè®¤ä¸ºè¿™åŒ¹é…61ä¸ªè¿ç»­çš„uã€‚

**(3) é‡è¯**

ä½¿ç”¨uä¿®é¥°ç¬¦åï¼Œæ‰€æœ‰é‡è¯éƒ½ä¼šæ­£ç¡®è¯†åˆ«ç ç‚¹å¤§äº0xFFFFçš„Unicodeå­—ç¬¦ã€‚

```js
/a{2}/.test('aa') // true

    /
    a {
        2
    }
/u.test('aa') / / true

    /
    ğ ®·{
        2
    }
/.test('ğ ®·ğ ®·') / / false

    /
    ğ ®·{
        2
    }
/u.test('ğ ®·ğ ®·') / / true
```

å¦å¤–ï¼Œåªæœ‰åœ¨ä½¿ç”¨uä¿®é¥°ç¬¦çš„æƒ…å†µä¸‹ï¼ŒUnicodeè¡¨è¾¾å¼å½“ä¸­çš„å¤§æ‹¬å·æ‰ä¼šè¢«æ­£ç¡®è§£è¯»ï¼Œå¦åˆ™ä¼šè¢«è§£è¯»ä¸ºé‡è¯ã€‚

```js
/^\u{3}$/.test('uuu') // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºæ­£åˆ™è¡¨è¾¾å¼æ²¡æœ‰uä¿®é¥°ç¬¦ï¼Œæ‰€ä»¥å¤§æ‹¬å·è¢«è§£è¯»ä¸ºé‡è¯ã€‚åŠ ä¸Šuä¿®é¥°ç¬¦ï¼Œå°±ä¼šè¢«è§£è¯»ä¸ºUnicodeè¡¨è¾¾å¼ã€‚

```js
/\u{20BB7}{2}/u.test('ğ ®·ğ ®·') // true
```

ä½¿ç”¨ u ä¿®é¥°ç¬¦ä¹‹å Unicode è¡¨è¾¾å¼+é‡è¯ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

**(4) é¢„å®šä¹‰æ¨¡å¼**

uä¿®é¥°ç¬¦ä¹Ÿå½±å“åˆ°é¢„å®šä¹‰æ¨¡å¼ï¼Œèƒ½å¦æ­£ç¡®è¯†åˆ«ç ç‚¹å¤§äº0xFFFFçš„Unicodeå­—ç¬¦ã€‚

```js
/^\S$/.test('ğ ®·') // false

    /
    ^ \S$ / u.test('ğ ®·') // true
```

ä¸Šé¢ä»£ç çš„\Sæ˜¯é¢„å®šä¹‰æ¨¡å¼ï¼ŒåŒ¹é…æ‰€æœ‰ä¸æ˜¯ç©ºæ ¼çš„å­—ç¬¦ã€‚åªæœ‰åŠ äº†uä¿®é¥°ç¬¦ï¼Œå®ƒæ‰èƒ½æ­£ç¡®åŒ¹é…ç ç‚¹å¤§äº0xFFFFçš„Unicodeå­—ç¬¦ã€‚

åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå¯ä»¥å†™å‡ºä¸€ä¸ªæ­£ç¡®è¿”å›å­—ç¬¦ä¸²é•¿åº¦çš„å‡½æ•°ã€‚

```js
function codePointLength(text) {
    const result = text.match(/[\s\S]/gu)
    return result ? result.length : 0
}

const s = 'ğ ®·ğ ®·'

s.length // 4
codePointLength(s) // 2
```

**(5) iä¿®é¥°ç¬¦**

æœ‰äº›Unicodeå­—ç¬¦çš„ç¼–ç ä¸åŒï¼Œä½†æ˜¯å­—å‹å¾ˆç›¸è¿‘ï¼Œæ¯”å¦‚ï¼Œ\u004Bä¸\u212Aéƒ½æ˜¯å¤§å†™çš„Kã€‚

```js
/[a-z]/i.test('\u212A') // false

    /
    [a - z] / iu.test('\u212A') // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œä¸åŠ uä¿®é¥°ç¬¦ï¼Œå°±æ— æ³•è¯†åˆ«éè§„èŒƒçš„Kå­—ç¬¦

### 07.å¯¹è±¡çš„æ‰©å±•

#### 7.1.å¯¹è±¡å±æ€§ã€æ–¹æ³•ç®€å†™

```
let x = 3;
let y = 5;
//æ™®é€šé¢å†™æ³•
let obj = {
    x : x,
    y : y,
    getPoint : function () {
    	return this.x + this.y
    }
};

//ç®€åŒ–çš„å†™æ³•
let obj = {
    x,
    y,
    getPoint () {
    	return this.x
    }
};
console.log(obj, obj.getPoint());
```

* å¯¹è±¡ä¸­çš„æ–¹æ³•ä¸é€‚åˆä½¿ç”¨ç®­å¤´å‡½æ•°

#### 7.2.å±æ€§è®¡ç®—å€¼

```
let s = 'school'
const obj = {
	[s] : 'æ¸…åå¤§å­¦'
}
```

#### 7.3.Object.is(v1, v2)

åˆ¤æ–­ä¸¤ä¸ªæ•°æ®æ˜¯å¦å®Œå…¨ç›¸ç­‰

```
console.log(0 == -0) // true
console.log(NaN == NaN) // false
console.log(Object.is(0, -0)) // false
console.log(Object.is(NaN, NaN)) // true
```

* è·Ÿå…¨ç­‰å·â€˜===â€™çš„åŒºåˆ«æ˜¯NaNå’Œ0çš„åˆ¤æ–­

#### 7.4.Object.assign(target, source1, source2...)

å°†æºå¯¹è±¡çš„å±æ€§å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ä¸Š

```
let obj = {}
let obj2 = {name: "jack", age: 12}
let obj3 = {salary: 30000}
Object.assign(obj, obj2, obj3)
console.log(obj) // {name: "jack", age: 12, salary: 30000}
```

#### 7.5.å¯¹è±¡éå†

1.for...inï¼ˆES5ï¼‰

```
const obj = {
	name: 'chh',
	age: 18,
	school: 'æ¸…å'
}
for(let key in obj) {
	console.log(key, obj[key])
}
```

2.Object.keys()

```
Object.keys(obj).forEach(key => {
	console.log(key, obj[key])
})
```

3.Object.getOwnPropertyNames

```
Object.getOwnPropertyNames(obj).forEach(key => {
	console.log(key, obj[key])
})
```

4.Reflect.ownKeys()

```
Reflect.ownKeys(obj).forEach(key => {
	console.log(key, obj[key])
})
```

#### 7.6.æ‹“å±•è¿ç®—ç¬¦

```
const obj = {
	name: 'chh',
	age: 18,
	school: 'æ¸…å'
}

const obj2 = {
	emale: '10010',
	...obj
}
console.log(obj2)
```

#### 7.7.in

```
const obj = {
	name: 'chh',
	age: 18,
	school: 'æ¸…å'
}
console.log(name in obj)

let arr = ['chh', 'yxc', 'rose']
console.log(1 in arr)  //true
```

* æ•°ç»„ä¸­çš„inè¡¨ç¤ºè¯¥ç´¢å¼•ä½ç½®æ˜¯å¦æœ‰å€¼

#### 7.8.æ·±æ‹·è´å’Œæµ…æ‹·è´

* æµ…æ‹·è´ï¼šä¼šå¤åˆ¶å¼•ç”¨çš„æ‹·è´æ–¹æ³•ç§°ä¸ºæµ…æ‹·è´
* æ·±æ‹·è´ï¼šæŒ‡å®Œå…¨çš„æ‹·è´ä¸€ä¸ªå¯¹è±¡ï¼Œå³ä½¿åµŒå¥—äº†å¯¹è±¡ï¼Œä¸¤è€…ä¹Ÿç›¸äº’åˆ†ç¦»ï¼Œä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œä¹Ÿä¸ä¼šå½±å“å¦ä¸€ä¸ª

**æµ…æ‹·è´**ï¼š   

1.æ•°ç»„

* slice
* concat

```
var arr = ['old', 1, true, null, undefined];

var new_arr = arr.concat();

new_arr[0] = 'new';

console.log(arr) // ["old", 1, true, null, undefined]
console.log(new_arr) // ["new", 1, true, null, undefined]

var new_arr = arr.slice();
```

2.å¯¹è±¡

* Object.assign

æ·±æ‹·è´**ï¼š

* JSON.parse( JSON.stringify() )

>ç¼ºç‚¹ï¼š1.ä¸èƒ½æ‹·è´å‡½æ•°

**æµ…æ‹·è´å®ç°**

```
var shallowCopy = function(obj) {
    // åªæ‹·è´å¯¹è±¡
    if (typeof obj !== 'object') return;
    // æ ¹æ®objçš„ç±»å‹åˆ¤æ–­æ˜¯æ–°å»ºä¸€ä¸ªæ•°ç»„è¿˜æ˜¯å¯¹è±¡
    var newObj = obj instanceof Array ? [] : {};
    // éå†objï¼Œå¹¶ä¸”åˆ¤æ–­æ˜¯objçš„å±æ€§æ‰æ‹·è´
    for (var key in obj) {
        if (obj.hasOwnProperty(key)) {
            newObj[key] = obj[key];
        }
    }
    return newObj;
}
```

**æ·±æ‹·è´å®ç°**

```
var deepCopy = function(obj) {
    if (typeof obj !== 'object') return;
    var newObj = obj instanceof Array ? [] : {};
    for (var key in obj) {
        if (obj.hasOwnProperty(key)) {
            newObj[key] = typeof obj[key] === 'object' ? deepCopy(obj[key]) : obj[key];
        }
    }
    return newObj;
}
```

#### 7.9.é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹

é¢å‘è¿‡ç¨‹ï¼šå½“æˆ‘ä»¬è¦å®Œæˆä¸€ä¸ªéœ€æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬å…³å¿ƒçš„æ˜¯è¦æŠŠè¿™ä¸ªéœ€æ±‚åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤ï¼Œå½“è¿™å‡ ä¸ªæ­¥éª¤å®ç°äº†ï¼Œè¿™ä¸ªéœ€æ±‚å°±å®Œæˆäº†

é¢å‘å¯¹è±¡ï¼šæˆ‘ä»¬ä¼šåˆ†æè¿™ä¸ªéœ€æ±‚å¯ä»¥åˆ†ä¸ºå‡ ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å…·æœ‰å“ªäº›å±æ€§å’Œæ–¹æ³•

ä¸¾ä¸ªä¾‹å­ï¼š

æŠŠä¸€ä¸ªå¤§è±¡è£…è¿›å†°ç®±

* é¢å‘å¯¹è±¡ï¼š1:æ‰“å¼€å†°ç®±ï¼Œ2:æŠŠå†°ç®±è£…è¿›å†°ç®±ï¼Œ3:å…³é—­å†°ç®±
* é¢å‘è¿‡ç¨‹ï¼š1.åˆ†æéœ€æ±‚æœ‰å¤§è±¡å’Œå†°ç®±ä¸¤ä¸ªå¯¹è±¡ï¼Œ2.å¤§è±¡åº”è¯¥æœ‰ä½“ç§¯çš„å±æ€§ï¼Œè£…è¿›å†°ç®±çš„è¡Œä¸ºã€‚å†°ç®±åº”è¯¥æœ‰å®¹é‡çš„å±æ€§ï¼Œæ‰“å¼€å…³é—­çš„è¡Œä¸ºã€‚3.åŸºäºè¿™äº›å±æ€§åˆ¤æ–­å¤§è±¡æ˜¯å¦è¾¾åˆ°æ¡ä»¶ï¼Œå¦‚æœå¯ä»¥åˆ™æ‰“å¼€è£…è¿›å†°ç®±ï¼Œç„¶åå…³é—­ã€‚

### 08.ç®­å¤´å‡½æ•°

1.åŸºæœ¬è¯­æ³•

* æ²¡æœ‰å‚æ•°: () => console.log('xxxx')

* ä¸€ä¸ªå‚æ•°: i => i+2

* å¤§äºä¸€ä¸ªå‚æ•°: (i,j) => i+j

* å‡½æ•°ä½“ä¸ç”¨å¤§æ‹¬å·: é»˜è®¤è¿”å›ç»“æœ

* å‡½æ•°ä½“å¦‚æœæœ‰å¤šä¸ªè¯­å¥, éœ€è¦ç”¨{}åŒ…å›´ï¼Œè‹¥æœ‰éœ€è¦è¿”å›çš„å†…å®¹ï¼Œéœ€è¦æ‰‹åŠ¨è¿”å›

```
let fun = function () {
	console.log('fun()');
};
fun();
//æ²¡æœ‰å½¢å‚ï¼Œå¹¶ä¸”å‡½æ•°ä½“åªæœ‰ä¸€æ¡è¯­å¥
let fun1 = () => console.log('fun1()');
fun1();
console.log(fun1());
//ä¸€ä¸ªå½¢å‚ï¼Œå¹¶ä¸”å‡½æ•°ä½“åªæœ‰ä¸€æ¡è¯­å¥
let fun2 = x => x;
console.log(fun2(5));
//å½¢å‚æ˜¯ä¸€ä¸ªä»¥ä¸Š
let fun3 = (x, y) => x + y;
console.log(fun3(25, 39));//64

//å‡½æ•°ä½“æœ‰å¤šæ¡è¯­å¥
let fun4 = (x, y) => {
	console.log(x, y);
	return x + y;
};
console.log(fun4(34, 48));//82
```

2.ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«ï¼š

* ç®€æ´
* ç®­å¤´å‡½æ•°çš„thisä¸æ˜¯è°ƒç”¨çš„æ—¶å€™å†³å®šçš„ï¼Œç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„thisï¼Œè€Œæ˜¯ä¼šæ²¿ç€ä½œç”¨åŸŸé“¾å‘å¤–å±‚ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œå¦‚æœæœ‰ï¼Œå¤–å±‚å‡½æ•°çš„thiså°±æ˜¯å†…éƒ¨ç®­å¤´å‡½æ•°çš„thisï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™thisæ˜¯windowã€‚

```
let btn = document.getElementById('btn');
//æ²¡æœ‰ç®­å¤´å‡½æ•°
btn.onclick = function () {
	console.log(this);//btn
};
//ç®­å¤´å‡½æ•°
let btn2 = document.getElementById('btn2');

btn2.onclick = function () {
	console.log(this);//btn
};

let obj = {
    name : 'kobe',
    age : 39,
    getName : () => {
    	btn2.onclick = () => {
    		console.log(this);//window
    	};
    }
};
obj.getName();

function Person() {
    this.obj = {
        showThis : () => {
        	console.log(this);
        }
    }
}
let fun5 = new Person();
fun5.obj.showThis();
```

* ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°

```
const People = (name, age) => {
  this.name = name
  this.age = age
}

const people = new People('chh', 18)
//Uncaught TypeError: People is not a constructor
```

* ä¸å¯ä»¥ä½¿ç”¨argumentå¯¹è±¡

```
const fun = (name, age) => {
  console.log(arguments)
}

fun('chh', 12)
// index.html:18 Uncaught ReferenceError: arguments is not defined
```

### 09.æ‰©å±•è¿ç®—ç¬¦å’Œrestå‚æ•°

1.rest(å¯å˜)å‚æ•°ï¼šæŠŠé€—å·éš”å¼€çš„å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼ˆç­‰å·å·¦è¾¹ï¼Œå½¢å‚ï¼‰

* ç”¨æ¥å–ä»£arguments ä½†æ¯”argumentsçµæ´»,åªèƒ½æ˜¯æœ€åéƒ¨åˆ†å½¢å‚å‚æ•°

```
function fun(...values) {
	console.log(arguments);
//  arguments.forEach(function (item, index) {
//       console.log(item, index);
//  });
	
	Array.prototype.forEach.call(argument, (item, index) => {
		console.log(item, index)
	})
	
	console.log(values);
    values.forEach(function (item, index) {
    	console.log(item, index);
    })
}
fun(1,2,3);

const [x, ...arg] = [0, 1, 2]
```

2.æ‰©å±•è¿ç®—ç¬¦ï¼šæŠŠæ•°ç»„æˆ–è€…ç±»æ•°ç»„å±•å¼€æˆç”¨é€—å·éš”å¼€çš„å€¼ï¼ˆç­‰å·å³è¾¹ï¼Œå®å‚ï¼‰

```
let arr1 = [1, 3, 5];
let arr2 = [2, ...arr1, 6];
arr2.push(...arr1);
```

### 10.å‡½æ•°çš„å‚æ•°

#### 7.1.å½¢å‚é»˜è®¤å€¼

* å½“ä¸ä¼ å…¥å‚æ•°çš„æ—¶å€™é»˜è®¤ä½¿ç”¨å½¢å‚é‡Œçš„é»˜è®¤å€¼

ES5

```
//å®šä¹‰ä¸€ä¸ªç‚¹çš„åæ ‡
function Point(x, y) {
    this.x = x || 12;
    this.y = y || 12;
}
æˆ–
function Point(x, y) {
    this.x = x ? x : 12;
    this.y = y ? y : 12;
}
```

* å¦‚æœxå’Œyä¸º0çš„è¯ï¼Œæœ€ç»ˆä¼šè¢«èµ‹å€¼12

ES6

```
//å®šä¹‰ä¸€ä¸ªç‚¹çš„åæ ‡
function Point(x = 12, y = 12) {
    this.x = x;
    this.y = y;
}
let point = new Point(25, 36);
console.log(point);
let p = new Point();
console.log(p);
```

* å‚æ•°çš„é»˜è®¤å€¼æœ€å¥½æ”¾åœ¨æœ€åé¢

#### 7.2.ä¸è§£æ„èµ‹å€¼ç»“åˆ

```
function ajax(url, {
    body = '',
    method = 'GET',
    headers = {}
} = {}) {
    console.log(method)
}

ajax('http://www.imooc.com', {
    method: 'POST'
})
```

#### 7.3.lengthå±æ€§

å‡½æ•°æŒ‡å®šäº†é»˜è®¤å€¼ä»¥åï¼Œå‡½æ•°çš„lengthå±æ€§ï¼Œå°†è¿”å›æ²¡æœ‰æŒ‡å®šé»˜è®¤å€¼çš„å‚æ•°ä¸ªæ•°ã€‚

```js
function foo(x = 1, y = 2, z = 3) {
    console.log(x, y)
}
console.log(foo.length)
// 0
```

#### 7.4.ä½œç”¨åŸŸ

```
let x = 2
function foo1(x = 1, y = x) {
	console.log(y) // 1
}

function foo2(y = x) {
	console.log(y) // 2
}

function foo3(z = y) {
	console.log(z) // æŠ¥é”™
}
```

#### 7.5.å‡½æ•°çš„nameå±æ€§

å‡½æ•°çš„nameå±æ€§ï¼Œè¿”å›è¯¥å‡½æ•°çš„å‡½æ•°åã€‚

```js
function foo() {}

foo.name // "foo"
```

### 11.symbolå±æ€§

#### 10.1.ç†è§£ï¼š

* ES6 å¼•å…¥äº†ä¸€ç§æ–°çš„åŸå§‹ï¼ˆåŸºæœ¬ï¼‰æ•°æ®ç±»å‹ `Symbol` ï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼ã€‚å®ƒæ˜¯ JavaScript è¯­è¨€çš„ç¬¬ä¸ƒç§æ•°æ®ç±»å‹ï¼Œå‰å…­ç§æ˜¯ï¼šundefinedã€nullã€å¸ƒå°”å€¼ï¼ˆBooleanï¼‰ã€å­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€æ•°å€¼ï¼ˆNumberï¼‰ã€å¯¹è±¡ï¼ˆObjectï¼‰ã€‚

  Symbol å€¼é€šè¿‡Symbolå‡½æ•°ç”Ÿæˆã€‚è¿™å°±æ˜¯è¯´ï¼Œå¯¹è±¡çš„å±æ€§åç°åœ¨å¯ä»¥æœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯åŸæ¥å°±æœ‰çš„å­—ç¬¦ä¸²ï¼Œå¦ä¸€ç§å°±æ˜¯æ–°å¢çš„ Symbol ç±»å‹ã€‚å‡¡æ˜¯å±æ€§åå±äº Symbol ç±»å‹ï¼Œå°±éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œå¯ä»¥ä¿è¯ä¸ä¼šä¸å…¶ä»–å±æ€§åäº§ç”Ÿå†²çªã€‚

#### 10.2.ç‰¹ç‚¹ï¼š

* Symbolå±æ€§å¯¹åº”çš„å€¼æ˜¯å”¯ä¸€çš„ï¼Œè§£å†³å‘½åå†²çªé—®é¢˜

* Symbolå€¼ä¸èƒ½ä¸å…¶ä»–æ•°æ®è¿›è¡Œè®¡ç®—ï¼ŒåŒ…æ‹¬åŒå­—ç¬¦ä¸²æ‹¼ä¸²

* for in, for oféå†æ—¶ä¸ä¼šéå†symbolå±æ€§ã€‚

#### 10.3.å£°æ˜æ–¹å¼ï¼š

```js
let s = Symbol()

typeof s
// "symbol"
```

å˜é‡så°±æ˜¯ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å€¼ã€‚typeofçš„ç»“æœè¯´æ˜sæ˜¯ Symbol æ•°æ®ç±»å‹ã€‚

æ—¢ç„¶æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œé‚£ä¹ˆä¸¤ä¸ªSymbol()å°±ä¸€å®šæ˜¯ä¸ç›¸ç­‰çš„ï¼š

```js
let s1 = Symbol()
let s2 = Symbol()
console.log(s1)
console.log(s2)
console.log(s1 === s2) // false
```

>Symbolå‡½æ•°å‰ä¸èƒ½ä½¿ç”¨newå‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºç”Ÿæˆçš„ Symbol æ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹çš„å€¼ï¼Œä¸æ˜¯å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”±äº Symbol å€¼ä¸æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä¸èƒ½æ·»åŠ å±æ€§ã€‚åŸºæœ¬ä¸Šï¼Œå®ƒæ˜¯ä¸€ç§ç±»ä¼¼äºå­—ç¬¦ä¸²çš„æ•°æ®ç±»å‹ã€‚

Symbolå‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºå¯¹ Symbol å®ä¾‹çš„æè¿°ï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨æ§åˆ¶å°æ˜¾ç¤ºï¼Œæˆ–è€…è½¬ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œæ¯”è¾ƒå®¹æ˜“åŒºåˆ†ã€‚

```js
let s1 = Symbol('foo')
let s2 = Symbol('foo')
console.log(s1)
console.log(s2)
console.log(s1 === s2) // false
```

**Symbol.for()**

`Symbol.for()` æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œç„¶åæœç´¢æœ‰æ²¡æœ‰ä»¥è¯¥å‚æ•°ä½œä¸ºåç§°çš„ Symbol å€¼ã€‚å¦‚æœæœ‰ï¼Œå°±è¿”å›è¿™ä¸ª Symbol å€¼ï¼Œå¦åˆ™å°±æ–°å»ºä¸€ä¸ªä»¥è¯¥å­—ç¬¦ä¸²ä¸ºåç§°çš„ Symbol å€¼ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°å…¨å±€ã€‚

```js
let s1 = Symbol.for('foo')
let s2 = Symbol.for('foo')
console.log(s1 === s2) // true
```

æ³¨æ„

Symbol.for()ä¸Symbol()è¿™ä¸¤ç§å†™æ³•ï¼Œéƒ½ä¼šç”Ÿæˆæ–°çš„ Symbolã€‚å®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼Œå‰è€…ä¼šè¢«ç™»è®°åœ¨å…¨å±€ç¯å¢ƒä¸­ä¾›æœç´¢ï¼Œåè€…ä¸ä¼šã€‚Symbol.for()ä¸ä¼šæ¯æ¬¡è°ƒç”¨å°±è¿”å›ä¸€ä¸ªæ–°çš„ Symbol ç±»å‹çš„å€¼ï¼Œè€Œæ˜¯ä¼šå…ˆæ£€æŸ¥ç»™å®šçš„keyæ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨æ‰ä¼šæ–°å»ºä¸€ä¸ªå€¼ã€‚

**Symbol.keyFor()**

Symbol.keyFor()æ–¹æ³•è¿”å›ä¸€ä¸ªå·²ç™»è®°çš„ Symbol ç±»å‹å€¼çš„keyã€‚

```js
const s1 = Symbol('foo')
console.log(Symbol.keyFor(s1)) // undefined

const s2 = Symbol.for('foo')
console.log(Symbol.keyFor(s2)) // foo
```

#### 10.4.Symbolçš„åº”ç”¨åœºæ™¯

**ä½œä¸ºå±æ€§å**

ç”±äºæ¯ä¸€ä¸ª Symbol å€¼éƒ½æ˜¯ä¸ç›¸ç­‰çš„ï¼Œè¿™æ„å‘³ç€ Symbol å€¼å¯ä»¥ä½œä¸ºæ ‡è¯†ç¬¦ï¼Œç”¨äºå¯¹è±¡çš„å±æ€§åï¼Œå°±èƒ½ä¿è¯ä¸ä¼šå‡ºç°åŒåçš„å±æ€§ã€‚è¿™å¯¹äºä¸€ä¸ªå¯¹è±¡ç”±å¤šä¸ªæ¨¡å—æ„æˆçš„æƒ…å†µéå¸¸æœ‰ç”¨ï¼Œèƒ½é˜²æ­¢æŸä¸€ä¸ªé”®è¢«ä¸å°å¿ƒæ”¹å†™æˆ–è¦†ç›–ã€‚

æ¯”å¦‚åœ¨ä¸€ä¸ªç­çº§ä¸­ï¼Œå¯èƒ½ä¼šæœ‰åŒå­¦åå­—ç›¸åŒçš„æƒ…å†µï¼Œè¿™æ—¶å€™ä½¿ç”¨å¯¹è±¡æ¥æè¿°å­¦ç”Ÿä¿¡æ¯çš„æ—¶å€™ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨å­¦ç”Ÿå§“åä½œä¸ºkeyä¼šæœ‰æœ‰é—®é¢˜ã€‚

```js
const grade = {
    å¼ ä¸‰: {
        address: 'xxx',
        tel: '111'
    },
    æå››: {
        address: 'yyy',
        tel: '222'
    },
    æå››: {
        address: 'zzz',
        tel: '333'
    },
}
console.log(grade)
// åªä¼šä¿ç•™æœ€åä¸€ä¸ªæå››
```

å¦‚æœä½¿ç”¨Symbolï¼ŒåŒåçš„å­¦ç”Ÿä¿¡æ¯å°±ä¸ä¼šè¢«è¦†ç›–ï¼š

```js
const stu1 = Symbol('æå››')
const stu2 = Symbol('æå››')
const grade = {
    [stu1]: {
        address: 'yyy',
        tel: '222'
    },
    [stu2]: {
        address: 'zzz',
        tel: '333'
    },
}
console.log(grade)
console.log(grade[stu1])
console.log(grade[stu2])
```

**å±æ€§éå†**

```js
const sym = Symbol('imooc')
class User {
    constructor(name) {
        this.name = name
        this[sym] = 'imooc.com'
    }
    getName() {
        return this.name + this[sym]
    }
}
const user = new User('xiecheng')
console.log(user.getName())

for (let key in user) {
    console.log(key)
}

for (let key of Object.keys(user)) {
    console.log(key)
}

for (let key of Object.getOwnPropertySymbols(user)) {
    console.log(key)
}

for (let key of Reflect.ownKeys(user)) {
    console.log(key)
}
```

* Reflect.ownKeyså¯ä»¥éå†æ™®é€šå±æ€§åŠsymbolå±æ€§

**æ¶ˆé™¤é­”æœ¯å­—ç¬¦ä¸²**

é­”æœ¯å­—ç¬¦ä¸²æŒ‡çš„æ˜¯ï¼Œåœ¨ä»£ç ä¹‹ä¸­å¤šæ¬¡å‡ºç°ã€ä¸ä»£ç å½¢æˆå¼ºè€¦åˆçš„æŸä¸€ä¸ªå…·ä½“çš„å­—ç¬¦ä¸²æˆ–è€…æ•°å€¼ã€‚é£æ ¼è‰¯å¥½çš„ä»£ç ï¼Œåº”è¯¥å°½é‡æ¶ˆé™¤é­”æœ¯å­—ç¬¦ä¸²ï¼Œæ”¹ç”±å«ä¹‰æ¸…æ™°çš„å˜é‡ä»£æ›¿ã€‚

```js
function getArea(shape) {
    let area = 0
    switch (shape) {
        case 'Triangle':
            area = 1
            break
        case 'Circle':
            area = 2
            break
    }
    return area
}
console.log(getArea('Triangle'))
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå­—ç¬¦ä¸²Triangleå’ŒCircleå°±æ˜¯é­”æœ¯å­—ç¬¦ä¸²ã€‚å®ƒå¤šæ¬¡å‡ºç°ï¼Œä¸ä»£ç å½¢æˆâ€œå¼ºè€¦åˆâ€ï¼Œä¸åˆ©äºå°†æ¥çš„ä¿®æ”¹å’Œç»´æŠ¤ã€‚

ä½¿ç”¨Symbolå°±å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

```js
const shapeType = {
    triangle: Symbol(),
    circle: Symbol()
}

function getArea(shape) {
    let area = 0
    switch (shape) {
        case shapeType.triangle:
            area = 1
            break
        case shapeType.circle:
            area = 2
            break
    }
    return area
}
console.log(getArea(shapeType.triangle))
```

#### 10.5.å†…ç½®Symbolå€¼

* é™¤äº†å®šä¹‰è‡ªå·±ä½¿ç”¨çš„Symbolå€¼ä»¥å¤–ï¼ŒES6è¿˜æä¾›äº†11ä¸ªå†…ç½®çš„Symbolå€¼ï¼ŒæŒ‡å‘è¯­è¨€å†…éƒ¨ä½¿ç”¨çš„æ–¹æ³•ã€‚

â€‹     \- Symbol.iterator

* å¯¹è±¡çš„Symbol.iteratorå±æ€§ï¼ŒæŒ‡å‘è¯¥å¯¹è±¡çš„é»˜è®¤éå†å™¨æ–¹æ³•(åè¾¹è®²)

### 12.Proxy

åœ¨ ES6 æ ‡å‡†ä¸­æ–°å¢çš„ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½æ˜¯ Proxyï¼Œå®ƒå¯ä»¥è‡ªå®šä¹‰ä¸€äº›å¸¸ç”¨è¡Œä¸ºå¦‚æŸ¥æ‰¾ã€èµ‹å€¼ã€æšä¸¾ã€å‡½æ•°è°ƒç”¨ç­‰ã€‚é€šè¿‡ Proxy è¿™ä¸ªåç§°ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥å®ƒåŒ…å«äº†â€œä»£ç†â€çš„å«ä¹‰ï¼Œåªè¦æœ‰â€œä»£ç†â€çš„è¯‰æ±‚éƒ½å¯ä»¥è€ƒè™‘ä½¿ç”¨ Proxy æ¥å®ç°ã€‚

#### 12.1.åŸºæœ¬è¯­æ³•

**è¯­æ³•**

```js
let p = new Proxy(target, handler)
```

**è§£é‡Š**

|  å‚æ•°   |                             å«ä¹‰                             | å¿…é€‰ |
| :-----: | :----------------------------------------------------------: | :--: |
| target  | ç”¨ Proxy åŒ…è£…çš„ç›®æ ‡å¯¹è±¡ï¼ˆå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬åŸç”Ÿæ•°ç»„ï¼Œå‡½æ•°ï¼Œç”šè‡³å¦ä¸€ä¸ªä»£ç†ï¼‰ |  Y   |
| handler |    ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶å±æ€§æ˜¯å½“æ‰§è¡Œä¸€ä¸ªæ“ä½œæ—¶å®šä¹‰ä»£ç†çš„è¡Œä¸ºçš„å‡½æ•°    |  Y   |

MDN ç»™å‡ºçš„è§£é‡Šåå®˜æ–¹ï¼Œé€šä¿—çš„è®²ç¬¬ä¸€ä¸ªå‚æ•° target å°±æ˜¯ç”¨æ¥ä»£ç†çš„â€œå¯¹è±¡â€ï¼Œè¢«ä»£ç†ä¹‹åå®ƒæ˜¯ä¸èƒ½ç›´æ¥è¢«è®¿é—®çš„ï¼Œè€Œ handler å°±æ˜¯å®ç°ä»£ç†çš„è¿‡ç¨‹ã€‚

#### 12.2.æ‹¦æˆªæ“ä½œåœºæ™¯

**åœºæ™¯**

æˆ‘ä»¬ç»å¸¸è¯»å–ä¸€ä¸ªå¯¹è±¡çš„ key-valueï¼š

```js
let o = {
    name: 'xiaoming',
    age: 20
}

console.log(o.name) // xiaoming
console.log(o.age) // 20
console.log(o.from) // undefined
```

å½“æˆ‘ä»¬è¯»å– from çš„æ—¶å€™è¿”å›çš„æ˜¯ undefinedï¼Œå› ä¸º o è¿™ä¸ªå¯¹è±¡ä¸­æ²¡æœ‰è¿™ä¸ª key-valueã€‚æƒ³æƒ³çœ‹æˆ‘ä»¬åœ¨è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œè¿™ä¸ªæ•°æ®ç»å¸¸æ˜¯èšåˆçš„ï¼Œå½“å¤§å®¶æ²¡æœ‰æŒ‰ç…§è§„èŒƒæ¥çš„æ—¶å€™æˆ–è€…æ•°æ®ç¼ºå¤±çš„æƒ…å†µä¸‹ï¼Œç»å¸¸ä¼šå‡ºç°è¿™ç§â€œä¹Œé¾™â€ç°è±¡ã€‚

å¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨è°ƒç”¨ key çš„æ—¶å€™è¿”å› undefinedï¼Œä¹‹å‰çš„åšæ³•æ˜¯è¿™æ ·çš„ï¼š

```js
console.log(o.from || '')
```

å¦‚æœæˆ‘ä»¬å¯¹æ‰€æœ‰ä»£ç éƒ½æ˜¯è¿™ç§å†™æ³•ï¼Œé‚£é˜…è¯»æ€§å’Œè§‚èµæ€§å°±ä¸å¾—è€ŒçŸ¥äº†ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼ŒES6 çš„ Proxy å¯ä»¥è®©æˆ‘ä»¬è½»æ¾çš„è§£å†³è¿™ä¸€é—®é¢˜ï¼š

```js
let o = {
    name: 'xiaoming',
    age: 20
}

let handler = {
    get(obj, key) {
        return Reflect.has(obj, key) ? obj[key] : ''
    }
}

let p = new Proxy(o, handler)

console.log(p.from)
```

è¿™ä¸ªä»£ç æ˜¯æƒ³è¡¨è¾¾å¦‚æœ o å¯¹è±¡æœ‰è¿™ä¸ª key-value åˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ä¸€å¾‹è¿”å› `''` ï¼Œå½“ç„¶è¿™é‡Œæ˜¯è‡ªå®šä¹‰ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ¥å†™é€‚åˆè‡ªå·±ä¸šåŠ¡çš„è§„åˆ™ã€‚

åˆšæ‰å¯¹æ•°æ®çš„â€œè¯»æ“ä½œâ€è¿›è¡Œäº†æ‹¦æˆªï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æè¿°ä¸‹â€œå†™æ“ä½œâ€è¿›è¡Œæ‹¦æˆªã€‚

**åœºæ™¯ 1**

ä»æœåŠ¡ç«¯è·å–çš„æ•°æ®å¸Œæœ›æ˜¯åªè¯»ï¼Œä¸å…è®¸åœ¨ä»»ä½•ä¸€ä¸ªç¯èŠ‚è¢«ä¿®æ”¹ã€‚

```js
// response.data æ˜¯ JSON æ ¼å¼çš„æ•°æ®ï¼Œæ¥è‡ªæœåŠ¡ç«¯çš„å“åº”
// åœ¨ ES5 ä¸­åªèƒ½é€šè¿‡éå†æŠŠæ‰€æœ‰çš„å±æ€§è®¾ç½®ä¸ºåªè¯»
for (let [key] of Object.entries(response.data)) {
    Object.defineProperty(response.data, key, {
        writable: false
    })
}
```

å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Proxy å°±ç®€å•å¾ˆå¤šäº†ï¼š

```js
let data = new Proxy(response.data, {
    set(obj, key, value) {
        return false
    }
})
```

**åœºæ™¯ 2**

å¯¹äºæ•°æ®äº¤äº’è€Œè¨€ï¼Œæ ¡éªŒæ˜¯ä¸å¯æˆ–ç¼ºçš„ä¸€ä¸ªç¯å¢ƒï¼Œä¼ ç»Ÿçš„åšæ³•æ˜¯å°†æ ¡éªŒå†™åœ¨äº†ä¸šåŠ¡é€»è¾‘é‡Œï¼Œå¯¼è‡´ä»£ç è€¦åˆåº¦è¾ƒé«˜ã€‚å¦‚æœå¤§å®¶ä½¿ç”¨ Proxy å°±å¯ä»¥å°†ä»£ç è®¾è®¡çš„éå¸¸çµæ´»ã€‚

```js
// Validator.js
export default (obj, key, value) => {
    if (Reflect.has(key) && value > 20) {
        obj[key] = value
    }
}

import Validator from './Validator'
let data = new Proxy(response.data, {
    set: Validator
})
```

**åœºæ™¯ 3**

å¦‚æœå¯¹è¯»å†™è¿›è¡Œç›‘æ§ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š

```js
let validator = {
    set(target, key, value) {
        if (key === 'age') {
            if (typeof value !== 'number' || Number.isNaN(value)) {
                throw new TypeError('Age must be a number')
            }
            if (value <= 0) {
                throw new TypeError('Age must be a positive number')
            }
        }
        return true
    }
}
const person = {
    age: 27
}
const proxy = new Proxy(person, validator)
proxy.age = 'foo'
// <- TypeError: Age must be a number
proxy.age = NaN
// <- TypeError: Age must be a number
proxy.age = 0
// <- TypeError: Age must be a positive number
proxy.age = 28
console.log(person.age)
// <- 28

// æ·»åŠ ç›‘æ§
window.addEventListener(
    'error',
    e => {
        console.log(e.message) // Uncaught TypeError: Age must be a number
    },
    true
)
```

**åœºæ™¯ 4**

ä»€ä¹ˆå®ä¾‹ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ id è€Œä¸”åªè¯»ã€‚

```js
class Component {
    constructor() {
        this.proxy = new Proxy({
            id: Math.random().toString(36).slice(-8)
        })
    }
    get id() {
        return this.proxy.id
    }
}
```

#### 12.3.å¸¸ç”¨æ‹¦æˆªæ“ä½œ

**get**

æ‹¦æˆªå¯¹è±¡å±æ€§çš„è¯»å–ï¼Œæ¯”å¦‚proxy.fooå’Œproxy['foo']ã€‚

```js
let arr = [7, 8, 9]
arr = new Proxy(arr, {
    get(target, prop) {
        // console.log(target, prop)
        return prop in target ? target[prop] : 'error'
    }
})
console.log(arr[1])
console.log(arr[10])
let dict = {
    'hello': 'ä½ å¥½',
    'world': 'ä¸–ç•Œ'
}
dict = new Proxy(dict, {
    get(target, prop) {
        return prop in target ? target[prop] : prop
    }
})
console.log(dict['world'])
console.log(dict['imooc'])
```

**set**

æ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®ï¼Œæ¯”å¦‚proxy.foo = væˆ–proxy['foo'] = vï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚

```js
let arr = []
arr = new Proxy(arr, {
    set(target, prop, val) {
        if (typeof val === 'number') {
            target[prop] = val
            return true
        } else {
            return false
        }
    }
})
arr.push(5)
arr.push(6)
console.log(arr[0], arr[1], arr.length)
```

**has**

æ‹¦æˆªpropKey in proxyçš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚

```js
let range = {
    start: 1,
    end: 5
}

range = new Proxy(range, {
    has(target, prop) {
        return prop >= target.start && prop <= target.end
    }
})
console.log(2 in range)
console.log(9 in range)
```

**ownKeys**

æ‹¦æˆªObject.getOwnPropertyNames(proxy)ã€Object.getOwnPropertySymbols(proxy)ã€Object.keys(proxy)ã€for...inå¾ªç¯ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›ç›®æ ‡å¯¹è±¡æ‰€æœ‰è‡ªèº«çš„å±æ€§çš„å±æ€§åï¼Œè€ŒObject.keys()çš„è¿”å›ç»“æœä»…åŒ…æ‹¬ç›®æ ‡å¯¹è±¡è‡ªèº«çš„å¯éå†å±æ€§ã€‚

```js
let obj = {
    name: 'imooc',
    [Symbol('es')]: 'es6'
}
console.log(Object.getOwnPropertyNames(obj))
console.log(Object.getOwnPropertySymbols(obj))
console.log(Object.keys(obj))
for (let key in obj) {
    console.log(key)
}
let userinfo = {
    username: 'xiecheng',
    age: 34,
    _password: '***'
}
userinfo = new Proxy(userinfo, {
    ownKeys(target) {
        return Object.keys(target).filter(key => !key.startsWith('_'))
    }
})

// for (let key in userinfo) {
//     console.log(key)
// }
console.log(Object.keys(userinfo))
```

**deleteProperty**

æ‹¦æˆªdelete proxy[propKey]çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚

```js
let user = {
    name: 'xiecheng',
    age: 34,
    _password: '***'
}
user = new Proxy(user, {
    get(target, prop) {
        if (prop.startsWith('_')) {
            throw new Error('ä¸å¯è®¿é—®')
        } else {
            return target[prop]
        }
    },
    set(target, prop, val) {
        if (prop.startsWith('_')) {
            throw new Error('ä¸å¯è®¿é—®')
        } else {
            target[prop] = val
            return true
        }
    },
    deleteProperty(target, prop) { // æ‹¦æˆªåˆ é™¤
        if (prop.startsWith('_')) {
            throw new Error('ä¸å¯åˆ é™¤')
        } else {
            delete target[prop]
            return true
        }
    },
    ownKeys(target) {
        return Object.keys(target).filter(key => !key.startsWith('_'))
    }
})
console.log(user.age)
console.log(user._password)
user.age = 18
console.log(user.age)
try {
    user._password = 'xxx'
} catch (e) {
    console.log(e.message)
}

try {
    // delete user.age
    delete user._password
} catch (e) {
    console.log(e.message)
}
console.log(user.age)

for (let key in user) {
    console.log(key)
}
```

**apply**

æ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚proxy(...args)ã€proxy.call(object, ...args)ã€proxy.apply(...)ã€‚

```js
let sum = (...args) => {
    let num = 0
    args.forEach(item => {
        num += item
    })
    return num
}

sum = new Proxy(sum, {
    apply(target, ctx, args) {
        return target(...args) * 2
    }
})
console.log(sum(1, 2))
console.log(sum.call(null, 1, 2, 3))
console.log(sum.apply(null, [1, 2, 3]))
```

**construct**

æ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚new proxy(...args)ã€‚

```js
let User = class {
    constructor(name) {
        this.name = name
    }
}
User = new Proxy(User, {
    construct(target, args, newTarget) {
        console.log('construct')
        return new target(...args)
    }
})
console.log(new User('imooc'))
```

### 13.Reflect

Reflectå¯¹è±¡ä¸Proxyå¯¹è±¡ä¸€æ ·ï¼Œä¹Ÿæ˜¯ ES6 ä¸ºäº†æ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–° APIã€‚

#### 12.1.è®¾è®¡ç›®çš„

- å°†Objectå±äºè¯­è¨€å†…éƒ¨çš„æ–¹æ³•æ”¾åˆ°Reflectä¸Š

```js
let obj = {}
let newVal = ''
Reflect.defineProperty(obj, 'name', {
    get() {
        return newVal
    },
    set(val) {
        console.log('set')
        // this.name = val
        newVal = val
    }
})
obj.name = 'es'
console.log(obj.name)
```

- ä¿®æ”¹æŸäº›Objectæ–¹æ³•çš„è¿”å›ç»“æœï¼Œè®©å…¶å˜å¾—æ›´åˆç†

```js
// è€å†™æ³•
try {
    Object.defineProperty(target, property, attributes)
    // success
} catch (e) {
    // failure
}

// æ–°å†™æ³•
if (Reflect.defineProperty(target, property, attributes)) {
    // success
} else {
    // failure
}
```

- è®©Objectæ“ä½œå˜æˆå‡½æ•°è¡Œä¸º

```js
// è€å†™æ³•
'assign' in Object // true

// æ–°å†™æ³•
Reflect.has(Object, 'assign') // true
```

- Reflectå¯¹è±¡çš„æ–¹æ³•ä¸Proxyå¯¹è±¡çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼Œåªè¦æ˜¯Proxyå¯¹è±¡çš„æ–¹æ³•ï¼Œå°±èƒ½åœ¨Reflectå¯¹è±¡ä¸Šæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ã€‚

```js
Proxy(target, {
    set: function(target, name, value, receiver) {
        var success = Reflect.set(target, name, value, receiver)
        if (success) {
            console.log('property ' + name + ' on ' + target + ' set to ' + value)
        }
        return success
    }
})
```

Reflect æ˜¯ä¸€ä¸ªå†…ç½®çš„å¯¹è±¡ï¼Œå®ƒæä¾›æ‹¦æˆª JavaScript æ“ä½œçš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸å¤„ç†å™¨å¯¹è±¡çš„æ–¹æ³•ç›¸åŒã€‚Reflectä¸æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå› æ­¤å®ƒæ˜¯ä¸å¯æ„é€ çš„ã€‚

TIP

ä¸å¤§å¤šæ•°å…¨å±€å¯¹è±¡ä¸åŒï¼ŒReflectæ²¡æœ‰æ„é€ å‡½æ•°ã€‚ä½ ä¸èƒ½å°†å…¶ä¸ä¸€ä¸ªnewè¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ï¼Œæˆ–è€…å°†Reflectå¯¹è±¡ä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ã€‚Reflectçš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼ˆå°±åƒMathå¯¹è±¡ï¼‰

#### 12.2.å¸¸ç”¨æ–¹æ³•

**Reflect.apply()**

**è¯­æ³•**

> Reflect.apply(target, thisArgument, argumentsList)

**è§£é‡Š**

|     å‚æ•°      |                             å«ä¹‰                             | å¿…é€‰ |
| :-----------: | :----------------------------------------------------------: | :--: |
|    target     |                           ç›®æ ‡å‡½æ•°                           |  Y   |
| thisArgument  |                targetå‡½æ•°è°ƒç”¨æ—¶ç»‘å®šçš„thiså¯¹è±¡                |  N   |
| argumentsList | targetå‡½æ•°è°ƒç”¨æ—¶ä¼ å…¥çš„å®å‚åˆ—è¡¨ï¼Œè¯¥å‚æ•°åº”è¯¥æ˜¯ä¸€ä¸ªç±»æ•°ç»„çš„å¯¹è±¡ |  N   |

**ç¤ºä¾‹**

```js
Reflect.apply(Math.floor, undefined, [1.75])
// 1

Reflect.apply(String.fromCharCode, undefined, [104, 101, 108, 108, 111])
// "hello"

Reflect.apply(RegExp.prototype.exec, /ab/, ['confabulation']).index
// 4

Reflect.apply(''.charAt, 'ponies', [3])
// "i"
```

**ES5 å¯¹æ¯”**

è¯¥æ–¹æ³•ä¸ES5ä¸­Function.prototype.apply()æ–¹æ³•ç±»ä¼¼ï¼šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•å¹¶ä¸”æ˜¾å¼åœ°æŒ‡å®šthiså˜é‡å’Œå‚æ•°åˆ—è¡¨(arguments) ï¼Œå‚æ•°åˆ—è¡¨å¯ä»¥æ˜¯æ•°ç»„ï¼Œæˆ–ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚

```js
Function.prototype.apply.call(Math.floor, undefined, [1.75])
```

**Reflect.construct()**

Reflect.construct() æ–¹æ³•çš„è¡Œä¸ºæœ‰ç‚¹åƒ new æ“ä½œç¬¦ æ„é€ å‡½æ•° ï¼Œ ç›¸å½“äºè¿è¡Œ new target(...args).

**è¯­æ³•**

> Reflect.construct(target, argumentsList[, newTarget])

**è§£é‡Š**

|     å‚æ•°      |                             å«ä¹‰                             | å¿…é€‰ |
| :-----------: | :----------------------------------------------------------: | :--: |
|    target     |                       è¢«è¿è¡Œçš„ç›®æ ‡å‡½æ•°                       |  Y   |
| argumentsList |                 è°ƒç”¨æ„é€ å‡½æ•°çš„æ•°ç»„æˆ–è€…ä¼ªæ•°ç»„                 |  Y   |
|   newTarget   | è¯¥å‚æ•°ä¸ºæ„é€ å‡½æ•°ï¼Œ å‚è€ƒ new.target æ“ä½œç¬¦ï¼Œå¦‚æœæ²¡æœ‰newTargetå‚æ•°ï¼Œ é»˜è®¤å’Œtargetä¸€æ · |  N   |

> [! WARNING] å¦‚æœtargetæˆ–è€…newTargetä¸æ˜¯æ„é€ å‡½æ•°ï¼ŒæŠ›å‡ºTypeError

Reflect.constructå…è®¸ä½ ä½¿ç”¨å¯å˜çš„å‚æ•°æ¥è°ƒç”¨æ„é€ å‡½æ•°

```js
var obj = new Foo(...args)
var obj = Reflect.construct(Foo, args)
```

**ç¤ºä¾‹**

```js
var d = Reflect.construct(Date, [1776, 6, 4])
d instanceof Date // true
d.getFullYear() // 1776
```

å¦‚æœä½¿ç”¨ newTarget å‚æ•°ï¼Œåˆ™è¡¨ç¤ºç»§æ‰¿äº† newTarget è¿™ä¸ªè¶…ç±»ï¼š

```js
function someConstructor() {}
var result = Reflect.construct(Array, [], someConstructor)

Reflect.getPrototypeOf(result) // è¾“å‡ºï¼šsomeConstructor.prototype
Array.isArray(result) // true
```

**Reflect.defineProperty()**

é™æ€æ–¹æ³• Reflect.defineProperty() åŸºæœ¬ç­‰åŒäº Object.defineProperty() æ–¹æ³•ï¼Œå”¯ä¸€ä¸åŒæ˜¯è¿”å› Boolean å€¼ã€‚

**è¯­æ³•**

> Reflect.defineProperty(target, propertyKey, attributes)

**è§£é‡Š**

|    å‚æ•°     |           å«ä¹‰           | å¿…é€‰ |
| :---------: | :----------------------: | :--: |
|   target    |         ç›®æ ‡å¯¹è±¡         |  Y   |
| propertyKey | è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„åç§° |  Y   |
| attributes  | è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„æè¿° |  Y   |

**ç¤ºä¾‹**

```js
const student = {}
Reflect.defineProperty(student, 'name', {
    value: 'Mike'
}) // true
student.name // "Mike"
```

**Reflect.deleteProperty()**

Reflect.deleteProperty å…è®¸ä½ åˆ é™¤ä¸€ä¸ªå¯¹è±¡ä¸Šçš„å±æ€§ã€‚è¿”å›ä¸€ä¸ª Boolean å€¼è¡¨ç¤ºè¯¥å±æ€§æ˜¯å¦è¢«æˆåŠŸåˆ é™¤ã€‚å®ƒå‡ ä¹ä¸éä¸¥æ ¼çš„ delete operator ç›¸åŒã€‚

**è¯­æ³•**

> Reflect.deleteProperty(target, propertyKey)

**è§£é‡Š**

|    å‚æ•°     |         å«ä¹‰         | å¿…é€‰ |
| :---------: | :------------------: | :--: |
|   target    |  åˆ é™¤å±æ€§çš„ç›®æ ‡å¯¹è±¡  |  Y   |
| propertyKey | å°†è¢«åˆ é™¤çš„å±æ€§çš„åç§° |  Y   |

**ç¤ºä¾‹**

```js
var obj = {
    x: 1,
    y: 2
}
Reflect.deleteProperty(obj, "x") // true
obj // { y: 2 }

var arr = [1, 2, 3, 4, 5]
Reflect.deleteProperty(arr, "3") // true
arr // [1, 2, 3, , 5]

// å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œè¿”å› true
Reflect.deleteProperty({}, "foo") // true

// å¦‚æœå±æ€§ä¸å¯é…ç½®ï¼Œè¿”å› false
Reflect.deleteProperty(Object.freeze({
    foo: 1
}), "foo") // false
```

**Reflect.get()**

Reflect.get() æ–¹æ³•çš„å·¥ä½œæ–¹å¼ï¼Œå°±åƒä» object (target[propertyKey]) ä¸­è·å–å±æ€§ï¼Œä½†å®ƒæ˜¯ä½œä¸ºä¸€ä¸ªå‡½æ•°æ‰§è¡Œçš„ã€‚

**è¯­æ³•**

> Reflect.get(target, propertyKey[, receiver])

**è§£é‡Š**

|    å‚æ•°     |                 å«ä¹‰                  | å¿…é€‰ |
| :---------: | :-----------------------------------: | :--: |
|   target    |          éœ€è¦å–å€¼çš„ç›®æ ‡å¯¹è±¡           |  Y   |
| propertyKey |          éœ€è¦è·å–çš„å€¼çš„é”®å€¼           |  Y   |
|  receiver   | å¦‚æœé‡åˆ° getterï¼Œæ­¤å€¼å°†æä¾›ç»™ç›®æ ‡è°ƒç”¨ |  N   |

**ç¤ºä¾‹**

```js
// Object
var obj = {
    x: 1,
    y: 2
}
Reflect.get(obj, 'x') // 1

// Array
Reflect.get(['zero', 'one'], 1) // "one"

// Proxy with a get handler
var x = {
    p: 1
}
var obj = new Proxy(x, {
    get(t, k, r) {
        return k + 'bar'
    }
})
Reflect.get(obj, 'foo') // "foobar"
```

**Reflect.getOwnPropertyDescriptor()**

é™æ€æ–¹æ³• Reflect.getOwnPropertyDescriptor() ä¸ Object.getOwnPropertyDescriptor() æ–¹æ³•ç›¸ä¼¼ã€‚å¦‚æœåœ¨å¯¹è±¡ä¸­å­˜åœ¨ï¼Œåˆ™è¿”å›ç»™å®šçš„å±æ€§çš„å±æ€§æè¿°ç¬¦ï¼Œå¦åˆ™è¿”å› undefinedã€‚

**è¯­æ³•**

> Reflect.getOwnPropertyDescriptor(target, propertyKey)

**è§£é‡Š**

|    å‚æ•°     |               å«ä¹‰               | å¿…é€‰ |
| :---------: | :------------------------------: | :--: |
|   target    |      éœ€è¦å¯»æ‰¾å±æ€§çš„ç›®æ ‡å¯¹è±¡      |  Y   |
| propertyKey | è·å–è‡ªå·±çš„å±æ€§æè¿°ç¬¦çš„å±æ€§çš„åç§° |  N   |

**ç¤ºä¾‹**

```js
Reflect.getOwnPropertyDescriptor({
    x: 'hello'
}, 'x')
// {value: "hello", writable: true, enumerable: true, configurable: true}

Reflect.getOwnPropertyDescriptor({
    x: 'hello'
}, 'y')
// undefined

Reflect.getOwnPropertyDescriptor([], 'length')
// {value: 0, writable: true, enumerable: false, configurable: false}
```

**å¯¹æ¯”**

å¦‚æœè¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆä¸€ä¸ªåŸå§‹å€¼ï¼‰ï¼Œé‚£ä¹ˆå°†é€ æˆ TypeError é”™è¯¯ã€‚è€Œå¯¹äº Object.getOwnPropertyDescriptorï¼Œéå¯¹è±¡çš„ç¬¬ä¸€ä¸ªå‚æ•°å°†è¢«å¼ºåˆ¶è½¬æ¢ä¸ºä¸€ä¸ªå¯¹è±¡å¤„ç†ã€‚

```js
Reflect.getOwnPropertyDescriptor("foo", 0)
// TypeError: "foo" is not non-null object

Object.getOwnPropertyDescriptor("foo", 0)
// { value: "f", writable: false, enumerable: true, configurable: false }
```

**Reflect.getPrototypeOf()**

é™æ€æ–¹æ³• Reflect.getPrototypeOf() ä¸ Object.getPrototypeOf() æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚éƒ½æ˜¯è¿”å›æŒ‡å®šå¯¹è±¡çš„åŸå‹ï¼ˆå³ï¼Œå†…éƒ¨çš„ [[Prototype]] å±æ€§çš„å€¼ï¼‰ã€‚

**è¯­æ³•**

> Reflect.getPrototypeOf(target)

**è§£é‡Š**

|  å‚æ•°  |        å«ä¹‰        | å¿…é€‰ |
| :----: | :----------------: | :--: |
| target | è·å–åŸå‹çš„ç›®æ ‡å¯¹è±¡ |  Y   |

**Reflect.has()**

Reflect.has ç”¨äºæ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ‹¥æœ‰æŸä¸ªå±æ€§ï¼Œ ç›¸å½“äºin æ“ä½œç¬¦

**è¯­æ³•**

> Reflect.has(target, propertyKey)

**è§£é‡Š**

|    å‚æ•°     |                  å«ä¹‰                  | å¿…é€‰ |
| :---------: | :------------------------------------: | :--: |
|   target    |           è·å–åŸå‹çš„ç›®æ ‡å¯¹è±¡           |  Y   |
| propertyKey | å±æ€§åï¼Œéœ€è¦æ£€æŸ¥ç›®æ ‡å¯¹è±¡æ˜¯å¦å­˜åœ¨æ­¤å±æ€§ |  Y   |

**Reflect.isExtensible()**

Reflect.isExtensible åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯æ‰©å±• ï¼ˆå³æ˜¯å¦èƒ½å¤Ÿæ·»åŠ æ–°çš„å±æ€§ï¼‰ï¼Œå®ƒä¸ Object.isExtensible() æ–¹æ³•ä¸€æ ·ã€‚

**è¯­æ³•**

> Reflect.isExtensible(target)

*è§£é‡Š**

|  å‚æ•°  |        å«ä¹‰        | å¿…é€‰ |
| :----: | :----------------: | :--: |
| target | è·å–åŸå‹çš„ç›®æ ‡å¯¹è±¡ |  Y   |

**Reflect.ownKeys()**

Reflect.ownKeys æ–¹æ³•è¿”å›ä¸€ä¸ªç”±ç›®æ ‡å¯¹è±¡è‡ªèº«çš„å±æ€§é”®ç»„æˆçš„æ•°ç»„ã€‚å®ƒçš„è¿”å›å€¼ç­‰åŒäº Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target))

**è¯­æ³•**

> Reflect.ownKeys(target)

*è§£é‡Š**

|  å‚æ•°  |        å«ä¹‰        | å¿…é€‰ |
| :----: | :----------------: | :--: |
| target | è·å–åŸå‹çš„ç›®æ ‡å¯¹è±¡ |  Y   |

**ç¤ºä¾‹**

```js
Reflect.ownKeys({
    z: 3,
    y: 2,
    x: 1
}) // [ "z", "y", "x" ]
Reflect.ownKeys([]) // ["length"]

var sym = Symbol.for("comet")
var sym2 = Symbol.for("meteor")
var obj = {
    [sym]: 0,
    "str": 0,
    "773": 0,
    "0": 0,
    [sym2]: 0,
    "-1": 0,
    "8": 0,
    "second str": 0
}
Reflect.ownKeys(obj)
// [ "0", "8", "773", "str", "-1", "second str", Symbol(comet), Symbol(meteor) ]
// Indexes in numeric order,
// strings in insertion order,
// symbols in insertion order
```

**Reflect.preventExtensions()**

Reflect.preventExtensions æ–¹æ³•é˜»æ­¢æ–°å±æ€§æ·»åŠ åˆ°å¯¹è±¡ ä¾‹å¦‚ï¼šé˜²æ­¢å°†æ¥å¯¹å¯¹è±¡çš„æ‰©å±•è¢«æ·»åŠ åˆ°å¯¹è±¡ä¸­)ã€‚è¯¥æ–¹æ³•ä¸ Object.preventExtensions() æ–¹æ³•ä¸€è‡´

**è¯­æ³•**

> Reflect.preventExtensions(target)

*è§£é‡Š**

|  å‚æ•°  |        å«ä¹‰        | å¿…é€‰ |
| :----: | :----------------: | :--: |
| target | è·å–åŸå‹çš„ç›®æ ‡å¯¹è±¡ |  Y   |

**ç¤ºä¾‹**

```js
// Objects are extensible by default.
var empty = {}
Reflect.isExtensible(empty) // === true

// ...but that can be changed.
Reflect.preventExtensions(empty)
Reflect.isExtensible(empty) // === false
Reflect.preventExtensions(1)
// TypeError: 1 is not an object

Object.preventExtensions(1)
// 1
```

**Reflect.set()**

Reflect.set æ–¹æ³•å…è®¸ä½ åœ¨å¯¹è±¡ä¸Šè®¾ç½®å±æ€§ã€‚å®ƒçš„ä½œç”¨æ˜¯ç»™å±æ€§èµ‹å€¼å¹¶ä¸”å°±åƒ property accessor è¯­æ³•ä¸€æ ·ï¼Œä½†æ˜¯å®ƒæ˜¯ä»¥å‡½æ•°çš„æ–¹å¼ã€‚

**è¯­æ³•**

> Reflect.set(target, propertyKey, value[, receiver])

*è§£é‡Š**

|    å‚æ•°     |                  å«ä¹‰                  | å¿…é€‰ |
| :---------: | :------------------------------------: | :--: |
|   target    |           è·å–åŸå‹çš„ç›®æ ‡å¯¹è±¡           |  Y   |
| propertyKey |            è®¾ç½®çš„å±æ€§çš„åç§°            |  Y   |
|    value    |                è®¾ç½®çš„å€¼                |  Y   |
|  receiver   | å¦‚æœé‡åˆ° setterï¼Œthis å°†æä¾›ç»™ç›®æ ‡è°ƒç”¨ |  N   |

**ç¤ºä¾‹**

```js
// Object
var obj = {}
Reflect.set(obj, "prop", "value") // true
obj.prop // "value"

// Array
var arr = ["duck", "duck", "duck"]
Reflect.set(arr, 2, "goose") // true
arr[2] // "goose"

// It can truncate an array.
Reflect.set(arr, "length", 1) // true
arr // ["duck"]

// With just one argument, propertyKey and value are "undefined".
var obj = {}
Reflect.set(obj) // true
Reflect.getOwnPropertyDescriptor(obj, "undefined")
// { value: undefined, writable: true, enumerable: true, configurable: true }
```

**Reflect.setPrototypeOf()**

Reflect.setPrototypeOf æ–¹æ³•æ”¹å˜æŒ‡å®šå¯¹è±¡çš„åŸå‹ ï¼ˆå³ï¼Œå†…éƒ¨çš„ [[Prototype]] å±æ€§å€¼ï¼‰

**è¯­æ³•**

> Reflect.setPrototypeOf(target, prototype)

*è§£é‡Š**

|   å‚æ•°    |               å«ä¹‰               | å¿…é€‰ |
| :-------: | :------------------------------: | :--: |
|  target   |        è·å–åŸå‹çš„ç›®æ ‡å¯¹è±¡        |  Y   |
| prototype | å¯¹è±¡çš„æ–°åŸå‹ ï¼ˆä¸€ä¸ªå¯¹è±¡æˆ– nullï¼‰ |  Y   |

**ç¤ºä¾‹**

```js
Reflect.setPrototypeOf({}, Object.prototype) // true

// It can change an object's [[Prototype]] to null.
Reflect.setPrototypeOf({}, null) // true

// Returns false if target is not extensible.
Reflect.setPrototypeOf(Object.freeze({}), null) // false

// Returns false if it cause a prototype chain cycle.
var target = {}
var proto = Object.create(target)
Reflect.setPrototypeOf(target, proto) // false
```

æ³¨æ„

å¯¹äºä»¥ä¸Šæ‰€æœ‰ API ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Object çš„ï¼Œå¦‚æœç»™å®šçš„ä¸æ˜¯ Object åˆ™æŠ›å‡ºä¸€ä¸ª TypeError å¼‚å¸¸

### 14.Promiseå¯¹è±¡

####  12.1.å¼‚æ­¥æ“ä½œå‰ç½®çŸ¥è¯†

**JSæ˜¯å•çº¿ç¨‹çš„**

å°±æ˜¯åŒä¸€ä¸ªæ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚å°±ç±»ä¼¼ç”Ÿæ´»ä¸­çš„å»è¶…å¸‚æ’é˜Ÿç»“è´¦ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä½æ”¶é“¶å‘˜åªèƒ½ä¸ºä¸€ä½é¡¾å®¢ç»“è´¦ï¼Œå…¶ä»–é¡¾å®¢éœ€è¦åœ¨åé¢æ’é˜Ÿç­‰å€™ã€‚

ä¸ºä»€ä¹ˆ JS æ˜¯å•çº¿ç¨‹çš„ï¼Ÿä½œä¸ºæµè§ˆå™¨è„šæœ¬è¯­è¨€ï¼ŒJavaScript çš„ä¸»è¦ç”¨é€”æ˜¯ä¸ç”¨æˆ·äº’åŠ¨ï¼Œä»¥åŠæ“ä½œ DOM ã€‚è¿™å†³å®šäº†å®ƒåªèƒ½æ˜¯å•çº¿ç¨‹ï¼Œå¦åˆ™ä¼šå¸¦æ¥å¾ˆå¤æ‚çš„åŒæ­¥é—®é¢˜ã€‚æ¯”å¦‚ï¼Œå‡å®š JavaScriptåŒæ—¶æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨æŸä¸ª DOM èŠ‚ç‚¹ä¸Šæ·»åŠ å†…å®¹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åˆ é™¤äº†è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ—¶æµè§ˆå™¨åº”è¯¥ä»¥å“ªä¸ªçº¿ç¨‹ä¸ºå‡†ï¼Ÿ

å•çº¿ç¨‹å°±æ„å‘³ç€ï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æ’é˜Ÿï¼Œå‰ä¸€ä¸ªä»»åŠ¡ç»“æŸï¼Œæ‰èƒ½æ‰§è¡Œåä¸€ä¸ªä»»åŠ¡ã€‚å¦‚æœå‰ä¸€ä¸ªä»»åŠ¡è€—æ—¶å¾ˆé•¿ï¼Œé‚£ä¹ˆåä¸€ä¸ªä»»åŠ¡å°±ä¸å¾—ä¸ä¸€ç›´ç­‰å¾…ï¼Œäºæ˜¯ä¹ï¼ŒJS è®¾è®¡è€…ä»¬æŠŠæ‰€æœ‰ä»»åˆ†æˆä¸¤ç±»ï¼ŒåŒæ­¥å’Œå¼‚æ­¥ã€‚

- åŒæ­¥ï¼šåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œåªæœ‰å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ‰èƒ½æ‰§è¡Œåä¸€ä¸ªä»»åŠ¡
- å¼‚æ­¥ï¼šåŒä¸€æ—¶é—´å¯ä»¥æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œå½“åŒæ­¥ä»»åŠ¡æ‰§è¡Œåˆ°æŸä¸ª WebAPI æ—¶ï¼Œå°±ä¼šè§¦å‘å¼‚æ­¥æ“ä½œï¼Œæ­¤æ—¶æµè§ˆå™¨ä¼šå•ç‹¬å¼€çº¿ç¨‹å»å¤„ç†è¿™äº›å¼‚æ­¥ä»»åŠ¡ã€‚

```js
 // åŒæ­¥
 const a = 2
 const b = 3
 console.log(a + b)

 // å¼‚æ­¥
 setTimeout(() => {
     console.log(a + b)
 }, 1000)
```

è¯·æ€è€ƒä¸‹é¢çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

```js
console.log(1)
setTimeout(() => { // å¼‚æ­¥ä»»åŠ¡ï¼Œæ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­
    console.log(2)
}, 0)
console.log(3)

// 1ã€3ã€2
```

ä¸‹å›¾è¯´æ˜äº†åŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ï¼š ![img](http://es.xiecheng.live/assets/img/task.9fef93a6.png)

**AjaxåŸç†**

Ajax å³â€œAsynchronous Javascript And XMLâ€ï¼ˆå¼‚æ­¥ JavaScript å’Œ XMLï¼‰ï¼Œæ˜¯æŒ‡ä¸€ç§åˆ›å»ºäº¤äº’å¼ã€å¿«é€ŸåŠ¨æ€ç½‘é¡µåº”ç”¨çš„ç½‘é¡µå¼€å‘æŠ€æœ¯ã€‚Ajax å¯ä»¥ä½¿ç½‘é¡µå®ç°å¼‚æ­¥æ›´æ–°ã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨ä¸é‡æ–°åŠ è½½æ•´ä¸ªç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œå¯¹ç½‘é¡µçš„æŸéƒ¨åˆ†è¿›è¡Œæ›´æ–°ã€‚

```js
// åˆ›å»º XMLHttpRequest å¯¹è±¡
const url = 'http://jsonplaceholder.typicode.com/users'
let xmlhttp
if (window.XMLHttpRequest) { // code for IE7+, Firefox, Chrome, Opera, Safari
    xmlhttp = new XMLHttpRequest()
} else { // code for IE6, IE5
    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP")
}

// å‘é€è¯·æ±‚
xmlhttp.open("GET", url, true)
xmlhttp.send()

// æœåŠ¡ç«¯å“åº”
xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        //    console.log(xmlhttp.responseText)
        let obj = JSON.parse(xmlhttp.responseText)
        console.log(obj)
    }
}
```

**Callback Hell**

JavaScipt ä¸­çš„è®¸å¤šæ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæˆ‘ä»¬æŠŠä¸Šé¢çš„Ajaxå°è£…æˆä¸€ä¸ªå‡½æ•°ï¼š

```js
function ajax(url, callback) {
    let xmlhttp
    if (window.XMLHttpRequest) { // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp = new XMLHttpRequest()
    } else { // code for IE6, IE5
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP")
    }
    // å‘é€è¯·æ±‚
    xmlhttp.open("GET", url, true)
    xmlhttp.send()
    // æœåŠ¡ç«¯å“åº”
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            //    console.log(xmlhttp.responseText)
            let obj = JSON.parse(xmlhttp.responseText)
            callback(obj)
        }
    }
}
```

æˆ‘ä»¬åœ¨staticæ–‡ä»¶å¤¹ä¸‹æ”¾å…¥ä¸‰ä¸ªjsonæ–‡ä»¶ï¼š

a.json:

```json
{
    "a": "æˆ‘æ˜¯A"
}
```

b.json:

```json
{
    "b": "æˆ‘æ˜¯B"
}
```

c.json:

```json
{
    "c": "æˆ‘æ˜¯C"
}
```

æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ä½¿ç”¨ï¼š

```js
// åŠ è½½å¹¶æ‰§è¡Œè„šæœ¬
ajax('/static/a.json')
```

å‡½æ•°æ˜¯å¼‚æ­¥è°ƒç”¨çš„ï¼Œå› ä¸ºæ“ä½œä¸æ˜¯ç«‹å³å®Œæˆçš„ï¼Œè€Œæ˜¯ä¹‹åæ‰ä¼šå®Œæˆã€‚

```js
ajax('/static/a.json')
// ä¸‹é¢çš„ä»£ç ä¸ä¼šç­‰åˆ°ajaxæ‰§è¡Œå®Œæ‰æ‰§è¡Œ
// ...
```

è¿™ä¸ªè¿‡ç¨‹å¤§å®¶å¹¶ä¸é™Œç”Ÿï¼Œå¯æ˜¯å¦‚æœåœ¨å›è°ƒä¹‹åå†å›è°ƒå‘¢ï¼Ÿ

```js
ajax('static/a.json', res => {
    console.log(res)
    ajax('static/b.json', res => {
        console.log(res)
        ajax('static/c.json', res => {
            console.log(res)
        })
    })
})
```

å¦‚æœåµŒå¥—å˜å¤šï¼Œä»£ç å±‚æ¬¡å°±ä¼šå˜æ·±ï¼Œç»´æŠ¤éš¾åº¦ä¹Ÿéšä¹‹å¢åŠ ã€‚

è¿™å°±è¢«ç§°ä¸º â€œå›è°ƒåœ°ç‹±â€ æˆ–è€…â€œå›è°ƒæ·±æ¸Šâ€ã€‚

#### 12.2.é‚‚é€…Promise

**ç†è§£promise**

* ä»£è¡¨äº†æœªæ¥æŸä¸ªå°†è¦å‘ç”Ÿçš„äº‹ä»¶(é€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œ)

**promiseçš„ä½œç”¨**

* è§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼ˆå±‚å±‚åµŒå¥—çš„å›è°ƒå‡½æ•°ï¼‰,ä½¿ä»£ç æ›´æ˜“äºç»´æŠ¤

**promiseå¯¹è±¡çš„3ä¸ªçŠ¶æ€**

* pending: åˆå§‹åŒ–çŠ¶æ€

* fullfilled: æˆåŠŸçŠ¶æ€

* rejected: å¤±è´¥çŠ¶æ€

**åŸºæœ¬è¯­æ³•**

Promise å°±æ˜¯ä¸ºäº†è§£å†³â€œå›è°ƒåœ°ç‹±â€é—®é¢˜çš„ï¼Œå®ƒå¯ä»¥å°†å¼‚æ­¥æ“ä½œçš„å¤„ç†å˜å¾—å¾ˆä¼˜é›…ã€‚å›è°ƒåœ°ç‹±ï¼Œä»£ç éš¾ä»¥ç»´æŠ¤ï¼Œ å¸¸å¸¸ç¬¬ä¸€ä¸ªçš„å‡½æ•°çš„è¾“å‡ºæ˜¯ç¬¬äºŒä¸ªå‡½æ•°çš„è¾“å…¥è¿™ç§ç°è±¡promiseå¯ä»¥æ”¯æŒå¤šä¸ªå¹¶å‘çš„è¯·æ±‚ï¼Œè·å–å¹¶å‘è¯·æ±‚ä¸­çš„æ•°æ®è¿™ä¸ªpromiseå¯ä»¥è§£å†³å¼‚æ­¥çš„é—®é¢˜ï¼Œæœ¬èº«ä¸èƒ½è¯´promiseæ˜¯å¼‚æ­¥çš„ã€‚

åˆ›å»ºPromiseå®ä¾‹ã€‚

```js
const promise = new Promise(function(resolve, reject) {
    // ... some code

    if ( /* å¼‚æ­¥æ“ä½œæˆåŠŸ */ ) {
        resolve(value)
    } else {
        reject(error)
    }
})
```

Promiseæ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯resolveå’Œrejectã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œç”± JavaScript å¼•æ“æä¾›ï¼Œä¸ç”¨è‡ªå·±éƒ¨ç½²ã€‚

- å¤„ç†ç»“æœæ­£å¸¸çš„è¯ï¼Œè°ƒç”¨resolve(å¤„ç†ç»“æœå€¼)ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä» pending å˜ä¸º resolvedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»
- å¤„ç†ç»“æœé”™è¯¯çš„è¯ï¼Œè°ƒç”¨reject(Errorå¯¹è±¡)ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€ï¼ˆå³ä» pending å˜ä¸º rejectedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚

Promiseå®ä¾‹ç”Ÿæˆä»¥åï¼Œå¯ä»¥ç”¨thenæ–¹æ³•åˆ†åˆ«æŒ‡å®šresolvedçŠ¶æ€å’ŒrejectedçŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚

```js
promise.then(function(value) {
    // success
}, function(error) {
    // failure
})
```

TIP

å®é™…ä¸Š Promise ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åŠ¨æ‰‹è¯•ä¸€è¯•å»å°è£…è‡ªå·±ä¸šåŠ¡ä¸­åº”ç”¨åˆ°çš„å¼‚æ­¥æ“ä½œäº†ï¼ˆä¹‹å‰ç”¨å›è°ƒå†™çš„ï¼‰ï¼Ÿ

åœ¨è¿™é‡Œå¿…é¡»è¯´æ˜ä¸‹ Promise å†…éƒ¨æ˜¯æœ‰çŠ¶æ€çš„(pendingã€fulfilledã€rejected)ï¼ŒPromise å¯¹è±¡æ ¹æ®çŠ¶æ€æ¥ç¡®å®šæ‰§è¡Œå“ªä¸ªæ–¹æ³•ã€‚Promise åœ¨å®ä¾‹åŒ–çš„æ—¶å€™çŠ¶æ€æ˜¯é»˜è®¤ pending çš„ï¼Œå½“å¼‚æ­¥æ“ä½œæ˜¯å®Œæˆçš„ï¼ŒçŠ¶æ€ä¼šè¢«ä¿®æ”¹ä¸º fulfilledï¼Œå¦‚æœå¼‚æ­¥æ“ä½œé‡åˆ°å¼‚å¸¸ï¼ŒçŠ¶æ€ä¼šè¢«ä¿®æ”¹ä¸º rejectedï¼Œå¯ä»¥é€šè¿‡ä¸‹å›¾æ¥çœ‹ä¸‹çŠ¶æ€çš„èµ°å‘ï¼š

![img](http://es.xiecheng.live/assets/img/promise.04ed9cc2.png)

æ³¨æ„

çŠ¶æ€è½¬åŒ–æ˜¯å•å‘çš„ï¼Œä¸å¯é€†è½¬ï¼Œå·²ç»ç¡®å®šçš„çŠ¶æ€ï¼ˆfulfilled/rejectedï¼‰æ— æ³•è½¬å›åˆå§‹çŠ¶æ€ï¼ˆpendingï¼‰ï¼Œè€Œä¸”åªèƒ½æ˜¯ä» pending åˆ° fulfilled æˆ–è€… rejected

##### 12.2.1.Promise.prototype.then()

**åŸºæœ¬è¯­æ³•**

> promise.then(onFulfilled, onRejected)

**ç¤ºä¾‹**

```js
var promise = new Promise(function(resolve, reject) {
    resolve('ä¼ é€’ç»™thençš„å€¼')
})
promise.then(function(value) {
    console.log(value)
}, function(error) {
    console.error(error)
})
```

è¿™æ®µä»£ç åˆ›å»ºä¸€ä¸ª Promise å¯¹è±¡ï¼Œå®šä¹‰äº†å¤„ç† onFulfilled å’Œ onRejected çš„å‡½æ•°ï¼ˆhandlerï¼‰ï¼Œç„¶åè¿”å›è¿™ä¸ª Promise å¯¹è±¡ã€‚

è¿™ä¸ª Promise å¯¹è±¡ä¼šåœ¨å˜ä¸º resolve æˆ–è€… reject çš„æ—¶å€™åˆ†åˆ«è°ƒç”¨ç›¸åº”æ³¨å†Œçš„å›è°ƒå‡½æ•°ã€‚

- å½“ handler è¿”å›ä¸€ä¸ªæ­£å¸¸å€¼çš„æ—¶å€™ï¼Œè¿™ä¸ªå€¼ä¼šä¼ é€’ç»™ Promise å¯¹è±¡çš„ onFulfilled æ–¹æ³•ã€‚
- å®šä¹‰çš„ handler ä¸­äº§ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œè¿™ä¸ªå€¼åˆ™ä¼šä¼ é€’ç»™ Promise å¯¹è±¡çš„ onRejected æ–¹æ³•ã€‚

##### 12.2.2.Promise.prototype.catch()

æ•è·å¼‚å¸¸æ˜¯ç¨‹åºè´¨é‡ä¿éšœæœ€åŸºæœ¬çš„è¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ Promise å¯¹è±¡çš„ catch æ–¹æ³•æ¥æ•è·å¼‚æ­¥æ“ä½œè¿‡ç¨‹ä¸­å‡ºç°çš„ä»»ä½•å¼‚å¸¸ã€‚

**åŸºæœ¬è¯­æ³•**

> p.catch(onRejected)

> p.catch(function(reason) {

// rejection })

**ç¤ºä¾‹**

```js
function test() {
    return new Promise((resolve, reject) => {
        reject(new Error('es'))
    })
}

test().catch((e) => {
    console.log(e.message) // es
})
```

è¿™ä¸ªä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ catch æ•è· Promise å¯¹è±¡ä¸­çš„å¼‚å¸¸ï¼Œæœ‰çš„åŒå­¦ä¼šé—® catch æ•è·çš„æ˜¯ Promise å†…éƒ¨çš„ Error è¿˜æ˜¯ Rejectï¼Ÿä¸Šé¢çš„ç¤ºä¾‹æ—¢ç”¨äº† reject ä¹Ÿç”¨äº† Errorï¼Œåˆ°åº•æ˜¯å“ªä¸ªè§¦å‘çš„è¿™ä¸ªæ•è·å‘¢ï¼Ÿ

```js
function test() {
    return new Promise((resolve, reject) => {
        throw new Error('wrong')
    })
}

test().catch((e) => {
    console.log(e.message) // wrong
})
```

è¿™ä¸ªä»£ç å¯¹æ¯”ç€ä¸Šä¸ªä»£ç å°±èƒ½æ˜æ˜¾æ„Ÿå—å‡ºæ¥çš„ï¼Œthrow Error å’Œ reject éƒ½è§¦å‘äº† catch çš„æ•è·ï¼Œè€Œç¬¬ä¸€ä¸ªç”¨æ³•ä¸­è™½ç„¶ä¹Ÿæœ‰ Error ä½†æ˜¯å®ƒä¸æ˜¯ throwï¼Œåªæ˜¯ reject çš„å‚æ•°æ˜¯ Error å¯¹è±¡ï¼Œæ¢å¥è¯è¯´ new Error ä¸ä¼šè§¦å‘ catchï¼Œè€Œæ˜¯ rejectã€‚

æ³¨æ„

ä¸å»ºè®®åœ¨ Promise å†…éƒ¨ä½¿ç”¨ throw æ¥è§¦å‘å¼‚å¸¸ï¼Œè€Œæ˜¯ä½¿ç”¨ `reject(new Error())` çš„æ–¹å¼æ¥åšï¼Œå› ä¸º throw çš„æ–¹å¼å¹¶æ²¡æœ‰æ”¹å˜ Pronise çš„çŠ¶æ€

##### 12.2.3.Promise.resolve()

ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨ ```new Promise()` ``æ¥åˆ›å»º Promise å¯¹è±¡ï¼Œä½†æ˜¯é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹æ³•ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹ å¦‚ä½•ä½¿ç”¨ Promise.resolve å’Œ Promise.reject è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚

é™æ€æ–¹æ³• Promise.resolve(value) å¯ä»¥è®¤ä¸ºæ˜¯ new Promise() æ–¹æ³•çš„å¿«æ·æ–¹å¼ã€‚

æ¯”å¦‚ Promise.resolve(42) å¯ä»¥è®¤ä¸ºæ˜¯ä»¥ä¸‹ä»£ç çš„è¯­æ³•ç³–ã€‚

```js
new Promise(function(resolve) {
    resolve(42)
})
```

åœ¨è¿™æ®µä»£ç ä¸­çš„ resolve(42) ä¼šè®©è¿™ä¸ª Promise å¯¹è±¡ç«‹å³è¿›å…¥ç¡®å®šï¼ˆå³resolvedï¼‰çŠ¶æ€ï¼Œå¹¶å°† 42 ä¼ é€’ç»™åé¢ then é‡Œæ‰€æŒ‡å®šçš„ onFulfilled å‡½æ•°ã€‚

æ–¹æ³• Promise.resolve(value) çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢é‚£æ ·æ¥ç€å¯¹å…¶è¿”å›å€¼è¿›è¡Œ .then è°ƒç”¨ã€‚

```js
Promise.resolve(42).then(function(value) {
    console.log(value)
})
```

Promise.resolve ä½œä¸º new Promise() çš„å¿«æ·æ–¹å¼ï¼Œåœ¨è¿›è¡Œ Promise å¯¹è±¡çš„åˆå§‹åŒ–æˆ–è€…ç¼–å†™æµ‹è¯•ä»£ç çš„æ—¶å€™éƒ½éå¸¸æ–¹ä¾¿ã€‚

##### 12.2.4.Promise.reject()

Promise.reject(error) æ˜¯å’Œ Promise.resolve(value) ç±»ä¼¼çš„é™æ€æ–¹æ³•ï¼Œæ˜¯ new Promise() æ–¹æ³•çš„å¿«æ·æ–¹å¼ã€‚

æ¯”å¦‚ Promise.reject(new Error("å‡ºé”™äº†")) å°±æ˜¯ä¸‹é¢ä»£ç çš„è¯­æ³•ç³–å½¢å¼ã€‚

```js
new Promise(function(resolve, reject) {
    reject(new Error('å‡ºé”™äº†'))
})
```

è¿™æ®µä»£ç çš„åŠŸèƒ½æ˜¯è°ƒç”¨è¯¥Promise å¯¹è±¡é€šè¿‡thenæŒ‡å®šçš„ onRejected å‡½æ•°ï¼Œå¹¶å°†é”™è¯¯ï¼ˆErrorï¼‰å¯¹è±¡ä¼ é€’ç»™è¿™ä¸ª onRejected å‡½æ•°ã€‚

```js
Promise.reject(new Error('BOOM!'))
```

##### 12.2.5Promise.all()

**åŸºæœ¬è¯­æ³•**

> Promise.all(promiseArray)

**ç¤ºä¾‹**

```js
var p1 = Promise.resolve(1)
var p2 = Promise.resolve(2)
var p3 = Promise.resolve(3)
Promise.all([p1, p2, p3]).then(function(results) {
    console.log(results) // [1, 2, 3]
})
```

Promise.all ç”Ÿæˆå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ä½¿ç”¨ Promise å®ä¾‹çš„æ‰€æœ‰æ–¹æ³•ã€‚å‚æ•°ä¼ é€’promiseæ•°ç»„ä¸­æ‰€æœ‰çš„ Promise å¯¹è±¡éƒ½å˜ä¸ºresolveçš„æ—¶å€™ï¼Œè¯¥æ–¹æ³•æ‰ä¼šè¿”å›ï¼Œ æ–°åˆ›å»ºçš„ Promise åˆ™ä¼šä½¿ç”¨è¿™äº› promise çš„å€¼ã€‚

å¦‚æœå‚æ•°ä¸­çš„ä»»ä½•ä¸€ä¸ªpromiseä¸ºrejectçš„è¯ï¼Œåˆ™æ•´ä¸ªPromise.allè°ƒç”¨ä¼šç«‹å³ç»ˆæ­¢ï¼Œå¹¶è¿”å›ä¸€ä¸ªrejectçš„æ–°çš„ Promise å¯¹è±¡ã€‚

ç”±äºå‚æ•°æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ç”± Promise.resolve åŒ…è£…ï¼ˆwrapï¼‰çš„ï¼Œæ‰€ä»¥Promise.all å¯ä»¥å¤„ç†ä¸åŒç±»å‹çš„ Promise å¯¹è±¡ã€‚

**åº”ç”¨åœºæ™¯**

æ¯”å¦‚å½“æˆ‘ä»¬éœ€è¦æ‰¹é‡ä¸Šä¼ å›¾ç‰‡çš„æ—¶å€™ï¼Œå½“å…¨éƒ¨ä¸Šä¼ å®Œå›¾ç‰‡åéœ€è¦å¼¹å‡ºæç¤ºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ã€‚

##### 12.2.6.Promise.race()

**åŸºæœ¬è¯­æ³•**

> Promise.race(promiseArray)

**ç¤ºä¾‹**

```js
var p1 = Promise.resolve(1)
var p2 = Promise.resolve(2)
var p3 = Promise.resolve(3)
Promise.race([p1, p2, p3]).then(function(value) {
    console.log(value) // 1
})
```

<<<<<<< HEAD
Promise.race ç”Ÿæˆå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ã€‚

å‚æ•° promise æ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ª Promise å¯¹è±¡å¦‚æœå˜ä¸º resolve æˆ–è€… reject çš„è¯ï¼Œ è¯¥å‡½æ•°å°±ä¼šè¿”å›ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ª Promise å¯¹è±¡çš„å€¼è¿›è¡Œ resolve æˆ–è€… rejectã€‚

**ç»ƒä¹ **

å¦‚ä½•æŠŠå‰é¢Callback Hellçš„ä»£ç æ”¹å†™æˆpromiseçš„å†™æ³•å‘¢ï¼Ÿ

```js
function getPromise(url) {
    return new Promise((resolve, reject) => {
        ajax(url, res => {
            resolve(res)
        }, err => {
            reject(err)
        })
    })
}

getPromise('static/a.json')
    .then(res => {
        console.log(res)
        return getPromise('static/b.json')
    }).then(res => {
        console.log(res)
        return getPromise('static/c.json')
    }).then(res => {
        console.log(res)
    }).catch(err => {
        console.log(err)
    })
```

### 15.iteratoræ¥å£æœºåˆ¶
1.ç†è§£ï¼š

* iteratoræ˜¯ä¸€ç§æ¥å£æœºåˆ¶ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶

2.ä½œç”¨ï¼š

* ä¸ºå„ç§æ•°æ®ç»“æ„ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ã€ç®€ä¾¿çš„è®¿é—®æ¥å£ï¼›

* ä½¿å¾—æ•°æ®ç»“æ„çš„æˆå‘˜èƒ½å¤ŸæŒ‰æŸç§æ¬¡åºæ’åˆ—

* ES6åˆ›é€ äº†ä¸€ç§æ–°çš„éå†å‘½ä»¤for...ofå¾ªç¯ï¼ŒIteratoræ¥å£ä¸»è¦ä¾›for...ofæ¶ˆè´¹ã€‚

3.å·¥ä½œåŸç†ï¼š

* åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ï¼ŒæŒ‡å‘æ•°æ®ç»“æ„çš„èµ·å§‹ä½ç½®ã€‚

* ç¬¬ä¸€æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼ŒæŒ‡é’ˆè‡ªåŠ¨æŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬ä¸€ä¸ªæˆå‘˜

* æ¥ä¸‹æ¥ä¸æ–­è°ƒç”¨nextæ–¹æ³•ï¼ŒæŒ‡é’ˆä¼šä¸€ç›´å¾€åç§»åŠ¨ï¼Œç›´åˆ°æŒ‡å‘æœ€åä¸€ä¸ªæˆå‘˜

* æ¯è°ƒç”¨nextæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªåŒ…å«valueå’Œdoneçš„å¯¹è±¡ï¼Œ{value: å½“å‰æˆå‘˜çš„å€¼,done: å¸ƒå°”å€¼}

* valueè¡¨ç¤ºå½“å‰æˆå‘˜çš„å€¼ï¼Œdoneå¯¹åº”çš„å¸ƒå°”å€¼è¡¨ç¤ºå½“å‰çš„æ•°æ®çš„ç»“æ„æ˜¯å¦éå†ç»“æŸã€‚

* å½“éå†ç»“æŸçš„æ—¶å€™è¿”å›çš„valueå€¼æ˜¯undefinedï¼Œdoneå€¼ä¸ºfalse

```
function myIteraor(arr) {
	let index = 0 //è®°å½•æŒ‡é’ˆçš„ä½ç½®
	return {
		next() {
			return {
				value[index++],
				done: index < arr.length - 1  ? false : true
			}
		}
	}
}
let arr = [1, 2, 3, 5, 2]

console.log(myIteraor.next(arr))
console.log(myIteraor.next(arr))
console.log(myIteraor.next(arr))
```

4.åŸç”Ÿå…·å¤‡iteratoræ¥å£çš„æ•°æ®(å¯ç”¨for oféå†)

* Arrayã€argumentsã€setå®¹å™¨ã€mapå®¹å™¨ã€String...

``` 
let arr = [1, 2, 'abc']
for(let i of arr) {
	console.log(i) // 1, 2, 'abc'
}
let str = 'abc'
for(let j of str) {
	console.log(j) // a, b, c
}
function fun() {
	for(let i of arguments) {
		console.log(i) // 1, "fun", 44
	}
}
fun(1, "fun", 44)
let obj = {
	name: "jack",
	age: 12
}
for(let z of obj) {
	console.log(z) // obj is not iterable (obj ä¸æ˜¯å¯è¿­ä»£çš„)
}
```

### 16.Generatorå‡½æ•°

#### 13.1.è®¤è¯†Generator

ä»€ä¹ˆæ˜¯ JavaScript Generators å‘¢ï¼Ÿé€šä¿—çš„è®² Generators æ˜¯å¯ä»¥ç”¨æ¥æ§åˆ¶è¿­ä»£å™¨çš„å‡½æ•°ã€‚å®ƒä»¬å¯ä»¥æš‚åœï¼Œç„¶ååœ¨ä»»ä½•æ—¶å€™æ¢å¤ã€‚å¦‚æœè¿™å¥è¯ä¸å¥½ç†è§£ï¼Œå¯ä»¥çœ‹ä¸‹æ¥ä¸‹æ¥çš„ç¤ºä¾‹ã€‚

**1. å¸¸è§„å¾ªç¯**

```js
for (let i = 0; i < 5; i += 1) {
    console.log(i)
}
// this will return immediately 0 -> 1 -> 2 -> 3 -> 4
```

**2. åˆ©ç”¨ Generator**

```js
function* generatorForLoop() {
    for (let i = 0; i < 5; i += 1) {
        yield console.log(i)
    }
}

const genForLoop = generatorForLoop()

console.log(genForLoop.next()) // first console.log - 0
console.log(genForLoop.next()) // 1
console.log(genForLoop.next()) // 2
console.log(genForLoop.next()) // 3
console.log(genForLoop.next()) // 4
```

å¯¹æ¯”ä¸‹ä»£ç ï¼Œå¸¸è§„çš„å¾ªç¯åªèƒ½ä¸€æ¬¡éå†å®Œæ‰€æœ‰å€¼ï¼ŒGenerator å¯ä»¥é€šè¿‡è°ƒç”¨ next æ–¹æ³•æ‹¿åˆ°ä¾æ¬¡éå†çš„å€¼ï¼Œè®©éå†çš„æ‰§è¡Œå˜å¾—â€œå¯æ§â€ã€‚

>Generatorå‡½æ•°çš„ç‰¹ç‚¹ï¼š
>
>* ES6æä¾›çš„è§£å†³å¼‚æ­¥ç¼–ç¨‹çš„æ–¹æ¡ˆä¹‹ä¸€
>* Generatorå‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå†…éƒ¨å°è£…äº†ä¸åŒçŠ¶æ€çš„æ•°æ®ï¼Œ
>
>* ç”¨æ¥ç”Ÿæˆéå†å™¨å¯¹è±¡

#### 13.2.åŸºæœ¬è¯­æ³•

**å®šä¹‰**

```js
function* gen() {
    yield 1
    yield 2
    yield 3
}

let g = gen()
// "Generator { }"
```

è¿™ä¸ªæ˜¯ Generator çš„å®šä¹‰æ–¹æ³•ï¼Œæœ‰å‡ ä¸ªç‚¹å€¼å¾—æ³¨æ„ï¼š

1. æ¯”æ™®é€šå‡½æ•°å¤šä¸€ä¸ª *

2. å‡½æ•°å†…éƒ¨ç”¨ yield æ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œçš„â€œæš‚åœâ€

3. generatorå‡½æ•°è¿”å›çš„æ˜¯æŒ‡é’ˆå¯¹è±¡ï¼Œè€Œä¸ä¼šæ‰§è¡Œå‡½æ•°å†…éƒ¨é€»è¾‘

4. generatorå‡½æ•°çš„è¿”å›å€¼é€šè¿‡è°ƒç”¨ next æ¥â€œæ¢å¤â€ç¨‹åºæ‰§è¡Œï¼Œç›´åˆ°å†æ¬¡é‡åˆ°yieldæˆ–ç¨‹åºæ‰§è¡Œå®Œæ¯•

   

æ³¨æ„

Generator å‡½æ•°çš„å®šä¹‰ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™ä¼šè§¦å‘ SyntaxError é”™è¯¯

```js
let generator = * () => {} // SyntaxError
let generator = () * => {} // SyntaxError
let generator = ( * ) => {} // SyntaxError
```

è¿™äº›åšæ³•éƒ½æ˜¯é”™è¯¯çš„âŒã€‚

**yield è¡¨è¾¾å¼**

> yield å…³é”®å­—ç”¨æ¥æš‚åœå’Œæ¢å¤ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°

å…³äº yield è¡¨è¾¾å¼ï¼Œè¦ç†Ÿè®°å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š

1. yield è¡¨è¾¾å¼çš„è¿”å›å€¼æ˜¯ undefinedï¼Œä½†æ˜¯éå†å™¨å¯¹è±¡çš„ next æ–¹æ³•å¯ä»¥ä¿®æ”¹è¿™ä¸ªé»˜è®¤å€¼ã€‚

```js
  function* gen() {
      let val
      val = yield 1
      console.log( `1:${val}` ) // 1:undefined
      val = yield 2
      console.log( `2:${val}` ) // 2:undefined
      val = yield 3
      console.log( `3:${val}` ) // 3:undefined
  }

  var g = gen()

  console.log(g.next()) // {value: 1, done: false}
  console.log(g.next()) // {value: 2, done: false}
  console.log(g.next()) // {value: 3, done: false}
  console.log(g.next()) // {value: undefined, done: true}
```

ä»è¿™ä¸ªä»£ç å¯ä»¥çœ‹å‡ºæ¥ï¼Œyield è¡¨è¾¾å¼çš„è¿”å›å€¼æ˜¯ undefinedã€‚

1. yeild * æ˜¯å§”æ‰˜ç»™å¦ä¸€ä¸ªéå†å™¨å¯¹è±¡æˆ–è€…å¯éå†å¯¹è±¡

```js
  function* gen() {
      let val
      val = yield 1
      console.log( `1:${val}` ) // 1:undefined
      val = yield 2
      console.log( `2:${val}` ) // 2:undefined
      val = yield [3, 4, 5]
      console.log( `3:${val}` ) // 3:undefined
  }
```

1. Generator å¯¹è±¡çš„ next æ–¹æ³•ï¼Œé‡åˆ° yield å°±æš‚åœï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…æ‹¬ä¸¤ä¸ªå±æ€§ï¼švalue å’Œ doneã€‚

å‚è€ƒæ­¥éª¤1 çš„ä»£ç å¯ä»¥æ˜ç¡®çœ‹å‡ºæ¥ï¼Œæ‰§è¡Œç¬¬ä¸€å¥ ```g.next` ``gen ä»£ç æ‰§è¡Œåˆ° yield 1ï¼Œç¨‹åºæš‚åœï¼Œæ­¤æ—¶è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼š{value: 1, done: false}

**æ–¹æ³•**

Generator å¯¹è±¡æœ‰å‡ ä¸ªæ–¹æ³•ï¼Œnextã€returnã€throwã€‚

**- next([value])**

å‰é¢æˆ‘ä»¬è®²äº†ï¼ŒGenerator å¯¹è±¡é€šè¿‡ next æ–¹æ³•æ¥è·å–æ¯ä¸€æ¬¡éå†çš„ç»“æœï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«ä¸¤ä¸ªå±æ€§ï¼švalue å’Œ doneã€‚value æ˜¯æŒ‡å½“å‰ç¨‹åºçš„è¿è¡Œç»“æœï¼Œdone è¡¨ç¤ºéå†æ˜¯å¦ç»“æŸã€‚

å…¶å® next æ˜¯å¯ä»¥æ¥å—å‚æ•°çš„ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥è®©ä½ åœ¨ Generator å¤–éƒ¨ç»™å†…éƒ¨ä¼ é€’æ•°æ®ï¼Œè€Œè¿™ä¸ªå‚æ•°å°±æ˜¯ä½œä¸º yield çš„è¿”å›å€¼ã€‚

```js
  function* gen() {
      var val = 100
      while (true) {
          console.log( `before ${val}` )
          val = yield val
          console.log( `return ${val}` )
      }
  }

  var g = gen()
  console.log(g.next(20).value)
  // before 100
  // 100
  console.log(g.next(30).value)
  // return 30
  // before 30
  // 30
  console.log(g.next(40).value)
  // return 40
  // before 40
  // 40
```

å¦‚æœå¯¹ä¸Šé¢çš„è¯å’Œä»£ç ä¸ç†è§£ï¼Œå¯ä»¥æŠŠ ```console.log(g.next(30).value)` ``å’Œ ```console.log(g.next(40).value)` ``æ³¨é‡Šæ‰ã€‚ä½ ä¼šå‘ç° åªè¾“å‡ºäº† before 100 å’Œ 100ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥è¿˜åŸä¸‹è¿™æ®µä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ï¼š

1. g.next(20) è¿™å¥ä»£ç ä¼šæ‰§è¡Œ gen å†…éƒ¨çš„ä»£ç ï¼Œé‡åˆ°ç¬¬ä¸€ä¸ª yield æš‚åœã€‚æ‰€ä»¥ ```console.log(` before ${val} `)` ``æ‰§è¡Œè¾“å‡ºäº† ```before 100` ``ï¼Œæ­¤æ—¶çš„ val æ˜¯ 100ï¼Œæ‰€ä»¥æ‰§è¡Œåˆ° yield val è¿”å›äº† 100ï¼Œæ³¨æ„ ```yield val` ``å¹¶æ²¡æœ‰èµ‹å€¼ç»™ valã€‚
2. g.next(30) è¿™å¥ä»£ç ä¼šç»§ç»­æ‰§è¡Œ gen å†…éƒ¨çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯ ```val = yield val` ``è¿™å¥ï¼Œå› ä¸º next ä¼ å…¥äº† 30ï¼Œæ‰€ä»¥ yield val è¿™ä¸ªè¿”å›å€¼å°±æ˜¯ 30ï¼Œå› æ­¤ val è¢«èµ‹å€¼ 30ï¼Œæ‰§è¡Œåˆ° ```console.log(` return ${val} `)` ``è¾“å‡ºäº† 30ï¼Œæ­¤æ—¶æ²¡æœ‰é‡åˆ° yield ä»£ç ç»§ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ while çš„åˆ¤æ–­ï¼Œç»§ç»­æ‰§è¡Œ ```console.log(` before ${val} `)` ``è¾“å‡ºäº† ```before 30` ``ï¼Œå†æ‰§è¡Œé‡åˆ°äº† ```yield val` ``ç¨‹åºæš‚åœã€‚
3. g.next(40) é‡å¤æ­¥éª¤ 2ã€‚

**- return()**

return æ–¹æ³•å¯ä»¥è®© Generator éå†ç»ˆæ­¢ï¼Œæœ‰ç‚¹ç±»ä¼¼ for å¾ªç¯çš„ breakã€‚

```js
function* gen() {
    yield 1
    yield 2
    yield 3
}

var g = gen()

console.log(g.next()) // {value: 1, done: false}
console.log(g.return()) // {value: undefined, done: true}
console.log(g.next()) // {value: undefined, done: true}
```

ä» done å¯ä»¥çœ‹å‡ºä»£ç æ‰§è¡Œå·²ç»ç»“æŸã€‚

å½“ç„¶ return ä¹Ÿå¯ä»¥ä¼ å…¥å‚æ•°ï¼Œä½œä¸ºè¿”å›çš„ value å€¼ã€‚

```js
function* gen() {
    yield 1
    yield 2
    yield 3
}

var g = gen()

console.log(g.next()) // {value: 1, done: false}
console.log(g.return(100)) // {value: 100, done: true}
console.log(g.next()) // {value: undefined, done: true}
```

**- throw()**

å¯ä»¥é€šè¿‡ throw æ–¹æ³•åœ¨ Generator å¤–éƒ¨æ§åˆ¶å†…éƒ¨æ‰§è¡Œçš„â€œç»ˆæ–­â€ã€‚

```js
function* gen() {
    while (true) {
        try {
            yield 42
        } catch (e) {
            console.log(e.message)
        }
    }
}

let g = gen()
console.log(g.next()) // { value: 42, done: false }
console.log(g.next()) // { value: 42, done: false }
console.log(g.next()) // { value: 42, done: false }
// ä¸­æ–­æ“ä½œ
g.throw(new Error('break'))

console.log(g.next()) // {value: undefined, done: true}
```

TIP

å¦‚æœæƒ³é€€å‡ºéå† catch ä¹‹åå¯ä»¥é…åˆ ```return false` ``ä½¿ç”¨ï¼Œèƒ½èµ·åˆ° â€œbreakâ€ çš„ä½œç”¨

#### 13.3.åº”ç”¨åœºæ™¯

**åœºæ™¯1**

è¿˜æ˜¯å‰é¢çš„å¼‚æ­¥æ“ä½œï¼ŒæŒ‰é¡ºåºè¯»å–a.jsonã€b.jsonã€c.jsonï¼Œå¦‚æœä½¿ç”¨Generatorè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ

```js
function request(url) {
    ajax(url, res => {
        getData.next(res)
    })
}

function* gen() {
    let res1 = yield request('static/a.json')
    console.log(res1)
    let res2 = yield request('static/b.json')
    console.log(res2)
    let res3 = yield request('static/c.json')
    console.log(res3)
}
let getData = gen()
getData.next()
```

**åœºæ™¯2**

æˆ‘ä»¬ç»å¸¸ç©ä¸€äº›å°æ¸¸æˆï¼Œæ¯”å¦‚æ•°æ•°å­—ï¼Œæ•²7ï¼Œåˆ°7å’Œ7çš„å€æ•°ï¼Œæ— é™å¾ªç¯è½¬åœˆå»æ•°æ•°

```js
function* count(x = 1) {
    while (true) {
        if (x % 7 === 0) {
            yield x
        }
        x++
    }
}
// es5ä¸­å°±æ˜¯ä¸ªæ­»å¾ªç¯ å› ä¸ºes5çš„å¾ªç¯éœ€è¦æœ‰ä¸ªç»ˆæ­¢å€¼ï¼Œä½†æˆ‘ä»¬è¿™ä¸ªéœ€æ±‚æ²¡æœ‰ç»ˆæ­¢ï¼Œä¸€ç›´åœ¨æ•°æ•°
let n = count()
console.log(n.next().value)
console.log(n.next().value)
console.log(n.next().value)
console.log(n.next().value)
console.log(n.next().value)
console.log(n.next().value)
```

é€šè¿‡ Generator æˆ‘ä»¬å°±èƒ½è½»æ¾å®ç°ï¼Œåªè¦è°ƒç”¨ n.next æˆ‘ä»¬å°±çŸ¥é“ä¸‹ä¸€ä¸ªæ•°æ˜¯ä»€ä¹ˆäº†ï¼Œè€Œä½¿ç”¨æ™®é€šå‡½æ•°å´æ²¡æ³•åšåˆ°

* ç¼ºç‚¹ï¼šæœ¬è´¨ä¸Šè¿˜æ˜¯æ²¡æœ‰è„±ç¦»å›è°ƒå‡½æ•°

### 17.classç±»ä½¿ç”¨è¯¦è§£

#### 15.1.ES5å®ç°ç»§æ‰¿

```
function Parent(name, age) {
	this.name = name
	this.age = age // å®ä¾‹å±æ€§
	Parent.name = 32 // é™æ€å±æ€§
	Parent.getName = function() {
		return this.name
	}
}
Parent.prototype.getName = function() { // å®ä¾‹æ–¹æ³•
	return this.name 
}

function Child(name, age) {
	Parent.call(this, name, age)
}

// ä½¿å®ä¾‹å¯è®¿é—®çˆ¶ç±»çš„åŸå‹æ–¹æ³•
Child.prototype = new Parent() 
Child.contructor = Parent

const person = new Child('chh', 12)
console.log(person) { name: 'chh', age: 12 }
console.log(Parent.getName()) // 32
```



#### 15.2.ES6å®ç°ç»§æ‰¿

* é€šè¿‡classå®ç°ç±»çš„ç»§æ‰¿
  * é€šè¿‡constructorå®šä¹‰æ„é€ æ–¹æ³•
  * é€šè¿‡newæ¥åˆ›å»ºç±»çš„å®ä¾‹
  * é€šè¿‡extendsæ¥å®ç°ç±»çš„ç»§æ‰¿
  * é€šè¿‡superè°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•

```
class Person {
	constructor(name, age) {
		this.name = name
		this.age = age
		this._sex = 0
	}
	// å¿…é¡»ç”¨å¯¹è±¡ç®€å†™,ä¿å­˜åœ¨å®ä¾‹çš„åŸå‹ä¸­
	showName() {
		console.log(this.name)
	}
	get sex() {
		if(this._sex === 0) return 'male'
		if(this._sex === 1) return 'female'
		return 'error'
	}
	set sex(val) {
		if(val !== 0 && val !== 1) return
		this._sex = val
	}
}
let person = new Person("jack", 12)
console.log(person) // {name: "jack", age: 12}
person.showName() // "jack"

// å­ç±»ç»§æ‰¿çˆ¶ç±»
class childPerson extends Person{
	constructor(name, age, salary) {
		super(name, age)
		this.salary = salary
	}
	// ç±»ä¼¼äºjavaæ–¹æ³•çš„é‡å†™,ä¸é‡å†™åˆ™ç”¨çˆ¶ç±»çš„åŸå‹çš„æ–¹æ³•
	showName() {
		console.log("å­ç±»çš„æ–¹æ³•")
		console.log(this.name)
	}
}
let person = new ChildPerson("jack", 13, 100000)
console.log(person)  // {name: "jack", age: 13, salary: 100000}
person.showName // jcak
```

### 18.Setï¼ŒMapå®¹å™¨

1.Setå®¹å™¨ï¼šæ— åºä¸å¯é‡å¤çš„å¤šä¸ªvalueçš„é›†åˆä½“

* Set(array)
* add(value)
* delete(value)
* has(value)
* clear()
* size

```
let setArr = new Set([1, 4, 2, 3, 4, 3, 5])
console.log(setArr) // {1, 4, 2, 3, 5, size: 5}
setArr.add(2) // ä¸å˜
setArr.add(7) // {1, 4, 2, 3, 5, 7, size: 6}
setArr.delete(2) // {1, 4, 3, 5, 7, size: 5}
setArr.has(1) // true
setArr.clear() // {size: 0}
```

2.Mapå®¹å™¨ï¼šæ— åºçš„keyä¸é‡å¤çš„å¤šä¸ªkey-valueçš„é›†åˆä½“

* Map(array)
* set(key, value)
* get(key)
* delete(key)
* has(key)
* clear()
* size

```
let setArr = new Map([["name", "jack"],["age", 12]])
console.log(setArr) // {"name" => "jack", "age" => 12, size: 2}
setArr.set("address", "beijin") // {"name" => "jack", "age" => 12, "address" => "beijin", size: 3}
setArr.get("name") // "jack"
setArr.delete("name") // {"age" => 12, "address" => "beijin", size: 2}
setArr.has("address") // true
setArr.clear() // {size: 0}
```

## ES7

### 01.Array.prototype.includes()

åœ¨ ES7 ä¹‹å‰æƒ³åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼ŒåŸºæœ¬å¯ä»¥è¿™æ ·å†™ï¼š

```js
console.log(array1.find(function(item) {
    return item === 2
}))
```

æˆ–è€…

```js
console.log(array1.filter(function(item) {
    return item === 2
}).length > 0)
```

ES7å¼•å…¥çš„Array.prototype.includes() æ–¹æ³•ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œæ ¹æ®æƒ…å†µï¼Œå¦‚æœåŒ…å«åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å›falseã€‚

#### 1.1.åŸºæœ¬ç”¨æ³•

```js
const arr = ['es6', 'es7', 'es8']
console.log(arr.includes('es6')) // true
console.log(arr.includes('es9')) // false
```

#### 1.2.æ¥æ”¶ä¿©ä¸ªå‚æ•°

è¦æœç´¢çš„å€¼å’Œæœç´¢çš„å¼€å§‹ç´¢å¼•ã€‚ç¬¬äºŒä¸ªå‚æ•°å¯é€‰ã€‚ä»è¯¥ç´¢å¼•å¤„å¼€å§‹æŸ¥æ‰¾ searchElementã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œ

```js
const arr = ['es6', 'es7', 'es8']
console.log(arr.includes('es7', 1)) // true
console.log(arr.includes('es7', 2)) // false
console.log(arr.includes('es7', -1)) // false
console.log(arr.includes('es7', -2)) // true
```

#### 1.3.ä¸indexOf()æ¯”è¾ƒ

```js
['a', 'b', 'c'].includes('a') //true
['a', 'b', 'c'].indexOf('a') > -1 //true

console.log(arr.indexOf('es7')) // 1
console.log(arr.indexOf('es7') > -1) // true
```

æ³¨æ„

åªèƒ½åˆ¤æ–­ç®€å•ç±»å‹çš„æ•°æ®ï¼Œå¯¹äºå¤æ‚ç±»å‹çš„æ•°æ®ï¼Œæ¯”å¦‚å¯¹è±¡ç±»å‹çš„æ•°ç»„ï¼ŒäºŒç»´æ•°ç»„ï¼Œè¿™äº›æ˜¯æ— æ³•åˆ¤æ–­çš„.

```js
const arr = [1, [2, 3], 4]
arr.includes([2, 3]) //false
arr.indexOf([2, 3]) //-1
```

#### 1.4.ä¼˜ç¼ºç‚¹æ¯”è¾ƒ

ä¸¤è€…éƒ½æ˜¯é‡‡ç”¨===çš„æ“ä½œç¬¦æ¥ä½œæ¯”è¾ƒçš„ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼šå¯¹äºNaNçš„å¤„ç†ç»“æœä¸åŒã€‚æˆ‘ä»¬çŸ¥é“jsä¸­ NaN === NaN çš„ç»“æœæ˜¯false, indexOf()ä¹Ÿæ˜¯è¿™æ ·å¤„ç†çš„ï¼Œä½†æ˜¯includes()ä¸æ˜¯è¿™æ ·çš„ã€‚

```js
const demo = [1, NaN, 2, 3]
demo.indexOf(NaN) //-1
demo.includes(NaN) //true
```

æ€»ç»“

å¦‚æœåªæƒ³çŸ¥é“æŸä¸ªå€¼æ˜¯å¦åœ¨æ•°ç»„ä¸­å­˜åœ¨ï¼Œè€Œå¹¶ä¸å…³å¿ƒå®ƒçš„ç´¢å¼•ä½ç½®ï¼Œå»ºè®®ä½¿ç”¨includes()ã€‚å¦‚æœæƒ³è·å–ä¸€ä¸ªå€¼åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œé‚£ä¹ˆåªèƒ½ä½¿ç”¨indexOfæ–¹æ³•ã€‚

### 02.å¹‚è¿ç®—ç¬¦**

å¦‚æœä¸ä½¿ç”¨ä»»ä½•å‡½æ•°ï¼Œå¦‚ä½•å®ç°ä¸€ä¸ªæ•°çš„æ±‚å¹‚è¿ç®—ï¼Ÿ

```js
function pow(x, y) {
    let res = 1
    for (let i = 0; i < y; i++) {
        res *= x
    }
    return res
}

pow(2, 10)
// 1024
```

é™¤äº†è‡ªå·±å°è£…å‡½æ•°æ¥å®ç°ï¼Œä¹Ÿå¯æ˜¯ä½¿ç”¨ `Math.pow()` æ¥å®Œæˆã€‚

> Math.pow() å‡½æ•°è¿”å›åŸºæ•°ï¼ˆbaseï¼‰çš„æŒ‡æ•°ï¼ˆexponentï¼‰æ¬¡å¹‚ã€‚

```js
console.log(Math.pow(2, 10)) // 1024
```

åœ¨ ES7 å¯ä»¥è¿™æ ·å†™äº†ï¼š

```js
console.log(2 ** 10) // 1024
```

>æ³¨æ„
>
>å¹‚è¿ç®—ç¬¦çš„ä¸¤ä¸ª*å·ä¹‹é—´ä¸èƒ½å‡ºç°ç©ºæ ¼ï¼Œå¦åˆ™è¯­æ³•ä¼šæŠ¥é”™ã€‚

## ES8

### 01.async/await

async å’Œ await æ˜¯ä¸€ç§æ›´åŠ ä¼˜é›…çš„å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œæ˜¯Promise çš„æ‹“å±•ï¼Œå¦‚æœå¯¹ Promise è¿˜ä¸äº†è§£çš„è¯ï¼Œè¯·ç§»æ­¥ [Promise](http://es.xiecheng.live/es6/promise.html) ç« èŠ‚è¿›è¡Œå­¦ä¹ ã€‚

åœ¨æˆ‘ä»¬å¤„ç†å¼‚æ­¥çš„æ—¶å€™ï¼Œæ¯”èµ·å›è°ƒå‡½æ•°ï¼ŒPromiseçš„thenæ–¹æ³•ä¼šæ˜¾å¾—è¾ƒä¸ºç®€æ´å’Œæ¸…æ™°ï¼Œä½†æ˜¯åœ¨å¤„ç†å¤šä¸ªå½¼æ­¤ä¹‹é—´ç›¸äº’ä¾èµ–çš„è¯·æ±‚çš„æ—¶å€™ï¼Œå°±ä¼šæ˜¾çš„æœ‰äº›ç¹çã€‚è¿™æ—¶å€™ï¼Œç”¨async/awaitæ›´åŠ ä¼˜é›…ã€‚

æˆ‘ä»¬çŸ¥é“ JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œä½¿ç”¨ Promise ä¹‹åå¯ä»¥è®©æˆ‘ä»¬ä¹¦å†™å¼‚æ­¥æ“ä½œæ›´åŠ ç®€å•ï¼Œè€Œ async æ˜¯è®©æˆ‘ä»¬å†™èµ· Promise åƒåŒæ­¥æ“ä½œã€‚çœ‹ä¸‹ç¤ºä¾‹ï¼š

#### 1.1.åŸºæœ¬è¯­æ³•

å‰é¢æ·»åŠ äº†asyncçš„å‡½æ•°åœ¨æ‰§è¡Œåéƒ½ä¼šè‡ªåŠ¨è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡:

```js
function foo() {
    return 'imooc'
}
console.log(foo()) // 'imooc'
```

ç›¸å½“äº

```js
async function foo() {
    return 'imooc' // Promise.resolve('imooc')

    // let res =  Promise.resolve('imooc')
    // console.log(res)
}
console.log(foo()) // Promise
foo()
```

awaitåé¢éœ€è¦è·Ÿå¼‚æ­¥æ“ä½œï¼Œä¸ç„¶å°±æ²¡æœ‰æ„ä¹‰ï¼Œè€Œä¸”awaitåé¢çš„Promiseå¯¹è±¡ä¸å¿…å†™thenï¼Œå› ä¸ºawaitçš„ä½œç”¨ä¹‹ä¸€å°±æ˜¯è·å–åé¢Promiseå¯¹è±¡æˆåŠŸçŠ¶æ€ä¼ é€’å‡ºæ¥çš„å‚æ•°ã€‚

```js
function timeout() {
    return new Promise(resolve => {
        setTimeout(() => {
            console.log(1)
            resolve() // resolve('success')
        }, 1000)
    })
}

// ä¸åŠ asyncå’Œawaitæ˜¯2ã€1   åŠ äº†æ˜¯1ã€2
async function foo() {
    await timeout() // let res = await timeout() resæ˜¯success
    console.log(2)
}
foo()
```

#### 1.2.å¯¹äºå¤±è´¥çš„å¤„ç†

```js
function timeout() {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            // resolve('success')
            reject('error')
        }, 1000)
    })
}
async function foo() {
    return await timeout()
}
foo().then(res => {
    console.log(res)
}).catch(err => {
    console.log(err)
})
```

åœ¨asyncå‡½æ•°ä¸­ä½¿ç”¨awaitï¼Œé‚£ä¹ˆawaitè¿™é‡Œçš„ä»£ç å°±ä¼šå˜æˆåŒæ­¥çš„äº†ï¼Œæ„æ€å°±æ˜¯è¯´åªæœ‰ç­‰awaitåé¢çš„Promiseæ‰§è¡Œå®Œæˆå¾—åˆ°ç»“æœæ‰ä¼šç»§ç»­ä¸‹å»ï¼Œawaitå°±æ˜¯ç­‰å¾…ã€‚

#### 1.3.åº”ç”¨

è¿˜æ˜¯å‰é¢æ¡ˆä¾‹ä¸­çš„å¼‚æ­¥æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦å‘é€å¤šä¸ªè¯·æ±‚ï¼Œè€Œåé¢è¯·æ±‚çš„å‘é€æ€»æ˜¯éœ€è¦ä¾èµ–ä¸Šä¸€ä¸ªè¯·æ±‚è¿”å›çš„æ•°æ®ã€‚å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥ç”¨çš„Promiseçš„é“¾å¼è°ƒç”¨æ¥è§£å†³ï¼Œä¹Ÿå¯ä»¥ç”¨async/awaitæ¥è§£å†³ï¼Œç„¶è€Œåè€…ä¼šæ›´ç®€æ´äº›ã€‚

æŒ‰é¡ºåºè¯»å–a.jsonã€b.jsonã€c.jsonï¼Œå¦‚æœä½¿ç”¨async/awaitè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ

æˆ‘ä»¬åœ¨staticæ–‡ä»¶å¤¹ä¸‹æ”¾å…¥ä¸‰ä¸ªjsonæ–‡ä»¶ï¼š

a.json:

```json
{
    "a": "æˆ‘æ˜¯A"
}
```

b.json:

```json
{
    "b": "æˆ‘æ˜¯B"
}
```

c.json:

```json
{
    "c": "æˆ‘æ˜¯C"
}
// æŠŠajaxå°è£…æˆæ¨¡å—
import ajax from './ajax'

function request(url) {
    return new Promise(resolve => {
        ajax(url, res => {
            resolve(res)
        })
    })
}
async function getData() {
    let res1 = await request('static/a.json')
    console.log(res1)
    let res2 = await request('static/b.json')
    console.log(res2)
    let res3 = await request('static/c.json')
    console.log(res3)
}
getData()
```

>æ³¨æ„
>
>await åªèƒ½åœ¨ async æ ‡è®°çš„å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œå•ç‹¬ä½¿ç”¨ä¼šè§¦å‘ Syntax errorã€‚

### 02.å¯¹è±¡çš„æ‰©å±•

ä¹‹å‰çš„è¯­æ³•å¦‚ä½•è·å–å¯¹è±¡çš„æ¯ä¸€ä¸ªå±æ€§å€¼

```js
const obj = {
    name: 'imooc',
    web: 'www.imooc.com',
    course: 'es'
}
console.log(Object.keys(obj))
const res = Object.keys(obj).map(key => obj[key])
console.log(res)
// ["imooc", "www.imooc.com", "es"]
```

ES8ä¸­å¯¹è±¡æ‰©å±•è¡¥å……äº†ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºéå†å¯¹è±¡ï¼šObject.values()ï¼ŒObject.entries()

**Object.values()**

> Object.values() è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶å…ƒç´ æ˜¯åœ¨å¯¹è±¡ä¸Šæ‰¾åˆ°çš„å¯æšä¸¾å±æ€§å€¼ã€‚å±æ€§çš„é¡ºåºä¸é€šè¿‡æ‰‹åŠ¨å¾ªç¯å¯¹è±¡çš„å±æ€§å€¼æ‰€ç»™å‡ºçš„é¡ºåºç›¸åŒ(for...inï¼Œä½†æ˜¯for...inè¿˜ä¼šéå†åŸå‹ä¸Šçš„å±æ€§å€¼)ã€‚

```js
const obj = {
    name: 'imooc',
    web: 'www.imooc.com',
    course: 'es'
}

console.log(Object.values(obj))
// ["imooc", "www.imooc.com", "es"]
```

TIP

Object.values æ˜¯åœ¨å¯¹è±¡ä¸Šæ‰¾åˆ°å¯æšä¸¾çš„å±æ€§çš„å€¼ï¼Œæ‰€ä»¥åªè¦è¿™ä¸ªå¯¹è±¡æ˜¯å¯æšä¸¾çš„å°±å¯ä»¥ï¼Œä¸åªæ˜¯ {} è¿™ç§å½¢å¼ã€‚

**Object.entries()**

> Object.entries()æ–¹æ³•è¿”å›ä¸€ä¸ªç»™å®šå¯¹è±¡è‡ªèº«å¯æšä¸¾å±æ€§çš„é”®å€¼å¯¹æ•°ç»„ï¼Œå…¶æ’åˆ—ä¸ä½¿ç”¨ for...in å¾ªç¯éå†è¯¥å¯¹è±¡æ—¶è¿”å›çš„é¡ºåºä¸€è‡´ã€‚ï¼ˆåŒºåˆ«åœ¨äº for-in å¾ªç¯ä¹Ÿæšä¸¾åŸå‹é“¾ä¸­çš„å±æ€§ï¼‰

```js
let grade = {
    'lilei': 98,
    'hanmei': 87
}

for (let [key, value] of grade) {
    console.log(key, value) // Uncaught TypeError: grade is not iterable
}
```

æˆ‘ä»¬çŸ¥é“ Object æ˜¯ä¸å¯ç›´æ¥éå†çš„ï¼Œä¸Šè¿°ä»£ç è¶³ä»¥è¯´æ˜ç›´æ¥éå†è§¦å‘äº†é”™è¯¯ã€‚å¦‚æœä½¿ç”¨ Object.entries() åˆ™å¯ä»¥å®Œæˆéå†ä»»åŠ¡ã€‚

```js
let grade = {
    'lilei': 98,
    'hanmei': 87
}

for (let [k, v] of Object.entries(grade)) {
    console.log(k, v)
    // lilei 98
    // hanmei 87
}
```

è¿™æ®µä»£ç ç¡®å®æˆåŠŸçš„éå†äº†å‡ºæ¥ï¼Œä½†æ˜¯ä¸Šè¾¹è¯´è¿‡ Object.entries è¿”å›çš„æ˜¯æ•°ç»„ï¼Œè¿™é‡Œé¢è¿˜ç”¨äº†æ•°ç»„çš„è§£æ„èµ‹å€¼ï¼Œå¾ˆå¤šåŒå­¦ä¸æ˜ç™½æ˜¯æ€ä¹ˆç»“åˆçš„ï¼Œå…¶å®å¾ˆç®€å•ï¼Œçœ‹ä¸‹ Object.entries çš„è¿”å›å€¼å°±å¥½äº†ï¼š

![img](http://es.xiecheng.live/assets/img/entries.45cb18b2.png)

ç»“åˆè¿™ä¸ªå›¾è¿˜æœ‰è§£æ„èµ‹å€¼çš„åŸç†ï¼Œå°±æ˜ç™½ä¸Šè¿°çš„ä»£ç æ˜¯æ€ä¹ˆå·¥ä½œçš„äº†ã€‚

**Object.getOwnPropertyDescriptors()**

æƒ³ç†è§£ Object.getOwnPropertyDescriptors è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œé¦–å…ˆè¦å¼„æ‡‚ä»€ä¹ˆæ˜¯æè¿°ç¬¦(descriptor)ï¼Ÿ

```js
const data = {
    Portland: '78/50',
    Dublin: '88/52',
    Lima: '58/40'
}
```

è¿˜æ˜¯ä¸Šè¿°é‚£ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œæœ‰ key å’Œ valueï¼Œä¸Šè¾¹çš„ä»£ç æŠŠæ‰€æœ‰çš„ keyã€value éå†å‡ºæ¥ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³è®© Lima è¿™ä¸ªå±æ€§å’Œå€¼è¢«æšä¸¾æ€ä¹ˆåŠï¼Ÿ

```js
Object.defineProperty(data, 'Lima', {
    enumerable: false
})

Object.entries(data).map(([city, temp]) => {
    console.log( `City: ${city.padEnd(16)} Weather: ${temp}` )
    // City: Portland         Weather: 78/50
    // City: Dublin           Weather: 88/52
})
```

å¾ˆæˆåŠŸï¼ŒLima æ²¡æœ‰è¢«éå†å‡ºæ¥ï¼Œé‚£ä¹ˆ defineProperty çš„ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯æè¿°ç¬¦(descriptor)ã€‚è¿™ä¸ªæè¿°ç¬¦åŒ…æ‹¬å‡ ä¸ªå±æ€§ï¼š

- value [å±æ€§çš„å€¼]
- writable [å±æ€§çš„å€¼æ˜¯å¦å¯è¢«æ”¹å˜]
- enumerable [å±æ€§çš„å€¼æ˜¯å¦å¯è¢«æšä¸¾]
- configurable [æè¿°ç¬¦æœ¬èº«æ˜¯å¦å¯è¢«ä¿®æ”¹ï¼Œå±æ€§æ˜¯å¦å¯è¢«åˆ é™¤]

å¦‚æœæƒ³æŸ¥çœ‹æ›´å¤šç»†èŠ‚ï¼Œè®¿é—® [Object.defineProperty](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty)ã€‚

```js
console.log(Object.getOwnPropertyDescriptor(data, 'Lima'))
// {value: "58/40", writable: true, enumerable: false, configurable: true}
```

è¿™ä¸ªæ˜¯è·å–å¯¹è±¡æŒ‡å®šå±æ€§çš„æè¿°ç¬¦ï¼Œå¦‚æœæƒ³è·å–å¯¹è±¡çš„æ‰€æœ‰å±æ€§çš„æè¿°ç¬¦ï¼š

```js
console.log(Object.getOwnPropertyDescriptors(data))
```

è¿”å›æ•°æ®ï¼š ![img](http://es.xiecheng.live/assets/img/getownproperty.4847f943.png)

## ES9

### 01.for await of

å¼‚æ­¥è¿­ä»£å™¨(for-await-of)ï¼šå¾ªç¯ç­‰å¾…æ¯ä¸ªPromiseå¯¹è±¡å˜ä¸ºresolvedçŠ¶æ€æ‰è¿›å…¥ä¸‹ä¸€æ­¥ã€‚

æˆ‘ä»¬çŸ¥é“ for...of æ˜¯åŒæ­¥è¿è¡Œçš„ï¼Œæœ‰æ—¶å€™ä¸€äº›ä»»åŠ¡é›†åˆæ˜¯å¼‚æ­¥çš„ï¼Œé‚£è¿™ç§éå†æ€ä¹ˆåŠå‘¢ï¼Ÿ

```js
function Gen(time) {
    return new Promise(function(resolve, reject) {
        setTimeout(function() {
            resolve(time)
        }, time)
    })
}

async function test() {
    let arr = [Gen(2000), Gen(100), Gen(3000)]
    for (let item of arr) {
        console.log(Date.now(), item.then(console.log))
    }
}

test()
// 1560090138232 Promise {<pending>}
// 1560090138234 Promise {<pending>}
// 1560090138235 Promise {<pending>}
// 100
// 2000
// 3000
```

è¿™é‡Œå†™äº†å‡ ä¸ªå°ä»»åŠ¡ï¼Œåˆ†åˆ«æ˜¯ 2000ms ã€100msã€3000msåä»»åŠ¡ç»“æŸã€‚åœ¨ä¸Šè¿°éå†çš„è¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªä»»åŠ¡æ˜¯åŒæ­¥å¯åŠ¨çš„ï¼Œç„¶åè¾“å‡ºä¸Šä¹Ÿä¸æ˜¯æŒ‰ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºè¾“å‡ºçš„ï¼Œè¿™æ˜¾ç„¶ä¸å¤ªç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚

èªæ˜çš„åŒå­¦ä¸€å®šèƒ½æƒ³èµ·æ¥ await çš„ä½œç”¨ï¼Œå®ƒå¯ä»¥ä¸­æ–­ç¨‹åºçš„æ‰§è¡Œç›´åˆ°è¿™ä¸ª Promise å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸Šé¢çš„ä»£ç ï¼š

```js
function Gen(time) {
    return new Promise(function(resolve, reject) {
        setTimeout(function() {
            resolve(time)
        }, time)
    })
}

async function test() {
    let arr = [Gen(2000), Gen(100), Gen(3000)]
    for (let item of arr) {
        console.log(Date.now(), await item.then(console.log))
    }
}

test()
// 2000
// 1560091834772 undefined
// 100
// 1560091836774 undefined
// 3000
// 1560091836775 undefined
```

ä»è¿”å›å€¼çœ‹ç¡®å®æ˜¯æŒ‰ç…§ä»»åŠ¡çš„å…ˆåé¡ºåºè¿›è¡Œçš„ï¼Œå…¶ä¸­åŸç†ä¹Ÿæœ‰è¯´æ˜æ˜¯åˆ©ç”¨äº† await ä¸­æ–­ç¨‹åºçš„åŠŸèƒ½ã€‚

åœ¨ ES9 ä¸­ä¹Ÿå¯ä»¥ç”¨ for...await...of çš„è¯­æ³•æ¥æ“ä½œï¼š

```js
function Gen(time) {
    return new Promise(function(resolve, reject) {
        setTimeout(function() {
            resolve(time)
        }, time)
    })
}

async function test() {
    let arr = [Gen(2000), Gen(100), Gen(3000)]
    for await (let item of arr) {
        console.log(Date.now(), item)
    }
}

test()
// 1560092345730 2000
// 1560092345730 100
// 1560092346336 3000
```

ä»è¿™ä¸ªç»“æœæ¥çœ‹å’Œç¬¬äºŒç§å†™æ³•æ•ˆæœå·®ä¸å¤šï¼Œä½†æ˜¯å·¥ä½œåŸç†ç¡®å®Œå…¨ä¸åŒï¼Œé‡ç‚¹è§‚å¯Ÿä¸‹è¾“å‡ºçš„æ—¶é—´ï¼ˆChrome Consoleï¼‰, ç¬¬äºŒç§å†™æ³•æ˜¯ä»£ç å—ä¸­æœ‰ await å¯¼è‡´ç­‰å¾… Promise çš„çŠ¶æ€è€Œä¸å†ç»§ç»­æ‰§è¡Œï¼›ç¬¬ä¸‰ç§å†™æ³•æ˜¯æ•´ä¸ªä»£ç å—éƒ½ä¸æ‰§è¡Œï¼Œç­‰å¾… arr å½“å‰çš„å€¼ï¼ˆPromiseçŠ¶æ€ï¼‰å‘ç”Ÿå˜åŒ–ä¹‹åï¼Œæ‰æ‰§è¡Œä»£ç å—çš„å†…å®¹ã€‚

å›æƒ³æˆ‘ä»¬ä¹‹å‰ç»™æ•°æ®ç»“æ„è‡ªå®šä¹‰éå†å™¨æ˜¯åŒæ­¥çš„ï¼Œå¦‚æœæƒ³å®šä¹‰é€‚åˆ for...await...of çš„å¼‚æ­¥éå†å™¨è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ Symbol.asyncIteratorã€‚

```js
let obj = {
  count: 0, 
  Gen (time) {

    return new Promise(function (resolve, reject) {
      setTimeout(function () {
        resolve({ done: false, value: time })
      }, time)
    })

  }, 
  [Symbol.asyncIterator] () {

    let self = this
    return {
      next () {
        self.count++
        if (self.count < 4) {
          return self.Gen(Math.random() * 1000)
        } else {
          return Promise.resolve({
            done: true,
            value: ''
          })
        }
      }
    }

  }
}

async function test () {
  for await (let item of obj) {

    console.log(Date.now(), item)

  }
}
// 1560093560200 649.3946561938179
// 1560093560828 624.6310222512955
// 1560093561733 901.9497480464518
```

### 02.RegExp Updates

#### 2.1.dotAll æ¨¡å¼

æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œç‚¹ï¼ˆ.ï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œä»£è¡¨ä»»æ„çš„å•ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªä¾‹å¤–ã€‚ä¸€ä¸ªæ˜¯å››ä¸ªå­—èŠ‚çš„ UTF-16 å­—ç¬¦ï¼Œè¿™ä¸ªå¯ä»¥ç”¨uä¿®é¥°ç¬¦è§£å†³ï¼›å¦ä¸€ä¸ªæ˜¯è¡Œç»ˆæ­¢ç¬¦ï¼ˆline terminator characterï¼‰ã€‚

- U+000A æ¢è¡Œç¬¦ï¼ˆ\nï¼‰
- U+000D å›è½¦ç¬¦ï¼ˆ\rï¼‰
- U+2028 è¡Œåˆ†éš”ç¬¦ï¼ˆline separatorï¼‰
- U+2029 æ®µåˆ†éš”ç¬¦ï¼ˆparagraph separatorï¼‰

```js
console.log(/foo.bar/.test('foo\nbar')) // false
console.log(/foo.bar/s.test('foo\nbar')) // true
```

åœ¨ ES5 ä¸­æˆ‘ä»¬éƒ½æ˜¯è¿™ä¹ˆè§£å†³çš„ï¼š

```js
console.log(/foo[^]bar/.test('foo\nbar')) // true
// or
console.log(/foo[\s\S]bar/.test('foo\nbar')) // true
```

é‚£å¦‚ä½•åˆ¤æ–­å½“å‰æ­£åˆ™æ˜¯å¦ä½¿ç”¨äº† dotAll æ¨¡å¼å‘¢ï¼Ÿ

```js
const re = /foo.bar/s // Or, `const re = new RegExp('foo.bar', 's')` .
console.log(re.test('foo\nbar')) // true
console.log(re.dotAll) // true
console.log(re.flags) // 's'
```

TIP

è®°ä½ä¸€å¥è¯å°±å¯ä»¥ç†è§£ dotAll æ¨¡å¼ï¼šå®ƒè®© . åå‰¯å…¶å®ã€‚

#### 2.2.å…·åç»„åŒ¹é…

æˆ‘ä»¬åœ¨å†™æ­£åˆ™è¡¨è¾¾å¼çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠä¸€éƒ¨åˆ†ç”¨()åŒ…è£¹èµ·æ¥ï¼Œè¢«åŒ…è£¹èµ·æ¥çš„è¿™éƒ¨åˆ†ç§°ä½œâ€œåˆ†ç»„æ•è·â€ã€‚

```js
console.log('2020-05-01'.match(/(\d{4})-(\d{2})-(\d{2})/))
// ["2020-05-01", "2020", "05", "01", index: 0, input: "2020-05-01", groups: undefined]
```

è¿™ä¸ªæ­£åˆ™åŒ¹é…å¾ˆç®€å•ï¼ŒæŒ‰ç…§ match çš„è¯­æ³•ï¼Œæ²¡æœ‰ä½¿ç”¨ g æ ‡è¯†ç¬¦ï¼Œæ‰€ä»¥è¿”å›å€¼ç¬¬ä¸€ä¸ªæ•°å€¼æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„å®Œæ•´åŒ¹é…ï¼Œæ¥ä¸‹æ¥çš„ç¬¬äºŒä¸ªå€¼åˆ°ç¬¬å››ä¸ªå€¼æ˜¯åˆ†ç»„åŒ¹é…ï¼ˆ2020, 05, 01ï¼‰ã€‚

æ­¤å¤– match è¿”å›å€¼è¿˜æœ‰å‡ ä¸ªå±æ€§ï¼Œåˆ†åˆ«æ˜¯ indexã€inputã€groupsã€‚

TIP

1. index [åŒ¹é…çš„ç»“æœçš„å¼€å§‹ä½ç½®]
2. input [æœç´¢çš„å­—ç¬¦ä¸²]
3. groups [ä¸€ä¸ªæ•è·ç»„æ•°ç»„ æˆ– undefinedï¼ˆå¦‚æœæ²¡æœ‰å®šä¹‰å‘½åæ•è·ç»„ï¼‰]

æˆ‘ä»¬é€šè¿‡æ•°ç»„æ¥è·å–è¿™äº›æ•è·ï¼š

```js
let t = '2020-05-01'.match(/(\d{4})-(\d{2})-(\d{2})/)
console.log(t[1]) // 2020
console.log(t[2]) // 05
console.log(t[3]) // 01
```

ä¸Šæ–‡ä¸­é‡ç‚¹çœ‹ä¸‹ groups çš„è§£é‡Šï¼Œè¿™é‡Œæåˆ°äº†å‘½åæ•è·ç»„çš„æ¦‚å¿µï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ groups å°±æ˜¯ undefinedã€‚å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬ä¸Šè¿°çš„è¿”å›å€¼å°±æ˜¯ undefined é—´æ¥è¯´æ˜æ²¡æœ‰å®šä¹‰å‘½åæ•è·åˆ†ç»„ã€‚é‚£ä»€ä¹ˆæ˜¯å‘½åæ•è·åˆ†ç»„å‘¢ï¼Ÿ

```js
console.log('2020-05-01'.match(/(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/))
// ["2020-05-01", "2020", "05", "01", index: 0, input: "2020-05-01", groups: {â€¦}]
```

è¿™æ®µä»£ç çš„è¿”å›å€¼ groups å·²ç»æ˜¯ Object äº†ï¼Œå…·ä½“çš„å€¼æ˜¯ï¼š

```js
groups: {
    year: "2020",
    month: "05",
    day: "01"
}
```

è¿™ä¸ª Object çš„ key å°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­å®šä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯æŠŠæ•è·åˆ†ç»„è¿›è¡Œäº†å‘½åã€‚æƒ³è·å–è¿™äº›æ•è·å¯ä»¥è¿™æ ·åšï¼š

```js
let t = '2020-05-01'.match(/(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/)
// ["2020-05-01", "2020", "05", "01", index: 0, input: "2020-05-01", groups: {â€¦}]
console.log(t.groups.year) // 2020
console.log(t.groups.month) // 05
console.log(t.groups.day) // 01
```

#### 2.3.åè¡Œæ–­è¨€

åœ¨ ES9 ä¹‹å‰ JavaScript æ­£åˆ™åªæ”¯æŒå…ˆè¡Œæ–­è¨€ï¼Œä¸æ”¯æŒåè¡Œæ–­è¨€ã€‚ç®€å•å¤ä¹ ä¸‹å…ˆè¡Œæ–­è¨€çš„çŸ¥è¯†ï¼š

```js
let test = 'hello world'
console.log(test.match(/hello(?=\sworld)/))
// ["hello", index: 0, input: "hello world", groups: undefined]
```

è¿™æ®µä»£ç è¦åŒ¹é…åé¢æ˜¯ world çš„ helloï¼Œä½†æ˜¯åè¿‡æ¥å°±ä¸æˆï¼š

```js
let test = 'world hello'
console.log(test.match(/hello(?=\sworld)/))
// null
```

æ¯”å¦‚æˆ‘ä»¬æƒ³åˆ¤æ–­å‰é¢æ˜¯ world çš„ helloï¼Œè¿™ä¸ªä»£ç æ˜¯å®ç°ä¸äº†çš„ã€‚åœ¨ ES9 å°±æ”¯æŒè¿™ä¸ªåè¡Œæ–­è¨€äº†ï¼š

```js
let test = 'world hello'
console.log(test.match(/(?<=world\s)hello/))
// ["hello", index: 6, input: "world hello", groups: undefined]
```

(?<...)æ˜¯åè¡Œæ–­è¨€çš„ç¬¦å·ï¼Œ(?...)æ˜¯å…ˆè¡Œæ–­è¨€çš„ç¬¦å·ï¼Œç„¶åç»“åˆ =(ç­‰äº)ã€!(ä¸ç­‰)ã€\1(æ•è·åŒ¹é…)ã€‚

### 03.Object Rest & Spread

å‰é¢åœ¨è®² function çš„ Rest & Spread æ–¹æ³•ï¼Œå¿˜è®°çš„åŒå­¦å¯ä»¥å»å¤ä¹ ä¸‹ã€‚

åœ¨ ES9 æ–°å¢ Object çš„ Rest & Spread æ–¹æ³•ï¼Œç›´æ¥çœ‹ä¸‹ç¤ºä¾‹ï¼š

```js
const input = {
  a: 1,
  b: 2
}

const output = {
  ...input,
  c: 3
}

console.log(output) // {a: 1, b: 2, c: 3}
```

è¿™å—ä»£ç å±•ç¤ºäº† spread è¯­æ³•ï¼Œå¯ä»¥æŠŠ input å¯¹è±¡çš„æ•°æ®éƒ½æ‹“å±•åˆ° output å¯¹è±¡ï¼Œè¿™ä¸ªåŠŸèƒ½å¾ˆå®ç”¨ã€‚

æˆ‘ä»¬å†æ¥çœ‹ä¸‹ Object rest çš„ç¤ºä¾‹ï¼š

```js
const input = {
  a: 1,
  b: 2,
  c: 3
}

let { a, ...rest } = input

console.log(a, rest) // 1 {b: 2, c: 3}
```

å½“å¯¹è±¡ key-value ä¸ç¡®å®šçš„æ—¶å€™ï¼ŒæŠŠå¿…é€‰çš„ key èµ‹å€¼ç»™å˜é‡ï¼Œç”¨ä¸€ä¸ªå˜é‡æ”¶æ•›å…¶ä»–å¯é€‰çš„ key æ•°æ®ï¼Œè¿™åœ¨ä¹‹å‰æ˜¯åšä¸åˆ°çš„ã€‚

### 04.Promise.prototype.finally()

æŒ‡å®šä¸ç®¡æœ€åçŠ¶æ€å¦‚ä½•éƒ½ä¼šæ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚

Promise.prototype.finally() æ–¹æ³•è¿”å›ä¸€ä¸ªPromiseï¼Œåœ¨promiseæ‰§è¡Œç»“æŸæ—¶ï¼Œæ— è®ºç»“æœæ˜¯fulfilledæˆ–è€…æ˜¯rejectedï¼Œåœ¨æ‰§è¡Œthen()å’Œcatch()åï¼Œéƒ½ä¼šæ‰§è¡ŒfinallyæŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚è¿™ä¸ºæŒ‡å®šæ‰§è¡Œå®Œpromiseåï¼Œæ— è®ºç»“æœæ˜¯fulfilledè¿˜æ˜¯rejectedéƒ½éœ€è¦æ‰§è¡Œçš„ä»£ç æä¾›äº†ä¸€ç§æ–¹å¼ï¼Œé¿å…åŒæ ·çš„è¯­å¥éœ€è¦åœ¨then()å’Œcatch()ä¸­å„å†™ä¸€æ¬¡çš„æƒ…å†µã€‚

**åŸºæœ¬è¯­æ³•**

> p.finally(onFinally)

**ç¤ºä¾‹**

```js
new Promise((resolve, reject) => {
    setTimeout(() => {
        resolve('success')
        // reject('fail')
    }, 1000)
}).then(res => {
    console.log(res)
}).catch(err => {
    console.log(err)
}).finally(() => {
    console.log('finally')
})
```

#### 4.1.åœºæ™¯1ï¼šloadingå…³é—­

éœ€è¦æ¯æ¬¡å‘é€è¯·æ±‚ï¼Œéƒ½ä¼šæœ‰loadingæç¤ºï¼Œè¯·æ±‚å‘é€å®Œæ¯•ï¼Œå°±éœ€è¦å…³é—­loadingæç¤ºæ¡†ï¼Œä¸ç„¶ç•Œé¢å°±æ— æ³•è¢«ç‚¹å‡»ã€‚ä¸ç®¡è¯·æ±‚æˆåŠŸæˆ–æ˜¯å¤±è´¥ï¼Œè¿™ä¸ªloadingéƒ½éœ€è¦å…³é—­æ‰ï¼Œè¿™æ—¶æŠŠå…³é—­loadingçš„ä»£ç å†™åœ¨finallyé‡Œå†åˆé€‚ä¸è¿‡äº†ã€‚

#### 4.2.åœºæ™¯2ï¼šæ•°æ®åº“æ–­å¼€é“¾æ¥

```js
let connection
db.open()
    .then(conn => {
        connection = conn
        return connection.select({
            name: 'Jane'
        })
    })
    .then(result => {
        // Process result
        // Use `connection` to make more queries
    })Â·Â·Â·
    .catch(error => {
        // handle errors
    })
    .finally(() => {
        connection.close()
    })
```

### 05.å­—ç¬¦ä¸²æ‰©å±•

æ”¾æ¾å¯¹æ ‡ç­¾æ¨¡æ¿é‡Œå­—ç¬¦ä¸²è½¬ä¹‰çš„é™åˆ¶, é‡åˆ°ä¸åˆæ³•çš„å­—ç¬¦ä¸²è½¬ä¹‰è¿”å›undefinedï¼Œå¹¶ä¸”ä»rawä¸Šå¯è·å–åŸå­—ç¬¦ä¸²ã€‚

ES9å¼€å§‹ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²å…è®¸åµŒå¥—æ”¯æŒå¸¸è§è½¬ä¹‰åºåˆ—ï¼Œç§»é™¤å¯¹ECMAScriptåœ¨å¸¦æ ‡ç­¾çš„æ¨¡ç‰ˆå­—ç¬¦ä¸²ä¸­è½¬ä¹‰åºåˆ—çš„è¯­æ³•é™åˆ¶ã€‚

// å¸¦æ ‡ç­¾çš„æ¨¡æ¿å­—ç¬¦ä¸²

```js
const foo = (a, b, c, d) => {
    console.log(a)
    console.log(b)
    console.log(c)
    console.log(d)
}
// foo(1, 2, 3, 4)
const name = 'xiecheng'
const age = 34
foo `è¿™æ˜¯${name},ä»–çš„å¹´é¾„æ˜¯${age}å²` 
```

ES9 æ ‡å‡†ç§»é™¤äº†å¯¹ ECMAScriptå¸¦æ ‡ç­¾çš„æ¨¡æ¿å­—ç¬¦ä¸² ä¸­è½¬ä¹‰åºåˆ—çš„è¯­æ³•é™åˆ¶ã€‚

```js
function tag(strs) {
    console.log(strs)
    // strs[0] === undefined
    // strs.raw[0] === "\\unicode and \\u{55}"
}

// åœ¨æ ‡ç­¾å‡½æ•°ä¸­ä½¿ç”¨
tag `\u{61} and \u{62}`  //
tag `\u{61} and \unicode`  // ç»“æœæ˜¯ undefined

// ä¹‹å‰çš„ç‰ˆæœ¬ä¼šæŠ¥é”™ï¼šInvalid Unicode escape sequence
// æ— æ•ˆçš„Unicodeè½¬ä¹‰åºåˆ—

// æŠ¥é”™ï¼š
let bad = `bad escape sequence: \unicode` 
```